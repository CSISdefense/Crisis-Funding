---
title: "Contract Termination"
author: "Greg Sanders"
date: "Wednesday, February 8, 2117"
output:
  html_document:
    keep_md: yes
--- 

Modeling Likelihood of Contract Termination
============================================================================

#Setup
```{r Libraries, echo = FALSE}
library(csis360)
library(ggplot2)
library(arm)
library(R2WinBUGS)
source("https://raw.githubusercontent.com/CSISdefense/Vendor/master/DIIGstat.r")

axis.text.size<-10
strip.text.size<-10
legend.text.size<-8
# table.text.size<-5.75
title.text.size<-12
geom.text.size<-12

main.text.size<-1
note.text.size<-1.40


```



##Prepare Data
First we load the data. The dataset used is a U.S. Defense Contracting dataset derived from   FPDS.


```{r ReadInData, echo = TRUE}
  load(file="Data/Federal_contract_CSIScontractID_detail.Rdata")

head(fed)
fed<-transform_contract(fed)

summary(fed$CrisisPercent)
fed$CrisisPercent[is.na(fed$CrisisPercent) | fed$CrisisPercent<0]<-0
# fed<-decision_tree(fed)


```

Contracts are classified using a mix of numerical and categorical variables. While the changes in numerical variables are easy to grasp and summarize, a contract may have one line item that is competed and another that is not. As is detailed in the exploration on R&D, we are only considering information available prior to contract start. The percentage of contract obligations that were competed is a valuable benchmark, but is highly influenced by factors that occured after contract start..

### Contract Terminations

Contract terminations and the number of change orders can be calculated for the entire sample.  Contract termination is determined using the *Reason for Modification* field in FPDS.  A contract is considered to be terminated if it has at least one modification with the following values:

* "Terminate for Default (complete or partial)"
* "Terminate for Convenience (complete or partial)"
* "Terminate for Cause"
* "Legal Contract Cancellation"

These four catetegories and the "Close Out" category are used to mark a contract as closed.  Many contracts in FPDS and in the sample are never marked closed.  


* b_CBre is a binary variable that has a value of 1 for any contracts that have experienced a partial or complete termination, 0 otherwise. ('r summary(fed$b_CBre)
NA_stats(fed,"b_CBre")')
* b_Comp is a binary variable based on competition. It has a value of 0 for uncompeted contracts and a value of 1 for competition, regardless of number of offers. 'r  summary(fed$b_Comp);
NA_stats(fed,"b_Comp")'
* n_Comp is a numeric variable based on competition and number of offers. It has a value of 0 for uncompeted contracts and a value of 1 for single-offer competition, and a value of 2 for multi-offer competition. 'r summary(fed$EffComp);
NA_stats(fed,"n_Comp")' 
* n_Offr is a numeric variable based on competition and with more granularity on number offers. It has a value of 0 for uncompeted contracts and a value of 1 for single-offer competition, and a value of 2 for 2-offers, 3 for 3-4 offers, and 4 for 5+ offers. 'r summary(fed$n_Offr);
NA_stats(fed,"n_Offr")' 

* n_Offr is a numeric variable based on competition and with more granularity on number offers. It has a value of 0 for uncompeted contracts and a value of 1 for single-offer competition, and a value of 2 for 2-offers, 3 for 3-4 offers, and 4 for 5+ offers. 'r summary(fed$Urg);
NA_stats(fed,"b_Urg")' 
* l_Offr is the natural log of the number of offers received. Uncompeted contracts are classified as having received one offer. 'r summary(fed$l_Offr)
NA_stats(fed,"l_Offr")'
* cl_Ceil is the natural log of the initial contract cost ceiling, in then-year dollars. 'r centered_log_description(fed$l_Ceil,"dollars")
NA_stats(fed,"l_Ceil")'
* cl_Days is the natural log of the initial maximum duration of the contract, in days. The variable is centered, by subtracting its mean ('r centered_log_description(fed$l_Days,"days");
NA_stats(fed,"l_Days")' 
* SIDV, MIDV, and OIDV are dummy variables based on the contract vehicle. They correspond to Single-Award IDVs, Multi-Award IDVs, and Other IDVs, respectively, having a value of 1 when the task order has that vehicle type, and having a 0 other. The remaining types, definitive contracts and purchase orders, are intentionally left out. ('r summary(fed$SIDV);
summary(fed$MIDV);
summary(fed$FSSGWAC);
summary(fed$BPABOA);
NA_stats(fed,"Veh")'
* n_Fixed is a numeric variable based on contract pricing. It has a value of 0 for cost-based, 0.5 or "combination or other", 1 for any fixed price (excluding fixed-price level of effort which is classified as cost-based). ('r summary(fed$n_Fixed);
NA_stats(fed,"n_Fixed")')
* n_Incent is a numeric variable based on fee type. Ig has a value. 1 for incentive fee or cost sharing, 0.5 or "combination or other", 0 for all remaining types. ('r summary(fed$n_Incent);
NA_stats(fed,"n_Incent")')
* b_UCA is a binary variable with a value of 1 for contracts/task orders that begin as letter contracts or undefinitized contract awards (UCA) and a value of 0 otherwise. 'r
summary(fed$b_UCA);
NA_stats(fed,"b_UCA")'
* b_Intl is a binary variable with a value of 1 for contracts/task orders with any transactions performed internationally and a value of 0 otherwise. 'r
summary(fed$b_Intl);
NA_stats(fed,"b_Intl")'


In addition, l_Ceil and l_Days are rescaled to have an average value of 0 and a standard deviation of one. This standardizes interpretation and prevents a "very large eigen value" error later when l_Ceil:lDay is introduced.


Next, we eliminate missing data entries and then draw a sample. The final computation uses all of the data, but as a computation shortcut, only a subset of the data is needed to allow for processing of models in minutes rather than hours.

## Sample Creation
```{r Sample}
crisis_with_na<-fed[fed$Crisis %in% c("ARRA","Dis"),]
oco<-fed[fed$Crisis %in% c("OCO"),]
oco<-oco[sample(nrow(oco),100000),]
crisis_with_na<-rbind(crisis_with_na,oco)
rm(oco)
other<-fed[fed$Crisis %in% c("Other"),]
other<-other[sample(nrow(other),100000),]
crisis_with_na<-rbind(crisis_with_na,other)
rm(other)
# summary(crisis_with_na$b_Comp )
# summary(crisis_with_na$n_Comp )
# summary(crisis_with_na$Comp )
# summary(crisis_with_na$CompOffr )
# summary(crisis_with_na$EffComp )

complete<-!is.na(crisis_with_na$b_Term)&
  !is.na(crisis_with_na$b_CBre)&
  !is.na(crisis_with_na$b_Comp)&
  !is.na(crisis_with_na$b_Urg)&
  !is.na(crisis_with_na$l_Ceil)&
  !is.na(crisis_with_na$l_Days)&
  !is.na(crisis_with_na$Veh) &
  !is.na(crisis_with_na$n_Fixed)&
  !is.na(crisis_with_na$b_Intl)&
  !is.na(crisis_with_na$b_UCA)&
  !is.na(crisis_with_na$ProdServ)&
  !is.na(crisis_with_na$Crisis)&
  !is.na(crisis_with_na$Office)
  # !is.na(crisis_with_na$cl_HHI_lag1)

summary(crisis_with_na$Crisis)



crisis_smp$OffPl99<-Hmisc::cut2(crisis_smp$OffIntl,c(0.01,0.50))
summary(crisis_smp$OffPl99)
  levels(crisis_smp$OffPl99) <-
    list("US99"=c("[0.00,0.01)"),
         "Mixed"=c("[0.01,0.50)"),
         "Intl"=c("[0.50,1.00]"))

  

#
#8811392  to 8811392
nrow(crisis_with_na[!complete,])/nrow(crisis_with_na)
sum(crisis_with_na[!complete,]$Action.Obligation,na.rm=TRUE)/sum(crisis_with_na$Action.Obligation,na.rm=TRUE)
# 
crisis_smp<-crisis_with_na[complete,]
# # 
# head(crisis_smp)
save(crisis_smp,crisis_with_na,file="Data\\crisis_smp.Rdata")
# load("Data\\crisis_smp.Rdata")

```

The sample is created by including the entirity of the ARRA and Disaster datasets, as well as 100,000 records each from the OCO datase and another 100,000 from all remaining records.

#Initial Logit Model

##Crisis Dataset
### 01A Crisis Dataset
```{r Model01A}
levels(crisis_smp$MaxOfDecisionTree)[levels(crisis_smp$MaxOfDecisionTree)=="Excluded"]<-
  "None"
crisis_smp$MaxOfDecisionTree[is.na(crisis_smp$MaxOfDecisionTree)]<-"None"
#Frequency Plot
freq_discrete_cbre_plot(crisis_smp,"MaxOfDecisionTree")

#Percent Terminated Plot
discrete_percent_cbre_plot(crisis_smp,"MaxOfDecisionTree")

#Model
CBre_11A <- glm (data=crisis_smp,
                 b_CBre ~ Crisis, family=binomial(link="logit"))
display(CBre_11A)



```
In line with literature, crisis contracting is higher risk than conventional contracting, with all three datasets having a termination rate well above the termination rate for the remaining contracts. OCO is closest to that typical rate.

## Competition Variables

Competition has the potential to reduce terminations by giving the government more options in vendors and encouraging better behavior from the contractor that was chosen. 
### 02A: No Competition / Competition
```{r Model02A}

#Terminations
gridExtra::grid.arrange(freq_discrete_term_plot(crisis_smp,"Comp"),
                        discrete_percent_term_plot(crisis_smp,"Comp"))

gridExtra::grid.arrange(freq_discrete_term_plot(crisis_smp,"Urg"),
                        discrete_percent_term_plot(crisis_smp,"Urg"))


#Ceiling Breaches
gridExtra::grid.arrange(freq_discrete_cbre_plot(crisis_smp,"Comp"),
             discrete_percent_cbre_plot(crisis_smp,"Comp"))

gridExtra::grid.arrange(freq_discrete_cbre_plot(crisis_smp,"Urg"),
             discrete_percent_cbre_plot(crisis_smp,"Urg"))



#Model
CBre_02A <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +cb_Comp, family=binomial(link="logit"))
display(CBre_02A)

Term_02A <- glm (data=crisis_smp,
                 b_Term ~ Crisis +cb_Comp, family=binomial(link="logit"))
display(Term_02A)


stargazer::stargazer(CBre_02A,Term_02A,type="text",
                     digits=2)


#Plot the fitted values vs actual results
gridExtra::grid.arrange(binned_fitted_versus_cbre_residuals(CBre_02A),
                        binned_fitted_versus_term_residuals(Term_02A)
                        )

# residuals_cbre_plot(CBre_02A)+
  # labs(x="Estimated  Pr (Ceiling Breach)"),
# residuals_cbre_plot(Term_02A)+
  # labs(x="Estimated  Pr (Termination)"),


#Plot residuals versus fitted
# residuals_cbre_plot(CBre_07B)+
  # labs(x="Estimated  Pr (Ceiling Breach)")

# residuals_cbre_plot(CBre_07B,"cl_Ceil")+
  # labs(x="Centered Log(Ceiling)")
  

```
Binary competition is associated with a significantly decreased risk of ceiling breaches but a slightly greater risk of terminations. Urgency is associated with a lower risk of termination and a lower risk of ceiling breaches, though neither is significant. The increased risk of ceiling breach is the only finding in line with the hypotheses. The next step is to add interactions between the competition and the crisis datasets.


### 02B: No Competition / Competition
```{r Model02B}

#Ceiling Breaches
gridExtra::grid.arrange(freq_discrete_cbre_plot(crisis_smp,"Comp","Crisis"),
                        discrete_percent_cbre_plot(crisis_smp,"Comp","Crisis"))
                        
#Terminations
gridExtra::grid.arrange(freq_discrete_term_plot(crisis_smp,"Comp","Crisis"),
                        discrete_percent_term_plot(crisis_smp,"Comp","Crisis"))


#Model
CBre_02B <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +cb_Comp +
                   cb_Comp:Crisis, 
                 family=binomial(link="logit"))
display(CBre_02B)

Term_02B <- glm (data=crisis_smp,
                 b_Term ~ Crisis +cb_Comp +
                   cb_Comp:Crisis, 
                 family=binomial(link="logit"))
display(Term_02B)


stargazer::stargazer(CBre_02B,Term_02B,type="text",
                     digits=2)



#Plot the new variable and coefficients
#Add the fitted regression line
discrete_fitted_cbre_model(crisis_smp,"cb_Comp") + 
  stat_function(fun = fit_curve, args=list(a=coef(CBre_02B)[1],                                                        b=coef(CBre_02B)[2]),color="blue")
str(crisis_smp)


```

The results are complicated. With the interactions, terminations are now associated with competition, but for all three crisis datasets, competition counters this relationship. Things are more complex with ceiing breahes, where the interaction of competition with ARRA and OCO is associated with a lower likelihood of a breach, but the relationship goes the other way for disasters.

The next step is to look at a more detailed model, where single offer competition is broken out as a middle option between competition and no competion.


### 02C: No Competition / Single Offer / Competition
```{r Model02C}

#Ceiling Breaches
gridExtra::grid.arrange(freq_discrete_cbre_plot(crisis_smp,"EffComp"),
             discrete_percent_cbre_plot(crisis_smp,"EffComp"))


#Terminations
gridExtra::grid.arrange(freq_discrete_term_plot(crisis_smp,"EffComp"),
                        discrete_percent_term_plot(crisis_smp,"EffComp"))





#Model
CBre_02C <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +n_Comp ,
                 family=binomial(link="logit"))
display(CBre_02C)

Term_02C <- glm (data=crisis_smp,
                 b_Term ~ Crisis +n_Comp ,
                 family=binomial(link="logit"))
display(Term_02C)


stargazer::stargazer(CBre_02C,Term_02C,type="text",
                     digits=2)




#Plot the Fitted
#Add the fitted regression line
# discrete_fitted_cbre_model(crisis_smp,"n_Comp") +
#   stat_function(fun = fit_curve, args=list(a=coef(CBre_02C)[1],
#                                            b=coef(CBre_02C)[2]),
#                 color="blue")




```
The results when single-offer and multi-offer competition are split are quite odd and somewhat peculiar to the crisis datasets.

### 02D: No Competition / Single Offer / Competition
```{r Model02D}


#Ceiling Breaches
gridExtra::grid.arrange(freq_discrete_cbre_plot(crisis_smp,"EffComp","Crisis"),
             discrete_percent_cbre_plot(crisis_smp,"EffComp","Crisis"))


#Terminations
gridExtra::grid.arrange(freq_discrete_term_plot(crisis_smp,"EffComp","Crisis"),
                        discrete_percent_term_plot(crisis_smp,"EffComp","Crisis"))


#Model
CBre_02D <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +n_Comp+
                   ARRA:n_Comp + Dis:n_Comp + OCO:n_Comp,
                 family=binomial(link="logit"))
display(CBre_02D)

Term_02D <- glm (data=crisis_smp,
                 b_Term ~ Crisis +n_Comp+
                   ARRA:n_Comp + Dis:n_Comp + OCO:n_Comp,
                 family=binomial(link="logit"))
display(Term_02D)


stargazer::stargazer(CBre_02D,Term_02D,type="text",
                     digits=2)



#Plot the Fitted
#Add the fitted regression line
# discrete_fitted_cbre_model(crisis_smp,"n_Comp") +
#   stat_function(fun = fit_curve, args=list(a=coef(CBre_02D)[1],
#                                            b=coef(CBre_02D)[2]),
#                 color="blue")




```
These results confirm that it is the crisis datasets that drive this phenomenon, but 

The correlation between the three categories of competition has a larger  coefficent and standard error, in a perplexing direction. The next step looks at the number of offers in greater detail.

### 02E: No Competition / Number of Offer Categories 
```{r Model02E}
#Ceiling Breaches
gridExtra::grid.arrange(freq_discrete_cbre_plot(crisis_smp,"CompOffr"),
             discrete_percent_cbre_plot(crisis_smp,"CompOffr"))


#Terminations
gridExtra::grid.arrange(freq_discrete_term_plot(crisis_smp,"CompOffr"),
                        discrete_percent_term_plot(crisis_smp,"CompOffr"))



#Model
CBre_02E <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +cn_Offr, family=binomial(link="logit"))
display(CBre_02E)

Term_02E <- glm (data=crisis_smp,
                 b_Term ~ Crisis +cn_Offr, family=binomial(link="logit"))
display(Term_02E)

stargazer::stargazer(CBre_02E,Term_02E,type="text",
                     digits=2)


```

The more detailed breakout still doesn't make a great deal of sense.

### 02F: No Competition / Number of Offer Categories 
```{r Model02F}

#Ceiling Breaches
gridExtra::grid.arrange(freq_discrete_cbre_plot(crisis_smp,"CompOffr","Crisis"),
             discrete_percent_cbre_plot(crisis_smp,"CompOffr","Crisis"))


#Terminations
gridExtra::grid.arrange(freq_discrete_term_plot(crisis_smp,"CompOffr","Crisis"),
                        discrete_percent_term_plot(crisis_smp,"CompOffr","Crisis"))


#Model
CBre_02F <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +n_Comp+
                   ARRA:n_Comp + Dis:n_Comp + OCO:n_Comp,
                 family=binomial(link="logit"))
display(CBre_02F)

Term_02F <- glm (data=crisis_smp,
                 b_Term ~ Crisis +n_Comp+
                   ARRA:n_Comp + Dis:n_Comp + OCO:n_Comp,
                 family=binomial(link="logit"))
display(Term_02F)


stargazer::stargazer(CBre_02F,Term_02F,type="text",
                     digits=2)



#Plot the Fitted
#Add the fitted regression line
# discrete_fitted_cbre_model(crisis_smp,"n_Comp") +
#   stat_function(fun = fit_curve, args=list(a=coef(CBre_02F)[1],
#                                            b=coef(CBre_02F)[2]),
#                 color="blue")




```
The patterns are roughly similar to those found when only single offer competition is broken out, unfortunately the greater detail is not that illuminating.

### 02G: Number of Offer Categories 
```{r Model02G}

#Ceiling Breaches
gridExtra::grid.arrange(freq_continuous_cbre_plot(crisis_smp,"l_Offr"),
             binned_percent_cbre_plot(crisis_smp,"l_Offr"))


#Terminations
gridExtra::grid.arrange(freq_continuous_term_plot(crisis_smp,"l_Offr"),
                        binned_percent_term_plot(crisis_smp,"l_Offr"))


#Vehicle Crossreference
gridExtra::grid.arrange(binned_percent_cbre_plot(crisis_smp,"l_Offr","Veh"),
                        binned_percent_term_plot(crisis_smp,"l_Offr","Veh"))




#Percent Terminated Plot
binned_percent_cbre_plot(crisis_smp,"l_Offr","Veh")


#Model
CBre_02G <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +cl_Offr, family=binomial(link="logit"))
display(CBre_02G)

Term_02G <- glm (data=crisis_smp,
                 b_Term ~ Crisis +cl_Offr, family=binomial(link="logit"))
display(Term_02G)

stargazer::stargazer(CBre_02G,Term_02G,type="text",
                     digits=2)

#Plot the data and fitted curve
CBre_02G_plot<-ggplot(data=crisis_smp,
       aes(y=j_Term,x=cl_Offr))+geom_jitter(alpha=0.11,height=0)+scale_y_sqrt() +
  labs(title="Fitted Linear Model", caption="Source: FPDS, CSIS Analysis")

#Plot the Fitted
#Add the fitted regression line
discrete_fitted_cbre_model(crisis_smp,"cl_Offr") +
  stat_function(fun = fit_curve, args=list(a=coef(CBre_02G)[1],
                                           b=coef(CBre_02G)[2]),
                             color="blue")

#Plot the fitted values vs actual results
gridExtra::grid.arrange(binned_fitted_versus_cbre_residuals(CBre_02G),
                        binned_fitted_versus_term_residuals(Term_02G))



#Plot residuals versus fitted
gridExtra::grid.arrange(residuals_cbre_plot(CBre_02G,bins=3)+
  labs(x="Estimated  Pr (Ceiling Breach)"),
                        residuals_term_plot(Term_02G,bins=3)+
  labs(x="Estimated  Pr (Termination)"))






```
Similar story with number of offers. Closer examination finds that the nature of the relationship varies greatly depending on the contract vehicle. 


### 02H: Number of Offer Categories 
```{r Model02H}


#Ceiling Breaches
gridExtra::grid.arrange(freq_continuous_cbre_plot(crisis_smp,"l_Offr","Crisis"),
             binned_percent_cbre_plot(crisis_smp,"l_Offr","Crisis"))


#Terminations
gridExtra::grid.arrange(freq_continuous_term_plot(crisis_smp,"l_Offr","Crisis"),
                        binned_percent_term_plot(crisis_smp,"l_Offr","Crisis"))



#Model
CBre_02H <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +cl_Offr+
                   cl_Offr:ARRA + cl_Offr:Dis + cl_Offr:OCO, family=binomial(link="logit"))
display(CBre_02H)

#Model
Term_02H <- glm (data=crisis_smp,
                 b_Term ~ Crisis +cl_Offr+
                   cl_Offr:ARRA + cl_Offr:Dis + cl_Offr:OCO, family=binomial(link="logit"))
display(Term_02H)
stargazer::stargazer(CBre_02H,Term_02H,type="text",
                     digits=2)

#Variant Model
crisis_smp$clsqr_Offer<-crisis_smp$cl_Offr^2
CBre_11E <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +cl_Offr +clsqr_Offer, family=binomial(link="logit"))
display(CBre_11E)

#Plot the data and fitted curve
CBre_02H_plot<-ggplot(data=crisis_smp,
       aes(y=j_Term,x=cl_Offr))+geom_jitter(alpha=0.11,height=0)+scale_y_sqrt() +
  labs(title="Fitted Linear Model", caption="Source: FPDS, CSIS Analysis")

#Plot the Fitted
#Add the fitted regression line
discrete_fitted_cbre_model(crisis_smp,"cl_Offr") +
  stat_function(fun = fit_curve, args=list(a=coef(CBre_02H)[1],
                                           b=coef(CBre_02H)[2]),
                             color="blue")


#Plot the fitted values vs actual results
gridExtra::grid.arrange(binned_fitted_versus_cbre_residuals(CBre_02G),
                        binned_fitted_versus_term_residuals(Term_02G))



#Plot residuals versus fitted
gridExtra::grid.arrange(residuals_cbre_plot(CBre_02G,bins=5)+
  labs(x="Estimated  Pr (Ceiling Breach)"),
                        residuals_term_plot(Term_02G,bins=5)+
  labs(x="Estimated  Pr (Termination)"))






```
Interestingly, unlike prior models, the interactios with the log of the number of offers now all have positive coefficient. After all this analysis, sticking with binary competition seems the best choice. The next step will be to add in a consideration of non-competition for urgency reasons.



### 02I: No Competition / Competition
```{r Model02I}

#Ceiling Breaches
gridExtra::grid.arrange(freq_discrete_cbre_plot(crisis_smp,"Urg"),
                        discrete_percent_cbre_plot(crisis_smp,"Urg"))
                        
#Terminations
gridExtra::grid.arrange(freq_discrete_term_plot(crisis_smp,"Urg"),
                        discrete_percent_term_plot(crisis_smp,"Urg"))


#Model
CBre_02I <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   cb_Comp:Crisis, 
                 family=binomial(link="logit"))
display(CBre_02I)

Term_02I <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   cb_Comp:Crisis, 
                 family=binomial(link="logit"))
display(Term_02I)


stargazer::stargazer(CBre_02B,CBre_02I,Term_02B,Term_02I,type="text",
                     digits=2)



#Plot the new variable and coefficients
#Add the fitted regression line
discrete_fitted_cbre_model(crisis_smp,"cb_Comp") + 
  stat_function(fun = fit_curve, args=list(a=coef(CBre_02I)[1],                                                        b=coef(CBre_02I)[2]),color="blue")
str(crisis_smp)


#Plot the fitted values vs actual results
gridExtra::grid.arrange(binned_fitted_versus_cbre_residuals(CBre_02I),
                        binned_fitted_versus_term_residuals(Term_02I))



#Plot residuals versus fitted
gridExtra::grid.arrange(residuals_cbre_plot(CBre_02I,bins=3)+
  labs(x="Estimated  Pr (Ceiling Breach)"),
                        residuals_term_plot(Term_02I,bins=3)+
  labs(x="Estimated  Pr (Termination)"))



```
Urgency estimates a higher probability of ceiling breaches and a lower probability of terminations, but the coefficients are small and not significant.

### 02J: No Competition / Competition
```{r Model02J}

#Ceiling Breaches
gridExtra::grid.arrange(freq_discrete_cbre_plot(crisis_smp,"Urg","Crisis"),
                        discrete_percent_cbre_plot(crisis_smp,"Urg","Crisis"))
                        
#Terminations
gridExtra::grid.arrange(freq_discrete_term_plot(crisis_smp,"Urg","Crisis"),
                        discrete_percent_term_plot(crisis_smp,"Urg","Crisis"))


#Model
CBre_02J <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   NoComp:Crisis, 
                 family=binomial(link="logit"))
display(CBre_02J)

Term_02J <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   NoComp:Crisis, 
                 family=binomial(link="logit"))
display(Term_02J)


stargazer::stargazer(CBre_02B,CBre_02I,CBre_02J,Term_02B,Term_02I,Term_02J,type="text",
                     digits=2)



#Plot the new variable and coefficients
#Add the fitted regression line
discrete_fitted_cbre_model(crisis_smp,"cb_Comp") + 
  stat_function(fun = fit_curve, args=list(a=coef(CBre_02I)[1],                                                        b=coef(CBre_02I)[2]),color="blue")
str(crisis_smp)


#Plot the fitted values vs actual results
gridExtra::grid.arrange(binned_fitted_versus_cbre_residuals(CBre_02J),
                        binned_fitted_versus_term_residuals(Term_02J))



#Plot residuals versus fitted
gridExtra::grid.arrange(residuals_cbre_plot(CBre_02J,bins=3)+
  labs(x="Estimated  Pr (Ceiling Breach)"),
                        residuals_term_plot(Term_02J,bins=3)+
  labs(x="Estimated  Pr (Termination)"))




```
The interaction of OCO and urgency is perhaps most interesting, as it is significantly associated with higher rates of contract termiantion. That said, the small sample sizes result in large standard errors.  However, because Urgency and competition are mutually exclusive dummy variables, we'll leave them in for all.

## Undefinited Contract Awards

### 03A: Undefinitized Contract Awards
Undefinitized Contract Awards allow for quick action in situations where there is not time or information to establish all of a contracts properties at the time of signing. They have been found by the GAO and the Performance of the Defense Acquisition studies to contain notable risks, primarily    relating to cost overruns. Will these risks also carry into terminations?

```{r Model03A}

#Ceiling Breaches
gridExtra::grid.arrange(freq_discrete_cbre_plot(crisis_smp,"UCA"),
                        discrete_percent_cbre_plot(crisis_smp,"UCA"))
                        
#Terminations
gridExtra::grid.arrange(freq_discrete_term_plot(crisis_smp,"UCA"),
                        discrete_percent_term_plot(crisis_smp,"UCA"))


#Model
CBre_03A <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                  NoComp:Crisis, 
                 family=binomial(link="logit"))
display(CBre_03A)

Term_03A <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                  NoComp:Crisis, 
                 family=binomial(link="logit"))
display(Term_03A)


stargazer::stargazer(CBre_02J,CBre_03A,Term_02J,Term_03A,type="text",
                     digits=2)
# Plot the model and Vehicle 
CBre_03A_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV) %*%  coef(CBre_03A))}

#Days curves
discrete_fitted_cbre_model(crisis_smp,"SIDV") +
  stat_function(fun = CBre_03A_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")+
  stat_function(fun = CBre_03A_curve,
                             args=list(Comp=2,Ceil=0,Days=1,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")



#Plot the fitted values vs actual results
gridExtra::grid.arrange(binned_fitted_versus_cbre_residuals(CBre_03A),
                        binned_fitted_versus_term_residuals(Term_03A))



#Plot residuals versus fitted
gridExtra::grid.arrange(residuals_cbre_plot(CBre_03A,bins=3)+
  labs(x="Estimated  Pr (Ceiling Breach)"),
                        residuals_term_plot(Term_03A,bins=3)+
  labs(x="Estimated  Pr (Termination)"))




# residuals_cbre_plot(CBre_02F,"cl_days")+
#   labs(x="Centered Log(Days)")

```


### 03B: UCA and Crisis

```{r Model03B}

#Ceiling Breaches
gridExtra::grid.arrange(freq_discrete_cbre_plot(crisis_smp,"UCA","Crisis"),
                        discrete_percent_cbre_plot(crisis_smp,"UCA","Crisis"))
                        
#Terminations
gridExtra::grid.arrange(freq_discrete_term_plot(crisis_smp,"UCA","Crisis"),
                        discrete_percent_term_plot(crisis_smp,"UCA","Crisis"))



#Ceiling Breaches
gridExtra::grid.arrange(freq_discrete_cbre_plot(crisis_smp,"UCA","Comp"),
                        discrete_percent_cbre_plot(crisis_smp,"UCA","Comp"))
                        
#Terminations
gridExtra::grid.arrange(freq_discrete_term_plot(crisis_smp,"UCA","Comp"),
                        discrete_percent_term_plot(crisis_smp,"UCA","Comp"))



#Create the model
#Model
CBre_03B <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                  NoComp:Crisis+
                   b_UCA:Crisis , 
                 family=binomial(link="logit"))
display(CBre_03B)

Term_03B <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                  NoComp:Crisis+
                   b_UCA:Crisis , 
                 family=binomial(link="logit"))
display(Term_03B)


stargazer::stargazer(CBre_03A,CBre_03B,Term_03A,Term_03B,type="text",
                     digits=2)


#Days curves
discrete_fitted_cbre_model(crisis_smp,"SIDV") +
  stat_function(fun = CBre_03B_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")+
  stat_function(fun = CBre_03B_curve,
                             args=list(Comp=2,Ceil=0,Days=1,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")


#Plot the fitted values vs actual results
gridExtra::grid.arrange(binned_fitted_versus_cbre_residuals(CBre_03B),
                        binned_fitted_versus_term_residuals(Term_03B))



#Plot residuals versus fitted
gridExtra::grid.arrange(residuals_cbre_plot(CBre_03B,bins=3)+
  labs(x="Estimated  Pr (Ceiling Breach)"),
                        residuals_term_plot(Term_03B,bins=3)+
  labs(x="Estimated  Pr (Termination)"))

# residuals_cbre_plot(CBre_02F,"cl_days")+
  # labs(x="Centered Log(Days)")

```
In exploratory graphs, the interaction of UCA and appear to be largely absent for breaches and while present for terminations, given that competition for terminations has a small coefficient and is not significant, it's probably not time to add an interaction. Instead this step adds an interaction between UCAs and crisis funds. The result is striking, in all cases, UCAs for crisis funds have lower correlation with negative outcomes than those in the general contract population. In many cases, the coefficient is sufficient to cancel out much of the estimate for UCA directly, although for OCO ceiling breaches the coefficient is only reduced by roughly a half.

## Reachback Contracting


### 04A: Off. Crisis %


```{r Model04A}

summary_continuous_plot(crisis_smp,"CrisisPercent",bins=50)


#Ceiling Breaches
gridExtra::grid.arrange(freq_continuous_cbre_plot(crisis_smp,"c_OffCri"),
             binned_percent_cbre_plot(crisis_smp,"c_OffCri")+geom_vline(xintercept=c(0.1,0.10,0.25)))


#Terminations
gridExtra::grid.arrange(freq_continuous_term_plot(crisis_smp,"c_OffCri"),
                        binned_percent_term_plot(crisis_smp,"c_OffCri")+geom_vline(xintercept=c(0.1,0.10,0.25)))


#Model

CBre_04A <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+c_OffCri+ 
                  NoComp:Crisis+
                   b_UCA:Crisis , 
                 family=binomial(link="logit"))
display(CBre_04A)

Term_04A <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+c_OffCri+
                  NoComp:Crisis+
                   b_UCA:Crisis , 
                 family=binomial(link="logit"))
display(Term_04A)



stargazer::stargazer(CBre_03B,CBre_04A,Term_03B,Term_04A,type="text",
                     digits=2)
# Plot the model and Vehicle 
CBre_04A_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV) %*%  coef(CBre_04A))}

#Days curves
discrete_fitted_cbre_model(crisis_smp,"SIDV") +
  stat_function(fun = CBre_04A_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")+
  stat_function(fun = CBre_04A_curve,
                             args=list(Comp=2,Ceil=0,Days=1,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")


summary_residual_compare(CBre_03B,CBre_04A,Term_03B,Term_04A,bins=NA)
```
Adding the confirmed crisis percent for contracting offices does align with the reachback hypothesis, with a large and significant coefficient for both terminations and ceiling breaches. The coefficient is small enough that we are not exploring interactions at this time. The next step is to look at contracting office location instead.

### 04B: OffPl. Score
```{r Model04B}

summary_continuous_plot(crisis_smp,"OffIntl",bins=50)
summary_continuous_plot(crisis_smp,"OffIntl","Crisis",bins=50)

#Model
CBre_04B <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffIntl+
                  NoComp:Crisis+

                   b_UCA:Crisis , 
                 family=binomial(link="logit"))
display(CBre_04B)

Term_04B <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+OffIntl+
                  NoComp:Crisis+

                   b_UCA:Crisis , 
                 family=binomial(link="logit"))
display(Term_04B)


stargazer::stargazer(CBre_03B,CBre_04B,Term_03B,Term_04B,type="text",
                     digits=2)
# Plot the model and Vehicle 
CBre_04B_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV) %*%  coef(CBre_04B))}

#Days curves
discrete_fitted_cbre_model(crisis_smp,"SIDV") +
  stat_function(fun = CBre_04B_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")+
  stat_function(fun = CBre_04B_curve,
                             args=list(Comp=2,Ceil=0,Days=1,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")



#Plot the fitted values vs actual results
gridExtra::grid.arrange(binned_fitted_versus_cbre_residuals(CBre_04B),
                        binned_fitted_versus_term_residuals(Term_04B))



#Plot residuals versus fitted
gridExtra::grid.arrange(residuals_cbre_plot(CBre_04B,bins=10)+
  labs(x="Estimated  Pr (Ceiling Breach)"),
                        residuals_term_plot(Term_04B,bins=10)+
  labs(x="Estimated  Pr (Termination)"))




#Plot residuals versus ceiling
gridExtra::grid.arrange(residuals_cbre_plot(CBre_04B,"OffIntl",bins=10)+
  labs(x="Centered Log(Ceiling)"),
                        residuals_term_plot(Term_04B,"OffIntl",bins=10)+
  labs(x="Centered Log(Ceiling)"))

# residuals_cbre_plot(CBre_02F,"cl_days")+
#   labs(x="Centered Log(Days)")
summary_residual_compare(CBre_03B,CBre_04B,Term_03B,Term_04B,NA)
summary_residual_compare(CBre_04A,CBre_04B,Term_04A,Term_04B,NA)

```
The measure of location of the contracting office, with scores from 0 (place of performance entirely U.S.) to 1 (place of performance entirely international) is most relevant to OCO. Initially contrary to the hypothesis, the termination  rate appears higher at home than in field offices. The coefficient for base OCO contracting also rises strikingly. The results for ceiling breaches are not significant.

### 04C: Both OffPl. Score & Crisis %


```{r Model04C}
summary_double_continuous(crisis_smp,"OffIntl","c_OffCri")


summary_continuous_plot(crisis_smp,"OffIntl","Crisis",bins=40)

#Model
CBre_04C <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffIntl+c_OffCri+
                  NoComp:Crisis+
                   b_UCA:Crisis,
                 family=binomial(link="logit"))
display(CBre_04C)

Term_04C <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffIntl+c_OffCri+
                  NoComp:Crisis+
                   b_UCA:Crisis,
                 family=binomial(link="logit"))
display(Term_04C)


stargazer::stargazer(CBre_04A,CBre_04B,CBre_04C,Term_04A,Term_04B,Term_04C,type="text",
                     digits=2)
# Plot the model and Vehicle 
CBre_04C_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV) %*%  coef(CBre_04C))}

#Days curves
discrete_fitted_cbre_model(crisis_smp,"SIDV") +
  stat_function(fun = CBre_04C_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")+
  stat_function(fun = CBre_04C_curve,
                             args=list(Comp=2,Ceil=0,Days=1,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")

summary_residual_compare(CBre_04A,CBre_04C,Term_04A,Term_04C)
summary_residual_compare(CBre_04B,CBre_04C,Term_04B,Term_04C)

```
When both variables are in place, international offices have singificantly lower rates of negative outcomes, but for percent crisis spending remains supportive of the hypothesis, albeit with a small coefficient. This model reduces deviance for ceiling breaches by just a little, but for terminations the games are more subtantial, albeit accompanied by an increase in residuals.


### 04D: OffPl. 99% 

```{r Model04D}
crisis_smp$OffIntl
OffIntl

quantile(fed$OffIntl,c(0.1,0.25,0.33,0.4,0.45,0.5,0.6,0.66,0.7,0.75,0.8),na.rm = TRUE)
quantile(crisis_smp$OffIntl,c(0.25,0.5,0.6,0.66,0.7,0.75,0.8),na.rm = TRUE)



summary(crisis_smp$OffPl99)





#Three place categories
summary_discrete_plot(crisis_smp,"OffPl99")
summary_continuous_plot(crisis_smp,"OffIntl",bins=100)


# summary_continuous_plot(crisis_smp,"sqrt_OffIntl",bins=100)


#Crisis
summary_discrete_plot(crisis_smp,"OffPl99","Crisis")
summary_continuous_plot(crisis_smp,"OffIntl","Crisis",bins=100)
# summary_continuous_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=100)




#Office Place
#Ceiling Breaches
gridExtra::grid.arrange(freq_continuous_cbre_plot(crisis_smp,"sqrt_OffIntl",bins=50)+aes(fill=OffPl99)+geom_vline(xintercept=c(0.1,1.73)),
             binned_percent_cbre_plot(crisis_smp,"sqrt_OffIntl",bins=50)+geom_vline(xintercept=c(0.1,1.73)))


#Terminations
gridExtra::grid.arrange(freq_continuous_term_plot(crisis_smp,"sqrt_OffIntl",bins=50)+aes(fill=OffPl99),
                        binned_percent_term_plot(crisis_smp,"sqrt_OffIntl",bins=50)+geom_vline(xintercept=c(0.1,1.87)))


#Office Place crossreferenced with Crisis
#Ceiling Breaches
gridExtra::grid.arrange(freq_continuous_cbre_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+aes(fill=OffPl99),
             binned_percent_cbre_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+geom_vline(xintercept=c(0.1,1.87)))


#Terminations
gridExtra::grid.arrange(freq_continuous_term_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+aes(fill=OffPl99),
                        binned_percent_term_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+geom_vline(xintercept=c(0.1,1.87)))

#Model
CBre_04D <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+
                  NoComp:Crisis+
                   b_UCA:Crisis, 
                 family=binomial(link="logit"))
display(CBre_04D)

Term_04D <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+
                   NoComp:Crisis+
                   b_UCA:Crisis , 
                 family=binomial(link="logit"))
display(Term_04D)


stargazer::stargazer(CBre_04A,CBre_04C,CBre_04D,Term_04A,Term_04C,Term_04D,type="text",
                     digits=2)
# Plot the model and Vehicle 
CBre_04D_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV) %*%  coef(CBre_04D))}

#Days curves
discrete_fitted_cbre_model(crisis_smp,"SIDV") +
  stat_function(fun = CBre_04D_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")+
  stat_function(fun = CBre_04D_curve,
                             args=list(Comp=2,Ceil=0,Days=1,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")



summary_residual_compare(CBre_04B,CBre_04D,Term_04B,Term_04D)
summary_residual_compare(CBre_04C,CBre_04D,Term_04C,Term_04D)

```
Drawing the line at 0.01 is a judgment call, based on the fact that 25% of contracts have a contracting office with a location score of 0.01 or below. Expanding to federal government wide, the percent is 45. Only about 8% of federal contracts by value are from contracting offices with 0% international contracts.The use of dummy variables greatly improves the interpretability of the model and comparable reduction in deviance, better for ceiling breaches, a bit worse for terminations.
 The next step will be to look at setting the cutt off for the first category to a location score of 0.05 or a minimum of 95% having a place of performance in the United States (the score rises even faster for contingency contracting environments). 

### 04E: Both OffPl. 99% & %

```{r Model04E}

summary_continuous_plot(crisis_smp,"CrisisPercent","OffPl99",bins=50)


sum(crisis_smp$Action.Obligation[ crisis_smp$OffIntl<0.01],na.rm=TRUE)/
  sum(crisis_smp$Action.Obligation,na.rm=TRUE)
sum(crisis_smp$Action.Obligation[ crisis_smp$OffIntl<0.05&
                                   crisis_smp$OffIntl>=0.01],na.rm=TRUE)/
  sum(crisis_smp$Action.Obligation,na.rm=TRUE)
sum(crisis_smp$Action.Obligation[ crisis_smp$OffIntl<0.25&
                                   crisis_smp$OffIntl>=0.05],na.rm=TRUE)/
  sum(crisis_smp$Action.Obligation,na.rm=TRUE)
sum(crisis_smp$Action.Obligation[ crisis_smp$OffIntl>=0.25&
                                   crisis_smp$OffIntl<0.50],na.rm=TRUE)/
  sum(crisis_smp$Action.Obligation,na.rm=TRUE)
sum(crisis_smp$Action.Obligation[ crisis_smp$OffIntl>=0.50],na.rm=TRUE)/
  sum(crisis_smp$Action.Obligation,na.rm=TRUE)


sum(fed$Action.Obligation[ fed$OffIntl<=0.01],na.rm=TRUE)/
  sum(fed$Action.Obligation,na.rm=TRUE)
sum(fed$Action.Obligation[ fed$OffIntl<=0.00],na.rm=TRUE)/
  sum(fed$Action.Obligation,na.rm=TRUE)


summary(crisis_smp$OffPl99)
quantile(crisis_smp$OffIntl,c(0.25,0.5,0.6,0.66,0.7,0.75,0.8),na.rm = TRUE)

#Office Place 4 category
#Ceiling Breaches
gridExtra::grid.arrange(freq_discrete_cbre_plot(crisis_smp,"OffPl99"),
                        discrete_percent_cbre_plot(crisis_smp,"OffPl99"))
                        
#Terminations
gridExtra::grid.arrange(freq_discrete_term_plot(crisis_smp,"OffPl99"),
                        discrete_percent_term_plot(crisis_smp,"OffPl99"))



#Ceiling Breaches
gridExtra::grid.arrange(freq_discrete_cbre_plot(crisis_smp,"OffPl99","Crisis"),
                        discrete_percent_cbre_plot(crisis_smp,"OffPl99","Crisis"))
                        
#Terminations
gridExtra::grid.arrange(freq_discrete_term_plot(crisis_smp,"OffPl99","Crisis"),
                        discrete_percent_term_plot(crisis_smp,"OffPl99","Crisis"))



#Office Place
#Ceiling Breaches
gridExtra::grid.arrange(freq_continuous_cbre_plot(crisis_smp,"sqrt_OffIntl",bins=50)+aes(fill=OffPl99),
             binned_percent_cbre_plot(crisis_smp,"sqrt_OffIntl",bins=50)+geom_vline(xintercept=c(0.1,0.25,1.87)))


#Terminations
gridExtra::grid.arrange(freq_continuous_term_plot(crisis_smp,"sqrt_OffIntl",bins=50)+aes(fill=OffPl99),
                        binned_percent_term_plot(crisis_smp,"sqrt_OffIntl",bins=50)+geom_vline(xintercept=c(0.1,0.25,1.87)))


#Office Place crossreferenced with Crisis
#Ceiling Breaches
gridExtra::grid.arrange(freq_continuous_cbre_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+aes(fill=OffPl99),
             binned_percent_cbre_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+geom_vline(xintercept=c(0.1,0.25,1.87)))


#Terminations
gridExtra::grid.arrange(freq_continuous_term_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+aes(fill=OffPl99),
                        binned_percent_term_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+geom_vline(xintercept=c(0.1,0.25,1.87)))


#Model
CBre_04E <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+c_OffCri+
                  NoComp:Crisis+
                   b_UCA:Crisis, 
                 family=binomial(link="logit"))
display(CBre_04E)

Term_04E <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+c_OffCri+
                  NoComp:Crisis+
                   b_UCA:Crisis, 
                 family=binomial(link="logit"))
display(Term_04E)


stargazer::stargazer(CBre_04C,CBre_04D,CBre_04E,Term_04C,Term_04D,Term_04E,type="text",
                     digits=2)


# Plot the model and Vehicle 
CBre_04B_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV) %*%  coef(CBre_04B))}

#Days curves
discrete_fitted_cbre_model(crisis_smp,"SIDV") +
  stat_function(fun = CBre_04B_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")+
  stat_function(fun = CBre_04B_curve,
                             args=list(Comp=2,Ceil=0,Days=1,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")



summary_residual_compare(CBre_04B,CBre_04E,Term_04B,Term_04E,bins=5)
summary_residual_compare(CBre_04C,CBre_04E,Term_04C,Term_04E,bins=5)
summary_residual_compare(CBre_04D,CBre_04E,Term_04D,Term_04E,bins=5)


# residuals_cbre_plot(CBre_02F,"cl_days")+
#   labs(x="Centered Log(Days)")

```
While the deviance reduction is slightly greater for 

### 04F: OffPl. 95%

```{r Model04F}


crisis_smp$OffPl95<-Hmisc::cut2(crisis_smp$OffIntl,c(0.05,0.75))
summary(crisis_smp$OffPl95)


summary(crisis_smp$OffPl95)
  levels(crisis_smp$OffPl95) <-
    list("US95"=c("[0.00,0.05)"),
         "Mixed"=c("[0.05,0.75)"),
         "Intl"=c("[0.75,1.00]"))

summary_discrete_plot(crisis_smp,"OffPl95")


#Model
CBre_04F <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl95+
                  NoComp:Crisis+

                   b_UCA:Crisis, 
                 family=binomial(link="logit"))
display(CBre_04F)

Term_04F <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl95+
                  NoComp:Crisis+

                   b_UCA:Crisis , 
                 family=binomial(link="logit"))
display(Term_04F)


stargazer::stargazer(CBre_04C,CBre_04E,CBre_04F,Term_04C,Term_04E,Term_04F,type="text",
                     digits=2)


# Plot the model and Vehicle 
CBre_04B_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV) %*%  coef(CBre_04B))}

#Days curves
discrete_fitted_cbre_model(crisis_smp,"SIDV") +
  stat_function(fun = CBre_04B_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")+
  stat_function(fun = CBre_04B_curve,
                             args=list(Comp=2,Ceil=0,Days=1,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")



#Plot the fitted values vs actual results
gridExtra::grid.arrange(binned_fitted_versus_cbre_residuals(CBre_04F),
                        binned_fitted_versus_term_residuals(Term_04F))



#Plot residuals versus fitted
gridExtra::grid.arrange(residuals_cbre_plot(CBre_04F,bins=5)+
  labs(x="Estimated  Pr (Ceiling Breach)"),
                        residuals_term_plot(Term_04F,bins=5)+
  labs(x="Estimated  Pr (Termination)"))


summary_residual_compare(CBre_04C,CBre_04F,Term_04C,Term_04F)
summary_residual_compare(CBre_04D,CBre_04F,Term_04D,Term_04F)
summary_residual_compare(CBre_04E,CBre_04F,Term_04E,Term_04F)


```
The higher standard, with roughly half of contracts falling beneath it, is more interperable, the 5% standard interestingly swaps the sign of the mixed category in both cases, with breaches going from lower to higher risk, and vice versa for terminations. For Iraq/Afghanistan, the lower risk remains in both cases. The 5% standard is more interesting for research purposes because it's better able to capture the theory of reachback contracting offices, ones that are primarily domestic but that do some international support. 

### 04G: Both OffPl. 95% & Crisis %

```{r Model04G}

summary_continuous_plot(crisis_smp,"CrisisPercent","OffPl95",bins=50)



#Office Place crossreferenced with Crisis
#Ceiling Breaches
gridExtra::grid.arrange(freq_continuous_cbre_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+aes(fill=OffPl),
             binned_percent_cbre_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+geom_vline(xintercept=c(0.1,0.5,1.87)))


#Terminations
gridExtra::grid.arrange(freq_continuous_term_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+aes(fill=OffPl),
                        binned_percent_term_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+geom_vline(xintercept=c(0.1,0.5,1.87)))

#Model
CBre_04G <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl95+c_OffCri+
                  NoComp:Crisis+

                   b_UCA:Crisis, 
                 
                 family=binomial(link="logit"))
display(CBre_04G)

Term_04G <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl95+c_OffCri+
                  NoComp:Crisis+

                   b_UCA:Crisis , 
                 family=binomial(link="logit"))
display(Term_04G)


stargazer::stargazer(CBre_04E,CBre_04F,CBre_04G,Term_04E,Term_04F,Term_04G,type="text",
                     digits=2)


# Plot the model and Vehicle 
CBre_04B_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV) %*%  coef(CBre_04B))}

#Days curves
discrete_fitted_cbre_model(crisis_smp,"SIDV") +
  stat_function(fun = CBre_04B_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")+
  stat_function(fun = CBre_04B_curve,
                             args=list(Comp=2,Ceil=0,Days=1,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")

summary_residual_compare(CBre_04C,CBre_04G,Term_04C,Term_04G)
summary_residual_compare(CBre_04E,CBre_04G,Term_04E,Term_04G)
summary_residual_compare(CBre_04F,CBre_04G,Term_04F,Term_04G)


```

The deviation reduction is slightly greater for this version, but the residuals are no better and 04E is somewhat easier to interpret. Pushing that logic further the next step is to look at a simple binary, above or below 50%.
### 04H: OffPl. 50%

```{r Model04H}


crisis_smp$OffPl50<-Hmisc::cut2(crisis_smp$OffIntl,c(0.50))
summary(crisis_smp$OffPl50)


  levels(crisis_smp$OffPl50) <-
    list("US50"=c("[0.0,0.5)"),
         "Intl50"=c("[0.5,1.0]"))


summary(crisis_smp$OffPl50)
  
summary_discrete_plot(crisis_smp,"OffPl50")


#Model
CBre_04H <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl50+
                  NoComp:Crisis+
                   b_UCA:Crisis, 
                 family=binomial(link="logit"))
display(CBre_04H)

Term_04H <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl50+
                  NoComp:Crisis+
                   b_UCA:Crisis , 
                 family=binomial(link="logit"))
display(Term_04H)


stargazer::stargazer(CBre_04F,CBre_04G,CBre_04H,Term_04F,Term_04G,Term_04H,type="text",
                     digits=2)


# Plot the model and Vehicle 
CBre_04B_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV) %*%  coef(CBre_04B))}

#Days curves
discrete_fitted_cbre_model(crisis_smp,"SIDV") +
  stat_function(fun = CBre_04B_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")+
  stat_function(fun = CBre_04B_curve,
                             args=list(Comp=2,Ceil=0,Days=1,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")



#Plot the fitted values vs actual results
gridExtra::grid.arrange(binned_fitted_versus_cbre_residuals(CBre_04H),
                        binned_fitted_versus_term_residuals(Term_04H))



#Plot residuals versus fitted
gridExtra::grid.arrange(residuals_cbre_plot(CBre_04H,bins=5)+
  labs(x="Estimated  Pr (Ceiling Breach)"),
                        residuals_term_plot(Term_04H,bins=5)+
  labs(x="Estimated  Pr (Termination)"))




summary_residual_compare(CBre_04F,CBre_04H,Term_04F,Term_04H, bins=3)
summary_residual_compare(CBre_04G,CBre_04H,Term_04G,Term_04H, bins=3)
```





### 04I: Both OffPl. 50% & Crisis

```{r Model04I}

summary_continuous_plot(crisis_smp,"CrisisPercent","OffPl50",bins=50)



#Office Place crossreferenced with Crisis
#Ceiling Breaches
gridExtra::grid.arrange(freq_continuous_cbre_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+aes(fill=OffPl50),
             binned_percent_cbre_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+geom_vline(xintercept=c(0.5,1.87)))


#Terminations
gridExtra::grid.arrange(freq_continuous_term_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+aes(fill=OffPl50),
                        binned_percent_term_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+geom_vline(xintercept=c(0.5,1.87)))

#Model
CBre_04I <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl50+c_OffCri+
                  NoComp:Crisis+

                   b_UCA:Crisis, 
                 
                 family=binomial(link="logit"))
display(CBre_04I)

Term_04I <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl50+c_OffCri+
                  NoComp:Crisis+
                   b_UCA:Crisis, 
                 family=binomial(link="logit"))
display(Term_04I)


stargazer::stargazer(CBre_04G,CBre_04H,CBre_04I,Term_04G,Term_04H,Term_04I,type="text",
                     digits=2)


# Plot the model and Vehicle 
CBre_04B_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV) %*%  coef(CBre_04B))}

#Days curves
discrete_fitted_cbre_model(crisis_smp,"SIDV") +
  stat_function(fun = CBre_04B_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")+
  stat_function(fun = CBre_04B_curve,
                             args=list(Comp=2,Ceil=0,Days=1,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")




summary_residual_compare(CBre_04G,CBre_04I,Term_04G,Term_04I)
summary_residual_compare(CBre_04H,CBre_04I,Term_04H,Term_04I, bins=3)
```
Unfortunately, even the simplest of the interactions make interpretation much harder, as the standard errors are huge for Iraq-Afghanistan. The increase in Akaike Inf. Citeria is also worth noting for Terminations.


### 04J: OffPl. 99% & UCA

```{r Model04J}

summary_discrete_plot(crisis_smp,"UCA","OffPl99")
summary_continuous_plot(crisis_smp,"CrisisPercent","UCA",bins=50)
summary_discrete_plot(crisis_smp,"UCA","Crisis")

#Model


CBre_04J <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+c_OffCri+
                   NoComp:Crisis+
                   b_UCA:Crisis+
                   b_UCA:OffPl99, 
                 
                 family=binomial(link="logit"))
display(CBre_04J)

Term_04J <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+c_OffCri+
                   NoComp:Crisis+
                   b_UCA:Crisis+
                   b_UCA:OffPl99 , 
                 family=binomial(link="logit"))
display(Term_04J)


stargazer::stargazer(CBre_04E,CBre_04J,Term_04E,Term_04J,type="text",
                     digits=2)


# Plot the model and Vehicle 
CBre_04B_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV) %*%  coef(CBre_04B))}

#Days curves
discrete_fitted_cbre_model(crisis_smp,"SIDV") +
  stat_function(fun = CBre_04B_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")+
  stat_function(fun = CBre_04B_curve,
                             args=list(Comp=2,Ceil=0,Days=1,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")


summary_residual_compare(CBre_04E,CBre_04J,Term_04E,Term_04J)


```
This doesn't reduce the deviance much, this has already been largely captured by UCA:crisis. Leaving this out. 


### 04K: Off. Crisis % & Crisis

```{r Model04K}


summary_discrete_plot(crisis_smp,"OffPl99","Crisis")
summary_continuous_plot(crisis_smp,"CrisisPercent","Crisis")


#Model
CBre_04K <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  NoComp:Crisis+
                   b_UCA:Crisis+
                   OffPl99:Crisis, 
                 family=binomial(link="logit"))
display(CBre_04K)

Term_04K <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  NoComp:Crisis+
                   b_UCA:Crisis +
                   OffPl99:Crisis, 
                 family=binomial(link="logit"))
display(Term_04K)


stargazer::stargazer(CBre_04E,CBre_04K,Term_04E,Term_04K,type="text",
                     digits=2)

# Plot the model and Vehicle 
CBre_04K_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV) %*%  coef(CBre_04K))}

#Days curves
discrete_fitted_cbre_model(crisis_smp,"SIDV") +
  stat_function(fun = CBre_04K_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")+
  stat_function(fun = CBre_04K_curve,
                             args=list(Comp=2,Ceil=0,Days=1,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")



summary_residual_compare(CBre_04E,CBre_04K,Term_04E,Term_04K,bins=20)



```
The interactions between crisis funding and the percent of the office going to a crisis is strong for ceiling breaches but not significant for terminations other than base ARRA. Office99 mixed loses its significance. The reduction in deviance is substantial for both ceiling breaches and terminations and the residuals do not appear to be adversely effectd.


### 04L: Off. Crisis % & Comp

```{r Model04L}


summary_discrete_plot(crisis_smp,"OffPl99","NoComp")
summary_discrete_plot(crisis_smp,"NoComp","OffPl99")
summary_continuous_plot(crisis_smp,"CrisisPercent","NoComp")


#Model
CBre_04L <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  NoComp:Crisis+
                   b_UCA:Crisis+
                   OffPl99:Crisis+
                   OffPl99:NoComp, 
                 family=binomial(link="logit"))
display(CBre_04L)

Term_04L <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  NoComp:Crisis+
                   b_UCA:Crisis +
                   OffPl99:Crisis+
                   OffPl99:NoComp, 
                 family=binomial(link="logit"))
display(Term_04L)


stargazer::stargazer(CBre_04K,CBre_04L,Term_04I,Term_04L,type="text",
                     digits=2)

# Plot the model and Vehicle 
CBre_04L_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV) %*%  coef(CBre_04L))}

#Days curves
discrete_fitted_cbre_model(crisis_smp,"SIDV") +
  stat_function(fun = CBre_04L_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")+
  stat_function(fun = CBre_04L_curve,
                             args=list(Comp=2,Ceil=0,Days=1,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1),color="blue")



summary_residual_compare(CBre_04K,CBre_04L,Term_04K,Term_04L,20)



```
The addition seems interesting, but is only significant for ceiling breaches 
##Scope Variables
### Ceiling
#### 05A: Cost Ceiling

The model starts by examing the influence of large ceilings on contracts, the core idea here, as observed in the fixed priced paper, is that larger contracts are at greater risk of termination. This can be explained by both the inherent risk in the contract and high transaction costs of contract termination which discourage making the effort for smaller contracts.

```{r Model05A, fig.height = 6.5, fig.width = 6.5}
#Frequency Plot for unlogged ceiling
freq_continuous_cbre_plot(crisis_smp,"UnmodifiedContractBaseAndAllOptionsValue",
               bins=1000)
freq_continuous_cbre_plot(subset(crisis_smp,UnmodifiedContractBaseAndAllOptionsValue<100000000),
               "UnmodifiedContractBaseAndAllOptionsValue",
               bins=1000)

summary_continuous_plot(crisis_smp,"l_Ceil",bins=50)


#Model
CBre_05A <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   NoComp:Crisis+
                   b_UCA:Crisis+
                   OffPl99:Crisis , 
                 family=binomial(link="logit"))
display(CBre_05A)

Term_05A <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   NoComp:Crisis+
                   b_UCA:Crisis+
                   OffPl99:Crisis , 
                 family=binomial(link="logit"))
display(Term_05A)



stargazer::stargazer(CBre_04I,CBre_05A,Term_04I,Term_05A,type="text",
                     digits=2)




#Plot the fitted model plot
CBre_05B_curve<-function(x, Comp){invlogit(cbind(1,Comp,x) %*%  coef(CBre_05B))}

#Competition curves
fitted_cbre_model(crisis_smp,"cl_Ceil") + stat_function(fun = CBre_05B_curve, 
                             args=list(Comp=0),color="blue")+
  stat_function(fun = CBre_05B_curve, 
                             args=list(Comp=2),color="blue")

summary_residual_compare(CBre_04I,CBre_05A,Term_04I,Term_05A)


```

Contract ceiling has a significant relationship, though the residuals show a possible non-linear patterns. This is most remarkable in the positive centered values between 0 and 1. This may be driven  by a missing value and is worth watching.


#### 05B: Cost Ceiling and Crisis

```{r Model05B, fig.height = 10, fig.width = 6.5}


summary_continuous_plot(crisis_smp,"l_Ceil","Crisis")
summary_continuous_plot(crisis_smp,"l_Ceil","c_OffCri")

#Model
CBre_05B <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                  NoComp:Crisis+

                   b_UCA:Crisis+OffPl99:Crisis+OffPl99:NoComp+
                   cl_Ceil:Crisis, 
                 family=binomial(link="logit"))
display(CBre_05B)

Term_05B <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                  NoComp:Crisis+

                   b_UCA:Crisis+OffPl99:Crisis+
                   cl_Ceil:Crisis,
                 family=binomial(link="logit"))
display(Term_05B)



stargazer::stargazer(CBre_05A,CBre_05B,Term_05A,Term_05B,type="text",
                     digits=2)

CBre_05B_curve<-function(x, Comp){invlogit(cbind(1,Comp,x,x^2,Comp*x) %*%  coef(CBre_05B))}

#Competition Curves
fitted_cbre_model(crisis_smp,"cl_Ceil") + stat_function(fun = CBre_05B_curve, 
                             args=list(Comp=0),color="blue")+
  stat_function(fun = CBre_05B_curve, 
                             args=list(Comp=2),color="blue")

summary_residual_compare(CBre_05A,CBre_05B,Term_05A,Term_05B)

```
For the Recovery Act and disasters, higher ceiling contracts are associated with greater contract risk by both measures. For OCO, the greater risk is only the case for terminations. For terminations, the overall risk associated with larger cost ceilings has also vanished.




#### 05C: Cost Ceiling and UCA

```{r Model05C}



summary_continuous_plot(crisis_smp,"l_Ceil","c_OffCri")
summary_continuous_plot(crisis_smp,"l_Ceil","OffPl99")
summary_continuous_plot(crisis_smp,"l_Ceil","UCA")
#Model
CBre_05C <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                  NoComp:Crisis+

                   b_UCA:Crisis+
                   OffPl99:Crisis+OffPl99:NoComp+
                   cl_Ceil:Crisis+
                   cl_Ceil:b_UCA, 
                 family=binomial(link="logit"))
display(CBre_05C)

Term_05C <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                  NoComp:Crisis+

                   b_UCA:Crisis+OffPl99:Crisis+
                   cl_Ceil:Crisis+
                   cl_Ceil:b_UCA, 
                 family=binomial(link="logit"))
display(Term_05C)

texreg::texreg(list(CBre_05A,CBre_05B,CBre_05C,Term_05A,Term_05B,Term_05C))

stargazer::stargazer(CBre_05A,CBre_05B,CBre_05C,Term_05A,Term_05B,Term_05C,type="text",
                     digits=2,keep.stat=c("n","aic","res.dev","null.dev"))

CBre_05C_curve<-function(x, Comp){invlogit(cbind(1,Comp,x,x^2,Comp*x) %*%  coef(CBre_05C))}

#Competition Curves
fitted_cbre_model(crisis_smp,"cl_Ceil") + stat_function(fun = CBre_05C_curve, 
                             args=list(Comp=0),color="blue")+
  stat_function(fun = CBre_05C_curve, 
                             args=list(Comp=2),color="blue")


#Plot the fitted values vs actual results
gridExtra::grid.arrange(binned_fitted_versus_cbre_residuals(CBre_05C),
                        binned_fitted_versus_term_residuals(Term_05C))


summary_residual_compare(CBre_05B,CBre_05C,Term_05B,Term_05C)

```
Low ceiling UCAs are associated with higher risk of ceiling breaches than high ceiling UCAs, though UCAs in general remain associated with high rates of breaches. This relationship is not signicant for terminations. Leaving it off as the deviance reduction is minimal in both cases and the residuals show a greater pattern after introduction. 



#### 05D: Cost Ceiling and Office Place

```{r Model05D}



summary_double_continuous(crisis_smp,"l_Ceil","c_OffCri")
summary_continuous_plot(crisis_smp,"l_Ceil","OffPl99")
summary_continuous_plot(crisis_smp,"l_Ceil","UCA")
#Model
CBre_05D <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                  NoComp:Crisis+

                   b_UCA:Crisis+
                   OffPl99:Crisis+OffPl99:NoComp+
                   cl_Ceil:Crisis+
                   cl_Ceil:OffPl99, 
                 family=binomial(link="logit"))
display(CBre_05D)

Term_05D <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                  NoComp:Crisis+
                   b_UCA:Crisis+
                   OffPl99:Crisis+
                   cl_Ceil:Crisis+cl_Ceil:OffPl99+
                   cl_Ceil:OffPl99, 
                 family=binomial(link="logit"))
display(Term_05D)

# texreg::texreg(list(CBre_05A,CBre_05B,CBre_05D,Term_05A,Term_05B,Term_05D))

stargazer::stargazer(CBre_05B,CBre_05D,Term_05B,Term_05D,type="text",
                     digits=2,keep.stat=c("n","aic","res.dev","null.dev"))

CBre_05D_curve<-function(x, Comp){invlogit(cbind(1,Comp,x,x^2,Comp*x) %*%  coef(CBre_05D))}

#Competition Curves
fitted_cbre_model(crisis_smp,"cl_Ceil") + stat_function(fun = CBre_05D_curve, 
                             args=list(Comp=0),color="blue")+
  stat_function(fun = CBre_05D_curve, 
                             args=list(Comp=2),color="blue")


#Plot the fitted values vs actual results
gridExtra::grid.arrange(binned_fitted_versus_cbre_residuals(CBre_05D),
                        binned_fitted_versus_term_residuals(Term_05D))


summary_residual_compare(CBre_05B,CBre_05D,Term_05B,Term_05D)

```
For Ceiling breaches, the new relationship is significant but also throws off fitted vs. actual values and increases residuals. For terminations, the coefficients are greater and cl_ceiling gains a larger coefficient. It may even be worth considering dropping cl_ceiling:crisis for terminations. Keeping for terminations.



#### 05E: Cost Ceiling and Competition

```{r Model05E}
summary_continuous_plot(crisis_smp,"l_Ceil","NoComp")
#Model
CBre_05E <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                  NoComp:Crisis+

                   b_UCA:Crisis+
                   OffPl99:Crisis+OffPl99:NoComp+
                   cl_Ceil:Crisis+
                 cl_Ceil:NoComp, 
                 family=binomial(link="logit"))
display(CBre_05E)

Term_05E <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                  NoComp:Crisis+
                   b_UCA:Crisis+
                   OffPl99:Crisis+
                   cl_Ceil:Crisis+cl_Ceil:OffPl99+
                   cl_Ceil:OffPl99+
                 cl_Ceil:NoComp, 
                 family=binomial(link="logit"))
display(Term_05E)

# texreg::texreg(list(CBre_05A,CBre_05B,CBre_05E,Term_05A,Term_05B,Term_05E))

stargazer::stargazer(CBre_05B,CBre_05E,Term_05D,Term_05E,type="text",
                     digits=2,keep.stat=c("n","aic","res.dev","null.dev"))

CBre_05E_curve<-function(x, Comp){invlogit(cbind(1,Comp,x,x^2,Comp*x) %*%  coef(CBre_05E))}

#Competition Curves
fitted_cbre_model(crisis_smp,"cl_Ceil") + stat_function(fun = CBre_05E_curve, 
                             args=list(Comp=0),color="blue")+
  stat_function(fun = CBre_05E_curve, 
                             args=list(Comp=2),color="blue")


#Plot the fitted values vs actual results
gridExtra::grid.arrange(binned_fitted_versus_cbre_residuals(CBre_05E),
                        binned_fitted_versus_term_residuals(Term_05E))


summary_residual_compare(CBre_05B,CBre_05E,Term_05D,Term_05E)

```
The intereraction reports that no competition is associated with better outcomes as contract ceilings grow larger. This max reflect bid to win on big contracts. However, the reduction in deviance is only double digit and for both terminations and cost ceiling the magnitude of the residuals grow. Leaving this out.


### Maximum Duration
#### 06A: Maximum Duration

```{r Model06A}
#Frequency Plot for max duration
freq_continuous_cbre_plot(crisis_smp,"UnmodifiedDays",
               bins=1000)



summary_continuous_plot(crisis_smp,"l_Days")


#Model
CBre_06A <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   NoComp:Crisis+
                   b_UCA:Crisis+
                   OffPl99:Crisis+
                   OffPl99:NoComp+
                   cl_Ceil:Crisis, 
                 family=binomial(link="logit"))
display(CBre_06A)

Term_06A <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   NoComp:Crisis+
                   b_UCA:Crisis+
                   OffPl99:Crisis+
                   cl_Ceil:Crisis+
                   cl_Ceil:OffPl99, 
                 family=binomial(link="logit"))
display(Term_06A)


stargazer::stargazer(CBre_05C,CBre_06A,Term_05D,Term_06A,type="text",
                     digits=2)


CBre_06A_curve<-function(x, Comp,Ceil){invlogit(cbind(1,Comp,Ceil,Ceil^2,x,Comp*Ceil) %*%  coef(CBre_06A))}

#Competition Curves
fitted_cbre_model(crisis_smp,"cl_Days") + stat_function(fun = CBre_06A_curve, 
                             args=list(Comp=0,Ceil=0),color="blue")+
  stat_function(fun = CBre_06A_curve, 
                             args=list(Comp=2,Ceil=0),color="blue")

#Ceiling Curves
fitted_cbre_model(crisis_smp,"cl_Days") +  stat_function(fun = CBre_06A_curve, 
                             args=list(Comp=0,Ceil=0),color="blue")+
  stat_function(fun = CBre_06A_curve, 
                             args=list(Comp=0,Ceil=1),color="blue")


summary_residual_compare(CBre_05C,CBre_06A,Term_05C,Term_06A)
```
Duration has significant correlations with both outcome variables, but the coefficient is larger for terminations. The initial model results are surprising as ceiling change direction, reducing and correlates with a lower risk of termiation now, although the interaction between crisis funding and ceiling remains roughly the same. The graph of the fitted values shows that this model The next step will be to look at the interaction of ceiling and duration. The residuals for both ceiling and days do fall out of the 95% confidence interval more than expected and particularly for ceiling breaches show some signs of patterns.

#### 06B: Ceiling and Duration

```{r Mode06B}
debug(summary_double_continuous)
# debug(binned_double_percent_plot)
summary_double_continuous(crisis_smp,"cl_Days","cl_Ceil")

#Model
CBre_06B <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                  NoComp:Crisis+

                   b_UCA:Crisis+OffPl99:Crisis+OffPl99:NoComp+
                   cl_Ceil:Crisis+
                   cl_Ceil:cl_Days, 
                 family=binomial(link="logit"))
display(CBre_06B)

Term_06B <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                  NoComp:Crisis+
                   b_UCA:Crisis+OffPl99:Crisis+
                   cl_Ceil:Crisis+cl_Ceil:OffPl99+
                   cl_Ceil:cl_Days, 
                 family=binomial(link="logit"))
display(Term_06B)



stargazer::stargazer(CBre_06A,CBre_06B,Term_06A,Term_06B,type="text",
                     digits=2)


CBre_06B_curve<-function(x, Comp,Ceil){invlogit(cbind(1,Comp,Ceil,Ceil^2,x,Comp*Ceil) %*%  coef(CBre_06B))}

#Competition Curves
fitted_cbre_model(crisis_smp,"cl_Days") + stat_function(fun = CBre_06B_curve, 
                             args=list(Comp=0,Ceil=0),color="blue")+
  stat_function(fun = CBre_06B_curve, 
                             args=list(Comp=2,Ceil=0),color="blue")

#Ceiling Curves
fitted_cbre_model(crisis_smp,"cl_Days") +  stat_function(fun = CBre_06B_curve, 
                             args=list(Comp=0,Ceil=0),color="blue")+
  stat_function(fun = CBre_06B_curve, 
                             args=list(Comp=0,Ceil=1),color="blue")


summary_residual_compare(CBre_06A,CBre_06B,Term_06A,Term_06B)
```


The interaction of ceiling and duration is correlated with a higher rate of ceiling breaches and no change at all to terminations. The coefficient is minor and the reduction in the deviance of the minor is minimal for ceiling breaches. The results of the interaction also don't make a great deal of sense, as placing a large contract under a tighter schedule is not known for reducing risk. While we hesitate to leave off a significant variable, it contributes little and is not key to the study, leaving it out.


#### 06C: Duration and Crisis
```{r Mode06C}

summary_continuous_plot(crisis_smp,"l_Days","Crisis")

#Model
CBre_06C <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                  NoComp:Crisis+

                   b_UCA:Crisis+OffPl99:Crisis+OffPl99:NoComp+
                   cl_Ceil:Crisis+
                   cl_Days:Crisis, 
                 family=binomial(link="logit"))
display(CBre_06C)

Term_06C <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                  NoComp:Crisis+

                   b_UCA:Crisis+OffPl99:Crisis+
                   cl_Ceil:Crisis+cl_Ceil:OffPl99+
                   cl_Days:Crisis, 
                 family=binomial(link="logit"))
display(Term_06C)



stargazer::stargazer(CBre_06A,CBre_06C,Term_06A,Term_06C,type="text",
                     digits=2)


CBre_06C_curve<-function(x, Comp,Ceil){invlogit(cbind(1,Comp,Ceil,Ceil^2,x,Comp*Ceil) %*%  coef(CBre_06C))}

#Competition Curves
fitted_cbre_model(crisis_smp,"cl_Days") + stat_function(fun = CBre_06C_curve, 
                             args=list(Comp=0,Ceil=0),color="blue")+
  stat_function(fun = CBre_06C_curve, 
                             args=list(Comp=2,Ceil=0),color="blue")

#Ceiling Curves
fitted_cbre_model(crisis_smp,"cl_Days") +  stat_function(fun = CBre_06C_curve, 
                             args=list(Comp=0,Ceil=0),color="blue")+
  stat_function(fun = CBre_06C_curve, 
                             args=list(Comp=0,Ceil=1),color="blue")


summary_residual_compare(CBre_06A,CBre_06C,Term_06A,Term_06C,bins=40)


```
The interaction of Crisis and Duration has a fairly marginal affect. For ARRA and disaster contracts, it iss significantly associated with better outcomes. This is unexpected as regulations seek to minimize the duration of disaster contracts in particular. In keeping with this, for OCO, it significantly associated with ceiling breaches. other forms of contracts. Unfortunately, the addition flattens out the ceiling raise fitted versus outcome. Adding for terminations but not for ceiling breach.


#### 06D: Duration and UCA
```{r Mode06D}
debug(summary_discrete_plot)

summary_continuous_plot(crisis_smp,"l_Days","UCA")

#Model
CBre_06D <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                  NoComp:Crisis+

                   b_UCA:Crisis+OffPl99:Crisis+OffPl99:NoComp+
                   cl_Ceil:Crisis+
                   
                   cl_Days:b_UCA, 
                 family=binomial(link="logit"))
display(CBre_06D)

Term_06D <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                  NoComp:Crisis+

                   b_UCA:Crisis+OffPl99:Crisis+
                   cl_Ceil:Crisis+cl_Ceil:OffPl99+
                   cl_Days:Crisis+
                   cl_Days:b_UCA, 
                 family=binomial(link="logit"))
display(Term_06D)



stargazer::stargazer(CBre_06A,CBre_06D,Term_06C,Term_06D,type="text",
                     digits=2)


CBre_06D_curve<-function(x, Comp,Ceil){invlogit(cbind(1,Comp,Ceil,Ceil^2,x,Comp*Ceil) %*%  coef(CBre_06D))}

#Competition Curves
fitted_cbre_model(crisis_smp,"cl_Days") + stat_function(fun = CBre_06D_curve, 
                             args=list(Comp=0,Ceil=0),color="blue")+
  stat_function(fun = CBre_06D_curve, 
                             args=list(Comp=2,Ceil=0),color="blue")

#Ceiling Curves
fitted_cbre_model(crisis_smp,"cl_Days") +  stat_function(fun = CBre_06D_curve, 
                             args=list(Comp=0,Ceil=0),color="blue")+
  stat_function(fun = CBre_06D_curve, 
                             args=list(Comp=0,Ceil=1),color="blue")


summary_residual_compare(CBre_06A,CBre_06D,Term_06C,Term_06D)


```
Similar to the model of the interaction of ceiling breaches UCA, smaller scope appears to be associated with somewhat greater risk. Unfortunately, the residuals increase in magnitude for ceiling breaches and the deviance is worse than adding a random data for terminations, leaving this variable out.



#### 06E: Duration and Office Place
```{r Mode06E}
summary_double_continuous(crisis_smp,"l_Days","c_OffCri")
summary_continuous_plot(crisis_smp,"l_Days","OffPl99")


#Model
CBre_06E <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                  NoComp:Crisis+

                   b_UCA:Crisis+OffPl99:Crisis+OffPl99:NoComp+
                   cl_Ceil:Crisis+
                   
                   
                   cl_Days:OffPl99, 
                 family=binomial(link="logit"))
display(CBre_06E)

Term_06E <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                  NoComp:Crisis+

                   b_UCA:Crisis+OffPl99:Crisis+
                   cl_Ceil:Crisis+cl_Ceil:OffPl99+
                   cl_Days:Crisis+
                   cl_Days:OffPl99
                   , 
                 family=binomial(link="logit"))
display(Term_06E)



stargazer::stargazer(CBre_06A,CBre_06E,Term_06C,Term_06E,type="text",
                     digits=2)


CBre_06E_curve<-function(x, Comp,Ceil){invlogit(cbind(1,Comp,Ceil,Ceil^2,x,Comp*Ceil) %*%  coef(CBre_06E))}

#Competition Curves
fitted_cbre_model(crisis_smp,"cl_Days") + stat_function(fun = CBre_06E_curve, 
                             args=list(Comp=0,Ceil=0),color="blue")+
  stat_function(fun = CBre_06E_curve, 
                             args=list(Comp=2,Ceil=0),color="blue")

#Ceiling Curves
fitted_cbre_model(crisis_smp,"cl_Days") +  stat_function(fun = CBre_06E_curve, 
                             args=list(Comp=0,Ceil=0),color="blue")+
  stat_function(fun = CBre_06E_curve, 
                             args=list(Comp=0,Ceil=1),color="blue")


summary_residual_compare(CBre_06A,CBre_06E,Term_06C,Term_06E,bins=30)


```
The interaction between duration and locations is shows that in international cases, longer duration is associated with greater risks, though not significantly for ceiling breaches. Interestingly,  in mixed cases the risk is reduced significant. This is may be a mechanism to explain reachback contracting, and also occurs with ceiling terminations, bigger contracts may be easier to handle in mixed contracting offices where there is more capacity. However, the magnitude of the residuals rises with ceiling breaches, so it will only be kept for terminations.


#### 06F: Duration and Competition
```{r Mode06F}
summary_continuous_plot(crisis_smp,"l_Days","NoComp")


#Model
CBre_06F <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   NoComp:Crisis+
                   b_UCA:Crisis+
                   OffPl99:Crisis+OffPl99:NoComp+
                   cl_Ceil:Crisis+
                   cl_Days:NoComp,
                 family=binomial(link="logit"))
display(CBre_06F)

Term_06F <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   NoComp:Crisis+
                   b_UCA:Crisis+
                   OffPl99:Crisis+
                   cl_Ceil:Crisis+
                   cl_Ceil:OffPl99+
                   cl_Days:Crisis+
                   cl_Days:OffPl99+
                   cl_Days:NoComp, 
                 family=binomial(link="logit"))
display(Term_06F)



stargazer::stargazer(CBre_06A,CBre_06F,Term_06E,Term_06F,type="text",
                     digits=2)


CBre_06F_curve<-function(x, Comp,Ceil){invlogit(cbind(1,Comp,Ceil,Ceil^2,x,Comp*Ceil) %*%  coef(CBre_06F))}

#Competition Curves
fitted_cbre_model(crisis_smp,"cl_Days") + stat_function(fun = CBre_06F_curve, 
                             args=list(Comp=0,Ceil=0),color="blue")+
  stat_function(fun = CBre_06F_curve, 
                             args=list(Comp=2,Ceil=0),color="blue")

#Ceiling Curves
fitted_cbre_model(crisis_smp,"cl_Days") +  stat_function(fun = CBre_06F_curve, 
                             args=list(Comp=0,Ceil=0),color="blue")+
  stat_function(fun = CBre_06F_curve, 
                             args=list(Comp=0,Ceil=1),color="blue")


summary_residual_compare(CBre_06A,CBre_06F,Term_06E,Term_06F,bins=30)


```
The  contracts with longer maximum duration when interacting with no competition are associated with better results. However, the residuals are magnified and the residual versus fitted comparisons for ceiling breach are more off the central line. Leaving this out.


##Contract Vehicle
Our dataset includes both stand alone contract awards and task orders that are under larger indefinite delivery vehicles (IDVs). This does fit with literature review findings about the risk of long duration contracts in a crisis, so will be kept in despite its minimal coefficient.

### 07A: Single-Award, Multi-Award, and Other Indefinite Delivery Vehicles


```{r Model07A}

  summary_discrete_plot(crisis_smp,"Veh")

#Model
CBre_07A <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   Veh+
                  NoComp:Crisis+
                   b_UCA:Crisis+
                   OffPl99:Crisis+
                   OffPl99:NoComp+
                   cl_Ceil:Crisis, 
                 family=binomial(link="logit"))
display(CBre_07A)

Term_07A <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                   Veh+
                  NoComp:Crisis+
                   b_UCA:Crisis+
                   OffPl99:Crisis+
                   cl_Ceil:Crisis+
                   cl_Ceil:OffPl99+
                   cl_Days:Crisis+
                   cl_Days:OffPl99
                   , 
                 family=binomial(link="logit"))
display(Term_07A)



stargazer::stargazer(CBre_06A,CBre_07A,Term_06E,Term_07A,type="text",
                     digits=2)


CBre_07A_curve<-function(x, Comp,Ceil){invlogit(cbind(1,Comp,Ceil,Ceil^2,x,Comp*Ceil) %*%  coef(CBre_07A))}

#Competition Curves
fitted_cbre_model(crisis_smp,"cl_Days") + stat_function(fun = CBre_07A_curve, 
                             args=list(Comp=0,Ceil=0),color="blue")+
  stat_function(fun = CBre_07A_curve, 
                             args=list(Comp=2,Ceil=0),color="blue")

#Ceiling Curves
fitted_cbre_model(crisis_smp,"cl_Days") +  stat_function(fun = CBre_07A_curve, 
                             args=list(Comp=0,Ceil=0),color="blue")+
  stat_function(fun = CBre_07A_curve, 
                             args=list(Comp=0,Ceil=1),color="blue")

summary_residual_compare(CBre_06A,CBre_07A,Term_06E,Term_07A)


```

The first check lumps looks at four categories of IDVs, each associated with a notably rate of negative outcomes. The largest negative coefficient varies by measure. Both single award IDCs (S-IDC) and Blanket Purchase Agreements/Basic Order Agreements (BPA/BOA) have singifcant negative coefficients in both categories. Multiple award IDVs have the largest negative coefficient for terminations but the smalling for breaches. FSS/GWAC on the other hand have the smallest coefficent for terminations, but are associated with a lower rate of breaches only a bit smaller in magnuted to S-IDCs or BPA/BOAs. second, and other IDVs third. The deviance of the both models is notably reduced, the main warning bell though is some signs of flattening out in the fitted versus residuals. The residual pattern around 0.5 for log of cost ceiling is still not explained.

The next step is to check the intersections with duration.


### 07B: Vehicle and Duration
```{r Model07B}

  summary_continuous_plot(crisis_smp,"l_Days","Veh")

#Model
CBre_07B <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   Veh+
                  NoComp:Crisis+
                   b_UCA:Crisis+OffPl99:Crisis+OffPl99:NoComp+
                   cl_Ceil:Crisis+
                   cl_Days:Veh, 
                 family=binomial(link="logit"))
display(CBre_07B)

Term_07B <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                   Veh+
                  NoComp:Crisis+
                   b_UCA:Crisis+OffPl99:Crisis+
                   cl_Ceil:Crisis+
                   cl_Ceil:OffPl99+
                   cl_Days:Crisis+
                   cl_Days:OffPl99+
                   cl_Days:Veh                   , 
                 family=binomial(link="logit"))
display(Term_07B)



stargazer::stargazer(CBre_07A,CBre_07B,Term_07A,Term_07B,type="text",
                     digits=2)


# Plot the model and Vehicle for SIDV
CBre_07B_SIDV_curve<-function(x, Comp,Ceil,Days,MIDV,OIDV){invlogit(
  cbind(1,Comp,Ceil,Ceil^2,Days,Days^2,x,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Days*x,Days*MIDV,Days*OIDV) %*%  coef(CBre_07B))}

#Duration curves
discrete_fitted_cbre_model(crisis_smp,"SIDV") +
  stat_function(fun = CBre_07B_SIDV_curve,
                             args=list(Comp=0,Ceil=0,Days=-1,
                                       MIDV=0,OIDV=0),color="blue")+
  stat_function(fun = CBre_07B_SIDV_curve,
                             args=list(Comp=0,Ceil=0,Days=1,
                                       MIDV=0,OIDV=0),color="blue")


CBre_07B_MIDV_curve<-function(x, Comp,Ceil,Days,SIDV,OIDV){invlogit(
  cbind(1,Comp,Ceil,Ceil^2,Days,Days^2,SIDV,x,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Days*SIDV,Days*x,Days*OIDV) %*%  coef(CBre_07B))}

#Plot the model and Vehicle for MIDV
#Duration Curves
discrete_fitted_cbre_model(crisis_smp,"MIDV") +
  stat_function(fun = CBre_07B_MIDV_curve,
                             args=list(Comp=0,Ceil=0,Days=-1,
                                       SIDV=0,OIDV=0),color="blue")+
  stat_function(fun = CBre_07B_MIDV_curve,
                             args=list(Comp=0,Ceil=0,Days=1,
                                       SIDV=0,OIDV=0),color="blue")


CBre_07B_OIDV_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV){invlogit(
  cbind(1,Comp,Ceil,Ceil^2,Days,Days^2,SIDV,MIDV,x,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Days*SIDV,Days*MIDV,Days*x) %*%  coef(CBre_07B))}

#Plot the model and Vehicle for OIDV
#Duration curves
discrete_fitted_cbre_model(crisis_smp,"OIDV") +
  stat_function(fun = CBre_07B_OIDV_curve,
                             args=list(Comp=0,Ceil=0,Days=-1,
                                       SIDV=0,MIDV=0),color="blue")+
  stat_function(fun = CBre_07B_OIDV_curve,
                             args=list(Comp=0,Ceil=0,Days=1,
                                       SIDV=0,MIDV=0),color="blue")


summary_residual_compare(CBre_07A,CBre_07B,Term_07A,Term_07B)



```

1 day contracts are disproportionately common for Defintive Contracts/Purchase Orders, Single-Award ICs, and BPA/BOAs. The interactions between vehicles and duration are full of contrasts. BPA/BOA are the only clearcut categories where the interaction lowers or eliminates the higher risk of negative outcomes that long duration contracts have. For terminations, both single-award IDCs and FSS/GWAC contracts also are associated with lower risk for long contracts, but not to the same degree as BPA/BOA. For ceiling breaches, single-award IDCs have a small but higher risk as contracts go longer but multiaward IDC go inthe opposite direction. Interestingly, the coefficient on multi-award contracts for ceiling breaches also flips direction, they are now more likely to have breaches once interactions with duration are accounted for. 



### 07C: Vehicle and Contract Ceiling
```{r Model07C}

  summary_continuous_plot(crisis_smp,"l_Ceil","Veh")

#Model
CBre_07C <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   Veh+
                  NoComp:Crisis+
                   b_UCA:Crisis+OffPl99:Crisis+
                   OffPl99:NoComp+
                   cl_Ceil:Crisis+
                   cl_Days:Veh+ 
                 cl_Ceil:Veh, 
                 family=binomial(link="logit"))
display(CBre_07C)

Term_07C <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                   Veh+
                  NoComp:Crisis+
                   b_UCA:Crisis+OffPl99:Crisis+
                   cl_Ceil:Crisis+cl_Ceil:OffPl99+
                   cl_Days:Crisis+
                   cl_Days:OffPl99+
                   cl_Days:Veh+ 
                 cl_Ceil:Veh, 
                 family=binomial(link="logit"))
display(Term_07C)



stargazer::stargazer(CBre_07B,CBre_07C,Term_07B,Term_07C,type="text",
                     digits=2)


# Plot the model and Vehicle for SIDV
CBre_07C_SIDV_curve<-function(x, Comp,Ceil,Days,MIDV,OIDV){invlogit(
  cbind(1,Comp,Ceil,Ceil^2,Days,Days^2,x,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV) %*%  coef(CBre_07C))}

#Competition curves
discrete_fitted_cbre_model(crisis_smp,"SIDV") +
  stat_function(fun = CBre_07C_SIDV_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,OIDV=0),color="blue")+
  stat_function(fun = CBre_07C_SIDV_curve,
                             args=list(Comp=2,Ceil=0,Days=0,
                                       MIDV=0,OIDV=0),color="blue")


CBre_07C_MIDV_curve<-function(x, Comp,Ceil,Days,SIDV,OIDV){invlogit(
  cbind(1,Comp,Ceil,Ceil^2,Days,Days^2,SIDV,x,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Days*SIDV,Days*x,Days*OIDV,
        Comp*SIDV,Comp*x,Comp*OIDV) %*%  coef(CBre_07C))}

#Plot the model and Vehicle for MIDV
#Competition Curves
discrete_fitted_cbre_model(crisis_smp,"MIDV") +
  stat_function(fun = CBre_07C_MIDV_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       SIDV=0,OIDV=0),color="blue")+
  stat_function(fun = CBre_07C_MIDV_curve,
                             args=list(Comp=2,Ceil=0,Days=0,
                                       SIDV=0,OIDV=0),color="blue")


CBre_07C_OIDV_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV){invlogit(
  cbind(1,Comp,Ceil,Ceil^2,Days,Days^2,SIDV,MIDV,x,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Days*SIDV,Days*MIDV,Days*x,
        Comp*SIDV,Comp*MIDV,Comp*x) %*%  coef(CBre_07C))}

#Plot the model and Vehicle for OIDV
#Competition curves
discrete_fitted_cbre_model(crisis_smp,"OIDV") +
  stat_function(fun = CBre_07C_OIDV_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       SIDV=0,MIDV=0),color="blue")+
  stat_function(fun = CBre_07C_OIDV_curve,
                             args=list(Comp=2,Ceil=0,Days=0,
                                       SIDV=0,MIDV=0),color="blue")



summary_residual_compare(CBre_07B,CBre_07C,Term_07B,Term_07C,bins=30)



```

Indefinite delivery vehicles, when interacting with contract ceiling, generally have lower ceiling breach rates and termination rates. The big exception is multi-award IDVs for terminations. High ceiling contracts are associated with a significantly higher risk of termination when a multiaward vehicle is used. The effects for the residuals are mixed, but the reduction in model deviance seems sufficient to justify it.

### 07D: Vehicle and Competition

The next step is to check interactions with the contract vehicles. Each has a slightly different approach to competition. For example, the competition for a Single-Award IDV happens at the start of the IDV, after that, contracts awarded through that vehicle go to that single winning vendor.


```{r Model07D}

  summary_discrete_plot(crisis_smp,"NoComp","Veh")

#Model
CBre_07D <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   Veh+
                  NoComp:Crisis+
                   b_UCA:Crisis+OffPl99:Crisis+OffPl99:NoComp+
                   cl_Ceil:Crisis+
                   cl_Days:Veh+ 
                   cl_Ceil:Veh+
                 NoComp:Veh, 
                 family=binomial(link="logit"))
display(CBre_07D)

Term_07D <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                   Veh+
                  NoComp:Crisis+
                   b_UCA:Crisis+OffPl99:Crisis+
                   cl_Ceil:Crisis+cl_Ceil:OffPl99+
                   cl_Days:Crisis+
                   cl_Days:OffPl99+
                   cl_Days:Veh+ 
                   cl_Ceil:Veh+
                 NoComp:Veh, 
                 family=binomial(link="logit"))
display(Term_07D)



stargazer::stargazer(CBre_07C,CBre_07D,Term_07C,Term_07D,type="text",
                     digits=2)




summary_residual_compare(CBre_07D,CBre_07D,Term_07C,Term_07D,20)



```
The average plots did show varying relationships and slopes between different types of vehicles. Uncompeted single-awards and fss/gwacs are associated with more terminations as are uncompeted multiawards/ Urgency exceptions for FSS?GWAC are strongly correlated with a greater risk of ceiling breaches.




##Type of Contract

The next step adds a measure for whether the contract was cost-based or fixed-price. Prior CSIS research has found that fixed-price contracts do face a higher risk of termination across the board.

### 08A: Fixed-Price
```{r Model08A}

  summary_discrete_plot(crisis_smp,"FxCb")

#Model
CBre_08A <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   Veh+
                   n_Fixed +
                  NoComp:Crisis+
                   b_UCA:Crisis+OffPl99:Crisis+OffPl99:NoComp+
                   cl_Ceil:Crisis+
                   cl_Days:Veh+ 
                   cl_Ceil:Veh+
                 NoComp:Veh, 
                 family=binomial(link="logit"))
display(CBre_08A)

Term_08A <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                   Veh+
                   n_Fixed +
                  NoComp:Crisis+
                   b_UCA:Crisis+OffPl99:Crisis+
                   cl_Ceil:Crisis+cl_Ceil:OffPl99+
                   cl_Days:Crisis+
                   cl_Days:OffPl99+
                   cl_Days:Veh+ 
                   cl_Ceil:Veh+
                 NoComp:Veh, 
                 family=binomial(link="logit"))
display(Term_08A)

stargazer::stargazer(CBre_07D,CBre_08A,Term_07D,Term_08A,type="text",
                     digits=2)



summary_residual_compare(CBre_07D,CBre_08A,Term_07D,Term_08A)


```

And fixed price contracts do indeed have a significant coefficient that correlates with higher termination risk. In addition, the addition of this variable reduces the pattern in the residuals that in the middle range. 

### 08B: Fixed-Price and Maximum Duration Intersection 
Past CSIS research has found that fixed-price contracts do appear to be at higher risk if they have a longer maximum duration. Fixed-price contracting does require upfront estimation of likely costs, and thus a longer duration means more opportunity for changed circumstance.

```{r Model08B}

  summary_continuous_plot(crisis_smp,"l_Days","FxCb")

#Model
CBre_08B <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   Veh+
                   n_Fixed +
                  NoComp:Crisis+
                   b_UCA:Crisis+OffPl99:Crisis+OffPl99:NoComp+
                   cl_Ceil:Crisis+
                   cl_Days:Veh+ 
                   cl_Ceil:Veh+
                 NoComp:Veh+
                   cl_Days:n_Fixed , 
                 family=binomial(link="logit"))
display(CBre_08B)

Term_08B <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                   Veh+
                   n_Fixed +
                  NoComp:Crisis+
                   b_UCA:Crisis+OffPl99:Crisis+
                   cl_Ceil:Crisis+cl_Ceil:OffPl99+
                   cl_Days:Crisis+
                   cl_Days:OffPl99+
                   cl_Days:Veh+ 
                   cl_Ceil:Veh+
                 NoComp:Veh+
                   cl_Days:n_Fixed, 
                 family=binomial(link="logit"))
display(Term_08B)

stargazer::stargazer(CBre_08A,CBre_08B,Term_08A,Term_08B,type="text",
                     digits=2)



summary_residual_compare(CBre_08A,CBre_08B,Term_08A,Term_08B)


```
The probability of ceiling breach is strongly associated with lnger duration contracts. This fits with expectations, longer contracts will face more changing circumstances which are harder to anticipate at contract creation, this effect only adds to the model for ceiling breacehs, dropping for terminations.

### 08C: Fixed-Price and Vehicle
```{r Model08C}

  summary_discrete_plot(crisis_smp,"FxCb","Veh")

#Model
CBre_08C <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   Veh+
                   n_Fixed +
                  NoComp:Crisis+
                   b_UCA:Crisis+OffPl99:Crisis+OffPl99:NoComp+
                   cl_Ceil:Crisis+
                   cl_Days:Veh+ 
                   cl_Ceil:Veh+
                 NoComp:Veh+
                   cl_Days:n_Fixed+
                   Veh:n_Fixed, 
                 family=binomial(link="logit"))
display(CBre_08C)

Term_08C <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                   Veh+
                   n_Fixed +
                  NoComp:Crisis+
                   b_UCA:Crisis+OffPl99:Crisis+
                   cl_Ceil:Crisis+cl_Ceil:OffPl99+
                   cl_Days:Crisis+
                   cl_Days:OffPl99+
                   cl_Days:Veh+ 
                   cl_Ceil:Veh+
                 NoComp:Veh+
                   Veh:n_Fixed, 
                 family=binomial(link="logit"))
display(Term_08C)

stargazer::stargazer(CBre_08B,CBre_08C,Term_08A,Term_08C,type="text",
                     digits=2)



summary_residual_compare(CBre_08B,CBre_08C,Term_08A,Term_08C)

```
The interactions lead the n_Fixed variable to lose  significant and do little to reduce the residual deviance. They will not be added to the model.


### 08D: Fixed Price and Crisis


```{r Model08D}

  summary_continuous_plot(crisis_smp,"l_Ceil","FxCb")
  
  #Model
summary_discrete_plot(crisis_smp,"FxCb","Crisis")
  
  #Model
  CBre_08D <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     OffPl99+ c_OffCri+
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                    NoComp:Crisis+
                     b_UCA:Crisis+OffPl99:Crisis+OffPl99:NoComp+
                     cl_Ceil:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                     cl_Days:n_Fixed+
                     Veh:n_Fixed, 
                   family=binomial(link="logit"))
  display(CBre_08D)
  
  Term_08D <- glm (data=crisis_smp,
                   b_Term ~ Crisis +NoComp +
                     b_UCA+
                     OffPl99+ c_OffCri+
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                    NoComp:Crisis+
                     b_UCA:Crisis+OffPl99:Crisis+
                     cl_Ceil:Crisis+cl_Ceil:OffPl99+
                     cl_Days:Crisis+
                     cl_Days:OffPl99+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                     Veh:n_Fixed, 
                   family=binomial(link="logit"))
  display(Term_08D)
  
  stargazer::stargazer(CBre_08B,CBre_08D,Term_08A,Term_08D,type="text",
                       digits=2)
  
  

summary_residual_compare(CBre_08B,CBre_08D,Term_08A,Term_08D)

```
The intersection of fixed price and vehicle reduces the base coefficient for fixed price to insignificance and are only a double digit improvement in deviance while increasing the magnitude of the residuals, leaving this out.


### 08E: Fixed Price and Ceiling


```{r Model08E}
  summary_continuous_plot(crisis_smp,"l_Ceil","FxCb")
  

  CBre_08E <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     OffPl99+ c_OffCri+
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                    NoComp:Crisis+
                     b_UCA:Crisis+OffPl99:Crisis+OffPl99:NoComp+
                     cl_Ceil:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                     cl_Days:n_Fixed+
                     cl_Ceil:n_Fixed, 
                   family=binomial(link="logit"))
  display(CBre_08E)
  
  Term_08E <- glm (data=crisis_smp,
                   b_Term ~ Crisis +NoComp +
                     b_UCA+
                     OffPl99+ c_OffCri+
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                    NoComp:Crisis+
                     b_UCA:Crisis+OffPl99:Crisis+
                     cl_Ceil:Crisis+cl_Ceil:OffPl99+
                     cl_Days:Crisis+
                     cl_Days:OffPl99+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                     cl_Ceil:n_Fixed, 
                   family=binomial(link="logit"))
  display(Term_08E)
  

  stargazer::stargazer(CBre_08B,CBre_08E,Term_08A,Term_08E,type="text",
                       digits=2)
  
  

summary_residual_compare(CBre_08B,CBre_08E,Term_08A,Term_08E,bins=30)

```
Larger fixed price contracts are associated with larger negative outcomes, though not significantly for terminations. The reduction in deviance is double digit and the number of binned residuals falling outside of the 95% confidence interval increases. Leaving this out.



### 08E: Fixed Price and Compeition


```{r Model08F}
  summary_discrete_plot(crisis_smp,"n_Fixed","NoComp")
summary_discrete_plot(crisis_smp,"n_Fixed","FxCb")
  

  CBre_08F <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     OffPl99+ c_OffCri+
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                    NoComp:Crisis+
                     b_UCA:Crisis+OffPl99:Crisis+OffPl99:NoComp+
                     cl_Ceil:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                     cl_Days:n_Fixed+
                     NoComp:n_Fixed, 
                   family=binomial(link="logit"))
  display(CBre_08F)
  
  Term_08F <- glm (data=crisis_smp,
                   b_Term ~ Crisis +NoComp +
                     b_UCA+
                     OffPl99+ c_OffCri+
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                    NoComp:Crisis+
                     b_UCA:Crisis+OffPl99:Crisis+
                     cl_Ceil:Crisis+cl_Ceil:OffPl99+
                     cl_Days:Crisis+
                     cl_Days:OffPl99+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                     NoComp:n_Fixed, 
                   family=binomial(link="logit"))
  display(Term_08F)
  

  stargazer::stargazer(CBre_08B,CBre_08F,Term_08A,Term_08F,type="text",
                       digits=2)
  
  

summary_residual_compare(CBre_08B,CBre_08F,Term_08A,Term_08F,bins=30)

```

##Place of Performance
### 09A: Any International

```{r Model09A}

#Frequency Plot
freq_discrete_cbre_plot(crisis_smp,"Intl")

#Percent Terminated Plot 
discrete_percent_cbre_plot(crisis_smp,"Intl")



#Create the model
CBre_09A <- glm (data=crisis_smp,
                 b_CBre ~ Crisis + n_Comp + 
                   cl_Ceil + cl_Days+ 
                   SIDV + MIDV + FSSGWAC + BPABOA +
                   n_Comp:cl_Ceil  + cl_Ceil:cl_Days  + n_Comp:cl_Days +
                   n_Fixed + b_UCA + 
                   b_Intl + 
                   SIDV:cl_Days+MIDV:cl_Days+OIDV:cl_Days +
                   SIDV:n_Comp+MIDV:n_Comp+OIDV:n_Comp+
                   b_UCA:n_Comp
                    , family=binomial(link="logit"))
display(CBre_09A)

# Plot the model and Vehicle 
CBre_09A_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed,UCA){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,UCA,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV,
        UCA*Comp) %*%  coef(CBre_09A))}

#Days curves
discrete_fitted_cbre_model(crisis_smp,"SIDV") +
  stat_function(fun = CBre_09A_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1,UCA=0),color="blue")+
  stat_function(fun = CBre_09A_curve,
                             args=list(Comp=2,Ceil=0,Days=1,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1,UCA=0),color="blue")


#Plot the fitted values vs actual results
binned_fitted_versus_cbre_residuals(CBre_09A)

#Plot residuals versus fittedO
residuals_cbre_plot(CBre_09A)+
  labs(x="Estimated  Pr (Termination)")

# residuals_cbre_plot(CBre_02F,"cl_days")+
#   labs(x="Centered Log(Days)")

```

International performance of contract unexpectedly had a negative coefficent. It is a variable of interest  to the study and will be left in.

### 09B: Fixed Price and Any International

```{r Model09B}

#Frequency Plot
freq_discrete_cbre_plot(crisis_smp,"Intl","FxCb")

#Percent Terminated Plot 
discrete_percent_cbre_plot(crisis_smp,"Intl","FxCb")



#Create the model
CBre_09A <- glm (data=crisis_smp,
                 b_CBre ~ Crisis + n_Comp + 
                   cl_Ceil + cl_Days+ 
                   SIDV + MIDV + FSSGWAC + BPABOA +
                   n_Comp:cl_Ceil  + cl_Ceil:cl_Days  + n_Comp:cl_Days +
                   n_Fixed + b_UCA + 
                   b_Intl + 
                   SIDV:cl_Days+MIDV:cl_Days+OIDV:cl_Days +
                   SIDV:n_Comp+MIDV:n_Comp+OIDV:n_Comp+
                   b_UCA:n_Comp+
                   n_Fixed:b_Intl
                    , family=binomial(link="logit"))
display(CBre_09A)

# Plot the model and Vehicle 
CBre_09A_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed,UCA){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,UCA,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV,
        UCA*Comp) %*%  coef(CBre_09A))}

#Days curves
discrete_fitted_cbre_model(crisis_smp,"SIDV") +
  stat_function(fun = CBre_09A_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1,UCA=0),color="blue")+
  stat_function(fun = CBre_09A_curve,
                             args=list(Comp=2,Ceil=0,Days=1,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1,UCA=0),color="blue")


#Plot the fitted values vs actual results
binned_fitted_versus_cbre_residuals(CBre_09A)

#Plot residuals versus fittedO
residuals_cbre_plot(CBre_09A)+
  labs(x="Estimated  Pr (Termination)")

# residuals_cbre_plot(CBre_02F,"cl_days")+
#   labs(x="Centered Log(Days)")

```

### 09C: Vehicle and Any International

```{r Model09C}

#Frequency Plot
freq_discrete_cbre_plot(crisis_smp,"Intl","Veh")

#Percent Terminated Plot 
discrete_percent_cbre_plot(crisis_smp,"Intl","Veh")



#Create the model
CBre_09C <- glm (data=crisis_smp,
                 b_CBre ~ Crisis + n_Comp + 
                   cl_Ceil + cl_Days+ 
                   SIDV + MIDV + FSSGWAC + BPABOA +
                   n_Comp:cl_Ceil  + cl_Ceil:cl_Days  + n_Comp:cl_Days +
                   n_Fixed + b_UCA + 
                   b_Intl + 
                   SIDV:cl_Days+MIDV:cl_Days+OIDV:cl_Days +
                   SIDV:n_Comp+MIDV:n_Comp+OIDV:n_Comp+
                   b_UCA:n_Comp+
                   SIDV:b_Intl+MIDV:b_Intl+OIDV:b_Intl
                    , family=binomial(link="logit"))
display(CBre_09C)

# Plot the model and Vehicle 
CBre_09C_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed,UCA){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,UCA,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV,
        UCA*Comp) %*%  coef(CBre_09C))}

#Days curves
discrete_fitted_cbre_model(crisis_smp,"SIDV") +
  stat_function(fun = CBre_09C_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1,UCA=0),color="blue")+
  stat_function(fun = CBre_09C_curve,
                             args=list(Comp=2,Ceil=0,Days=1,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1,UCA=0),color="blue")


#Plot the fitted values vs actual results
binned_fitted_versus_cbre_residuals(CBre_09C)

#Plot residuals versus fittedO
residuals_cbre_plot(CBre_09C)+
  labs(x="Estimated  Pr (Termination)")

# residuals_cbre_plot(CBre_02F,"cl_days")+
#   labs(x="Centered Log(Days)")

```


##Who
Adding who resulted in a range of models that failed to converge. The one exception was combining Product/Service/R&D alone and Who, which did require removing multiple interactions from the model before convergence could be reached, but did allow the continued inclusion of  the combination of Product/Service/R&D and competition. All other models have been commented out to allow for the Markdown file  to  be created in a manageable amount of time. The study team initially considered using start year or contracting office identity as additional non-nested levels. However, those models failed to converge or had eigenvalue related challenges. As a result, the study team chose to focus on the question of what is being acquired. Who is acquiring is instead being handled by individual dummy variables or group level summary variables where appropriate, but not by seperate intercepts or slopes. Start year is not included in the model because of the complicatitons related to durations. Namely longer duration contracts from recent years have not yet had the opportunity to live out their natural life span. This means  that recent years will have an artificially high termination rate for longer contracts, because we only know about those that ended before their maximum duration, often due to termination.


### 10A: Sub Customer other DoD
Other DoD stands out for its sheer quantity of contracts and task orders and also its lower termination rate. 
```{r Model10A}

#Frequency Plot
freq_discrete_cbre_plot(crisis_smp,"Who")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))


#Percent Terminated Plot 
discrete_percent_cbre_plot(crisis_smp,"Who")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))


crisis_smp$b_ODoD<-crisis_smp$Who
levels(crisis_smp$b_ODoD)<- list("1"=c("Other DoD"), 
                                "0"=c("Air Force","Army","Navy"))
crisis_smp$b_ODoD[crisis_smp$b_ODoD=="Uncategorized"]<-NA
crisis_smp$b_ODoD<-as.integer(as.character(crisis_smp$b_ODoD))

#Create the model
CBre_10A <- glm (data=crisis_smp,
                 b_CBre ~ Crisis + n_Comp + 
                   cl_Ceil + cl_Days+ 
                   SIDV + MIDV + FSSGWAC + BPABOA +
                   n_Comp:cl_Ceil  + cl_Ceil:cl_Days  + n_Comp:cl_Days +
                   n_Fixed + b_UCA + 
                   b_Intl + b_ODoD +
                   SIDV:cl_Days+MIDV:cl_Days+OIDV:cl_Days +
                   SIDV:n_Comp+MIDV:n_Comp+OIDV:n_Comp+
                   b_UCA:n_Comp
                    , family=binomial(link="logit"))
display(CBre_10A)


# Plot the model and Vehicle 
CBre_10A_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed,UCA,Intl){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,UCA,Intl,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV,
        UCA*Comp) %*%  coef(CBre_10A))}

#Days curves
discrete_fitted_cbre_model(crisis_smp,"b_ODoD") +
  stat_function(fun = CBre_10A_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1,UCA=0,Intl=0),color="blue")+
  stat_function(fun = CBre_10A_curve,
                             args=list(Comp=2,Ceil=0,Days=1,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1,UCA=0,Intl=0),color="blue")


#Plot the fitted values vs actual results
binned_fitted_versus_cbre_residuals(CBre_10A)

#Plot residuals versus fittedO
residuals_cbre_plot(CBre_10A)+
  labs(x="Estimated  Pr (Termination)")

# residuals_cbre_plot(CBre_02F,"cl_days")+
#   labs(x="Centered Log(Days)")

```

After inclusion of DLA, the Competition correlates significantly predicts a greater risk of termination. Studying that interaction will be our next step.

#Other DoD & Competition
```{r Model10B}

#Frequency Plot
freq_discrete_cbre_plot(crisis_smp,"EffComp","Who")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))


#Percent Terminated Plot 
discrete_percent_cbre_plot(crisis_smp,"EffComp","Who")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))


crisis_smp$b_ODoD<-crisis_smp$Who
levels(crisis_smp$b_ODoD)<- list("1"=c("Other DoD"), 
                                "0"=c("Air Force","Army","Navy"))
crisis_smp$b_ODoD[crisis_smp$b_ODoD=="Uncategorized"]<-NA
crisis_smp$b_ODoD<-as.integer(as.character(crisis_smp$b_ODoD))

#Create the model
CBre_10B <- glm (data=crisis_smp,
                 b_CBre ~ Crisis + n_Comp + 
                   cl_Ceil + cl_Days+ 
                   SIDV + MIDV + FSSGWAC + BPABOA +
                   n_Comp:cl_Ceil  + cl_Ceil:cl_Days  + n_Comp:cl_Days +
                   n_Fixed + b_UCA + 
                   b_Intl + b_ODoD +
                   SIDV:cl_Days+MIDV:cl_Days+OIDV:cl_Days +
                   SIDV:n_Comp+MIDV:n_Comp+OIDV:n_Comp+
                   b_UCA:n_Comp+
                   b_ODoD:n_Comp
                    , family=binomial(link="logit"))
display(CBre_10B)


# Plot the model and Vehicle 
CBre_10B_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed,UCA,Intl){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,UCA,Intl,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV,
        UCA*Comp) %*%  coef(CBre_10B))}

#Days curves
discrete_fitted_cbre_model(crisis_smp,"b_ODoD") +
  stat_function(fun = CBre_10B_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1,UCA=0,Intl=0),color="blue")+
  stat_function(fun = CBre_10B_curve,
                             args=list(Comp=2,Ceil=0,Days=1,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1,UCA=0,Intl=0),color="blue")


#Plot the fitted values vs actual results
binned_fitted_versus_cbre_residuals(CBre_10B)

#Plot residuals versus fittedO
residuals_cbre_plot(CBre_10B)+
  labs(x="Estimated  Pr (Termination)")

# residuals_cbre_plot(CBre_02F,"cl_days")+
#   labs(x="Centered Log(Days)")

```

#Multi-Level Model

##What
### 11A: Product/Service/R&D
```{r Model11A}

#Frequency Plot
freq_discrete_cbre_plot(crisis_smp,"PSR")

#Percent Terminated Plot 
discrete_percent_cbre_plot(crisis_smp,"PSR")



#Create the model
CBre_11A <- glmer(data=crisis_smp,
                 b_CBre ~ Crisis + n_Comp + 
                   cl_Ceil + cl_Days+ 
                   SIDV + MIDV + FSSGWAC + BPABOA +
                   n_Comp:cl_Ceil  + cl_Ceil:cl_Days  + n_Comp:cl_Days +
                   n_Fixed + b_UCA + 
                   b_Intl + 
                   SIDV:cl_Days+MIDV:cl_Days+OIDV:cl_Days +
                   SIDV:n_Comp+MIDV:n_Comp+OIDV:n_Comp+
                   b_UCA:n_Comp+
                   (1 | PSR)
                    , family=binomial(link="logit"))
display(CBre_11A)

# Plot the model and Vehicle 
CBre_11A_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed,UCA){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,UCA,x,
        Days*x,Days*MIDV,Days*OIDV,
        UCA*Comp) %*%  coef(CBre_11A))}

#Days curves
discrete_fitted_cbre_model(crisis_smp,"SIDV") +
  stat_function(fun = CBre_11A_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1,UCA=0),color="blue")+
  stat_function(fun = CBre_11A_curve,
                             args=list(Comp=2,Ceil=0,Days=1,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1,UCA=0),color="blue")


#Plot the fitted values vs actual results
binned_fitted_versus_cbre_residuals(CBre_11A)

#Plot residuals versus fittedO
residuals_cbre_plot(CBre_11A)+
  labs(x="Estimated  Pr (Termination)")

# residuals_cbre_plot(CBre_02F,"cl_days")+
#   labs(x="Centered Log(Days)")

```

Unfortunately, after including Start Fiscal Year, the model again failed to converge. The standard deviation of Who is 0 while it is notably higher for determining the slope of competition via PSR and for Start Fiscal Year. This suggests that who is adding little to the model and that it is time to go back to model 6C as a starter.

### 11B: Product/Service/R&D and Platform
```{r Model11B}

#Frequency Plot
freq_discrete_cbre_plot(crisis_smp,"PSR_What")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))

#Percent Terminated Plot 
discrete_percent_cbre_plot(crisis_smp,"PSR_What")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))



#Create the model
CBre_11B <- glmer(data=crisis_smp,
                 b_CBre ~ Crisis + n_Comp + 
                   cl_Ceil + cl_Days+ 
                   SIDV + MIDV + FSSGWAC + BPABOA +
                   n_Comp:cl_Ceil  +
                   # cl_Ceil:cl_Days  + 
                   n_Comp:cl_Days +
                   n_Fixed + b_UCA + 
                   b_Intl + 
                   SIDV:cl_Days+MIDV:cl_Days+OIDV:cl_Days +
                   SIDV:n_Comp+MIDV:n_Comp+OIDV:n_Comp+
                   b_UCA:n_Comp+
                   (1 | PSR) + (1 | PSR_What)
                    , family=binomial(link="logit"))
display(CBre_11B)

# Plot the model and Vehicle 
CBre_11B_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed,UCA){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,UCA,x,
        Days*x,Days*MIDV,Days*OIDV,
        UCA*Comp) %*%  coef(CBre_11B))}

#Days curves
discrete_fitted_cbre_model(crisis_smp,"SIDV") +
  stat_function(fun = CBre_11B_curve,
                             args=list(Comp=0,Ceil=0,Days=0,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1,UCA=0),color="blue")+
  stat_function(fun = CBre_11B_curve,
                             args=list(Comp=2,Ceil=0,Days=1,
                                       MIDV=0,SIDV=0,OIDV=0,
                                       Fixed=1,UCA=0),color="blue")

#Plot the fitted values vs actual results
binned_fitted_versus_cbre_residuals(CBre_11B)

#Plot residuals versus fittedO
residuals_cbre_plot(CBre_11B)+
  labs(x="Estimated  Pr (Termination)")

# residuals_cbre_plot(CBre_02F,"cl_days")+
#   labs(x="Centered Log(Days)")

```

### 11C: Interactions
```{r Model 6 Exploration}
#, fig.height = 10, fig.width = 6.5
#Effective Competition
#Frequency Plot
freq_discrete_cbre_plot(crisis_smp,"PSR_What","EffComp")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))

#Percent Terminated Plot 
discrete_percent_cbre_plot(crisis_smp,"EffComp","PSR")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))

discrete_percent_cbre_plot(crisis_smp,"EffComp","What")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))

discrete_percent_cbre_plot(crisis_smp,"EffComp","PSR_What")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))


#Effective Competition
#Frequency Plot
freq_discrete_cbre_plot(crisis_smp,"PSR_What","Veh")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))

#Percent Terminated Plot 
discrete_percent_cbre_plot(crisis_smp,"Veh","PSR")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))

discrete_percent_cbre_plot(crisis_smp,"Veh","What")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))

discrete_percent_cbre_plot(crisis_smp,"Veh","PSR_What")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))

#FxCb
#Frequency Plot
freq_discrete_cbre_plot(crisis_smp,"PSR_What","FxCb")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))

#Percent Terminated Plot 
discrete_percent_cbre_plot(crisis_smp,"FxCb","PSR")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))

discrete_percent_cbre_plot(crisis_smp,"FxCb","What")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))

discrete_percent_cbre_plot(crisis_smp,"FxCb","PSR_What")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))


CBre_11C <- glmer(data=crisis_smp,
                 b_CBre ~ #n_Comp + 
                   cl_Ceil + cl_Days+ 
                   SIDV + MIDV + FSSGWAC + BPABOA +
                   n_Comp:cl_Ceil  +
                   # cl_Ceil:cl_Days  + 
                   n_Comp:cl_Days +
                   n_Fixed + b_UCA + 
                   b_Intl + 
                   SIDV:cl_Days+MIDV:cl_Days+OIDV:cl_Days +
                   SIDV:n_Comp+MIDV:n_Comp+OIDV:n_Comp+
                   b_UCA:n_Comp+
                   (1 + n_Comp | PSR) + (1 | PSR_What)
                    , family=binomial(link="logit"))
display(CBre_11C)


CBre_11D <- glmer(data=crisis_smp,
                 b_CBre ~ Crisis +n_Comp + 
                   cl_Ceil + cl_Days+ 
                   SIDV + MIDV + FSSGWAC + BPABOA +
                   n_Comp:cl_Ceil  +
                   # cl_Ceil:cl_Days  + 
                   n_Comp:cl_Days +
                   n_Fixed + b_UCA + 
                   b_Intl + 
                   SIDV:cl_Days+MIDV:cl_Days+OIDV:cl_Days +
                   SIDV:n_Comp+MIDV:n_Comp+OIDV:n_Comp+
                   b_UCA:n_Comp+
                   (1  | PSR) + (1 + n_Comp| PSR_What)
                    , family=binomial(link="logit"))
display(CBre_11D)

#Plot the fitted values vs actual results
binned_fitted_versus_cbre_residuals(CBre_11C)


#Plot residuals versus fittedO
residuals_cbre_plot(CBre_11C)+
  labs(x="Estimated  Pr (Termination)")


# CBre_11E <- glmer(data=crisis_smp,
#                  b_CBre ~ Crisis +n_Comp + 
#                    cl_Ceil + cl_Days+ 
#                    SIDV + MIDV + FSSGWAC + BPABOA +
#                    n_Comp:cl_Ceil  +
#                    # cl_Ceil:cl_Days  + 
#                    n_Comp:cl_Days +
#                    n_Fixed + b_UCA + 
#                    b_Intl + 
#                    SIDV:cl_Days+MIDV:cl_Days+OIDV:cl_Days +
#                    SIDV:n_Comp+MIDV:n_Comp+OIDV:n_Comp+
#                    b_UCA:n_Comp+
#                    (1+n_Comp  | PSR) + (1+ n_Comp | PSR_What)
#                     , family=binomial(link="logit"))
# display(CBre_11E)
# failure to converge in 10000 evaluations

#Plot the fitted values vs actual results
binned_fitted_versus_cbre_residuals(CBre_11C)


#Plot residuals versus fittedO
residuals_cbre_plot(CBre_11C)+
  labs(x="Estimated  Pr (Termination)")


#Plot the fitted values vs actual results
binned_fitted_versus_cbre_residuals(CBre_11D)


#Plot residuals versus fittedO
residuals_cbre_plot(CBre_11D)+
  labs(x="Estimated  Pr (Termination)")

```
The use of Comp as 

