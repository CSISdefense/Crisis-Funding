---
title: "Contract Termination"
author: "Greg Sanders"
date: "Wednesday, February 8, 2117"
output:
  html_document:
    keep_md: yes
--- 

Modeling Likelihood of Contract Termination or Ceiling Breach
============================================================================

#Setup
```{r Libraries, echo = FALSE}
library(csis360)
library(ggplot2)
library(arm)
library(R2WinBUGS)
source("https://raw.githubusercontent.com/CSISdefense/Vendor/master/DIIGstat.r")

axis.text.size<-10
strip.text.size<-10
legend.text.size<-8
# table.text.size<-5.75
title.text.size<-12
geom.text.size<-12

main.text.size<-1
note.text.size<-1.40


```



##Prepare Data
First we load the data. The dataset used is a U.S. Defense Contracting dataset derived from   FPDS.


```{r ReadInData, echo = TRUE}
  load(file="Data/Federal_contract_CSIScontractID_detail.Rdata")

head(fed)
fed<-transform_contract(fed)

# fed<-decision_tree(fed)


```

Contracts are classified using a mix of numerical and categorical variables. While the changes in numerical variables are easy to grasp and summarize, a contract may have one line item that is competed and another that is not. As is detailed in the exploration on R&D, we are only considering information available prior to contract start. The percentage of contract obligations that were competed is a valuable benchmark, but is highly influenced by factors that occured after contract start..

### Contract Terminations

Contract terminations and the number of change orders can be calculated for the entire sample.  Contract termination is determined using the *Reason for Modification* field in FPDS.  A contract is considered to be terminated if it has at least one modification with the following values:

* "Terminate for Default (complete or partial)"
* "Terminate for Convenience (complete or partial)"
* "Terminate for Cause"
* "Legal Contract Cancellation"

These four catetegories and the "Close Out" category are used to mark a contract as closed.  Many contracts in FPDS and in the sample are never marked closed.  


* b_CBre is a binary variable that has a value of 1 for any contracts that have experienced a partial or complete termination, 0 otherwise. ('r summary(fed$b_CBre)
NA_stats(fed,"b_CBre")')
* b_Comp is a binary variable based on competition. It has a value of 0 for uncompeted contracts and a value of 1 for competition, regardless of number of offers. 'r  summary(fed$b_Comp);
NA_stats(fed,"b_Comp")'
* n_Comp is a numeric variable based on competition and number of offers. It has a value of 0 for uncompeted contracts and a value of 1 for single-offer competition, and a value of 2 for multi-offer competition. 'r summary(fed$EffComp);
NA_stats(fed,"n_Comp")' 
* n_Offr is a numeric variable based on competition and with more granularity on number offers. It has a value of 0 for uncompeted contracts and a value of 1 for single-offer competition, and a value of 2 for 2-offers, 3 for 3-4 offers, and 4 for 5+ offers. 'r summary(fed$n_Offr);
NA_stats(fed,"n_Offr")' 

* n_Offr is a numeric variable based on competition and with more granularity on number offers. It has a value of 0 for uncompeted contracts and a value of 1 for single-offer competition, and a value of 2 for 2-offers, 3 for 3-4 offers, and 4 for 5+ offers. 'r summary(fed$Urg);
NA_stats(fed,"b_Urg")' 
* l_Offr is the natural log of the number of offers received. Uncompeted contracts are classified as having received one offer. 'r summary(fed$l_Offr)
NA_stats(fed,"l_Offr")'
* cl_Ceil is the natural log of the initial contract cost ceiling, in then-year dollars. 'r centered_log_description(fed$l_Ceil,"dollars")
NA_stats(fed,"l_Ceil")'
* cl_Days is the natural log of the initial maximum duration of the contract, in days. The variable is centered, by subtracting its mean ('r centered_log_description(fed$l_Days,"days");
NA_stats(fed,"l_Days")' 
* SIDV, MIDV, and OIDV are dummy variables based on the contract vehicle. They correspond to Single-Award IDVs, Multi-Award IDVs, and Other IDVs, respectively, having a value of 1 when the task order has that vehicle type, and having a 0 other. The remaining types, definitive contracts and purchase orders, are intentionally left out. ('r summary(fed$SIDV);
summary(fed$MIDV);
summary(fed$FSSGWAC);
summary(fed$BPABOA);
NA_stats(fed,"Veh")'
* n_Fixed is a numeric variable based on contract pricing. It has a value of 0 for cost-based, 0.5 or "combination or other", 1 for any fixed price (excluding fixed-price level of effort which is classified as cost-based). ('r summary(fed$n_Fixed);
NA_stats(fed,"n_Fixed")')
* n_Incent is a numeric variable based on fee type. Ig has a value. 1 for incentive fee or cost sharing, 0.5 or "combination or other", 0 for all remaining types. ('r summary(fed$n_Incent);
NA_stats(fed,"n_Incent")')
* b_UCA is a binary variable with a value of 1 for contracts/task orders that begin as letter contracts or undefinitized contract awards (UCA) and a value of 0 otherwise. 'r
summary(fed$b_UCA);
NA_stats(fed,"b_UCA")'
* b_Intl is a binary variable with a value of 1 for contracts/task orders with any transactions performed internationally and a value of 0 otherwise. 'r
summary(fed$b_Intl);
NA_stats(fed,"b_Intl")'


In addition, l_Ceil and l_Days are rescaled to have an average value of 0 and a standard deviation of one. This standardizes interpretation and prevents a "very large eigen value" error later when l_Ceil:lDay is introduced.


Next, we eliminate missing data entries and then draw a sample. The final computation uses all of the data, but as a computation shortcut, only a subset of the data is needed to allow for processing of models in minutes rather than hours.

## Sample Creation
```{r Sample}
load("Data\\crisis_smp.Rdata")
# crisis_with_na<-fed[fed$Crisis %in% c("ARRA","Dis"),]
# oco<-fed[fed$Crisis %in% c("OCO"),]
# oco<-oco[sample(nrow(oco),100000),]
# crisis_with_na<-rbind(crisis_with_na,oco)
# rm(oco)
# other_intl<-fed[fed$Crisis %in% c("Other")&fed$OffIntl>=0.5,]
# other_dom<-fed[fed$Crisis %in% c("Other")&(fed$OffIntl<0.5
#                                            |is.na(fed$OffIntl)),]
# other_dom<-other_dom[sample(nrow(other_dom),100000),]
# other_intl<-other_intl[sample(nrow(other_intl),100000),]
# crisis_with_na<-rbind(crisis_with_na,other_dom,other_intl)
# rm(other)
sample_prep<-function(data){
  colnames(data)[colnames(data)=="ProdServ"]<-"ProductOrServiceCode"
  data$ProductOrServiceCode<-as.character(data$ProductOrServiceCode)
  data<-csis360::read_and_join( data,
                                 "ProductOrServiceCodes.csv",
                                 path="https://raw.githubusercontent.com/CSISdefense/Lookup-Tables/master/",
                                 directory="",
                                 by="ProductOrServiceCode",
                                 add_var=c("Simple",
                                           "ProductServiceOrRnDarea",
                                           "ProductOrServiceArea",
                                           "HostNation3Category",
                                           "CrisisProductOrServiceArea",
                                           "ProductOrServiceCodeText"
                                           ),
                                 new_var_checked=FALSE)
  data$ProductServiceOrRnDarea<-factor(data$ProductServiceOrRnDarea)
  data$ProductOrServiceArea<-factor(data$ProductOrServiceArea)
  data$HostNation3Category<-factor(data$HostNation3Category)
  data$CrisisProductOrServiceArea<-factor(data$CrisisProductOrServiceArea)
  data$ProductOrServiceCodeText<-factor(data$ProductOrServiceCodeText)
  data$ProductOrServiceCode<-factor(data$ProductOrServiceCode)
data$ServCommCons<-data$HostNation3Category
data$CPSA<-as.character(data$CrisisProductOrServiceArea)
data$CPSA<-factor(gsub(" & ","+",data$CPSA))

data$PSA<-as.character(data$ProductOrServiceArea)
data$PSA<-gsub(" & ","+",data$PSA)
data$b_NoComp<-!data$b_Comp
  colnames(data)[colnames(data)=="ProductOrServiceCode"]<-"ProdServ"
  data
}

get_complete_list<-function(data){
complete<-!is.na(data$b_Term)&
  !is.na(data$b_CBre)&
  !is.na(data$b_Comp)&
  !is.na(data$b_Urg)&
  !is.na(data$l_Ceil)&
  !is.na(data$l_Days)&
  !is.na(data$Veh) &
  !is.na(data$n_Fixed)&
  !is.na(data$b_Intl)&
  !is.na(data$b_UCA)&
  !is.na(data$ProdServ)&
  !is.na(data$Crisis)&
  !is.na(data$Office)&
!is.na(data$OffCri)&
  !is.na(data$OffIntl)&
  !is.na(data$Is.Defense)
  # !is.na(data$cl_HHI_lag1)
  complete
}

fed<-sample_prep(fed)
fed_complete<-get_complete_list(fed)
fed_no_na<-fed[fed_complete,]
# crisis_with_na<-sample_prep(crisis_with_na)
# complete<-get_complete_list(crisis_with_na)  

# 
# 
# 
# summary(crisis_with_na$Crisis)
# 
# 
# 
# #
# #8811392  to 8811392
# nrow(crisis_with_na[!complete,])/nrow(crisis_with_na)
# sum(crisis_with_na[!complete,]$Action.Obligation,na.rm=TRUE)/sum(crisis_with_na$Action.Obligation,na.rm=TRUE)
# # 
# crisis_smp<-crisis_with_na[complete,]
# # # 
# # head(crisis_smp)

# save(crisis_smp,crisis_with_na,file="Data\\crisis_smp.Rdata")






# large_crisis_with_na<-fed[fed$Crisis %in% c("ARRA","Dis","OCO"),]
# other_intl<-fed[fed$Crisis %in% c("Other")&fed$OffIntl>=0.5,]
# other_dom<-fed[fed$Crisis %in% c("Other")&(fed$OffIntl<0.5
#                                            |is.na(fed$OffIntl)),]
# other_dom<-other_dom[sample(nrow(other_dom),300000),]
# other_intl<-other_intl[sample(nrow(other_intl),300000),]
# large_crisis_with_na<-rbind(large_crisis_with_na,other_dom,other_intl)
# rm(other_dom,other_intl)

# large_crisis_with_na<-sample_prep(large_crisis_with_na)
# large_complete<-get_complete_list(large_crisis_with_na)
# large_crisis_smp<-large_crisis_with_na[large_complete,]
# # summary(large_crisis_with_na$Crisis)
# #
#
# large_crisis_smp$OffPl99<-Hmisc::cut2(large_crisis_smp$OffIntl,c(0.01,0.50))
# summary(large_crisis_smp$OffPl99)
#   levels(large_crisis_smp$OffPl99) <-
#     list("US99"=c("[0.00,0.01)"),
#          "Mixed"=c("[0.01,0.50)"),
#          "Intl"=c("[0.50,1.00]"))
#   large_crisis_smp$Reach<-factor(paste(large_crisis_smp$OffPl99,large_crisis_smp$Intl,sep="-"))
#
#
#      levels(crisis_smp$Reach) <-
#     list( "US50-Dom"=c("US99-Just U.S.","Mixed-Just U.S."),
#          "Mixed-Dom"=c(),
#          "Intl-Dom"=c("Intl-Just U.S."),
#          "US50-Intl"=c("Mixed-Any International","US99-Any International"),
#          "Intl-Intl"=c("Intl-Any International"))
#
# large_crisis_smp$PSA<-as.character(large_crisis_smp$ProductOrServiceArea)
# large_crisis_smp$PSA<-gsub(" & ","+",large_crisis_smp$PSA)
# load("Data\\large_crisis_smp.Rdata")
# save(large_crisis_smp,large_crisis_with_na,file="Data\\large_crisis_smp.Rdata")
# save(fed,file="Data\\transformed_fed.Rdata")
# load(file="Data\\transformed_fed.Rdata")

# extra_large_crisis_with_na<-fed[fed$Crisis %in% c("ARRA","Dis","OCO"),]
# other_intl<-fed[fed$Crisis %in% c("Other")&fed$OffIntl>=0.5,]
# other_dom<-fed[fed$Crisis %in% c("Other")&(fed$OffIntl<0.5
#                                            |is.na(fed$OffIntl)),]
# other_dom<-other_dom[sample(nrow(other_dom),1000000),]
# extra_large_crisis_with_na<-rbind(extra_large_crisis_with_na,other_dom,other_intl)
# rm(other_dom,other_intl)
# 
# extra_large_crisis_with_na<-(extra_large_crisis_with_na)
# extra_large_complete<-get_complete_list(extra_large_crisis_with_na)
# extra_large_crisis_smp<-extra_large_crisis_with_na[extra_large_complete,]
# # # summary(large_crisis_with_na$Crisis)
# # #
# #
# extra_large_crisis_smp$OffPl99<-Hmisc::cut2(extra_large_crisis_smp$OffIntl,c(0.01,0.50))
# summary(extra_large_crisis_smp$OffPl99)
#   levels(extra_large_crisis_smp$OffPl99) <-
#     list("US99"=c("[0.00,0.01)"),
#          "Mixed"=c("[0.01,0.50)"),
#          "Intl"=c("[0.50,1.00]"))
#   extra_large_crisis_smp$Reach<-factor(paste(extra_large_crisis_smp$OffPl99,extra_large_crisis_smp$Intl,sep="-"))
# 
# 
#      levels(extra_large_crisis_smp$Reach) <-
#     list( "US50-Dom"=c("US99-Just U.S.","Mixed-Just U.S."),
#          "Mixed-Dom"=c(),
#          "Intl-Dom"=c("Intl-Just U.S."),
#          "US50-Intl"=c("Mixed-Any International","US99-Any International"),
#          "Intl-Intl"=c("Intl-Any International"))
# 
# save(extra_large_crisis_smp,extra_large_crisis_with_na,file="Data\\extra_large_crisis_smp.Rdata")
load("Data\\extra_large_crisis_smp.Rdata")

```

The sample is created by including the entirity of the ARRA and Disaster datasets, as well as 100,000 records each from the OCO datase and another 100,000 from all remaining records.

#Initial Logit Model

##Crisis Dataset
### 01A Crisis Dataset
```{r Model01A}

summary_discrete_plot(crisis_smp,"Crisis")

#Model
CBre_01A <- glm (data=crisis_smp,
                 b_CBre ~ Crisis, family=binomial(link="logit"))
display(CBre_01A)

#Model
Term_01A <- glm (data=crisis_smp,
                 b_Term ~ Crisis, family=binomial(link="logit"))
display(Term_01A)




```
In line with literature, crisis contracting is higher risk than conventional contracting, with all three datasets having a termination rate well above the termination rate for the remaining contracts. OCO is closest to that typical rate.

## Competition Variables

Expectation: Competition has the potential to reduce terminations and ceiling breaches by giving the government more options in vendors and encouraging better behavior from the contractor that was chosen. 
### 02A: No Competition / Competition
```{r Model02A}
summary_discrete_plot(crisis_smp,"Comp")

crisis_smp$b_NoComp<-!crisis_smp$b_Comp

#Model
CBre_02A <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +b_NoComp, family=binomial(link="logit"))
display(CBre_02A)

Term_02A <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp, family=binomial(link="logit"))
display(Term_02A)


stargazer::stargazer(CBre_01A,CBre_02A,Term_01A,Term_02A,type="text",
                     digits=2)


summary_residual_compare(CBre_01A,CBre_02A,Term_01A,Term_02A,bins=3)

```
The expected sign was found for ceiling breaches but not for terminations.

Binary competition is associated with a significantly decreased risk of ceiling breaches but a slightly greater risk of terminations. Urgency is associated with a lower risk of termination and a lower risk of ceiling breaches, though neither is significant. The increased risk of ceiling breach is the only finding in line with the hypotheses. The next step is to add interactions between the competition and the crisis datasets.


Expectation: The literature suggests that competition versus non-competition could be even more important in crisis situations. The base competition variable is still expected to be negative.
### 02B: No Competition / Competition
```{r Model02B}

summary_discrete_plot(crisis_smp,"Comp","Crisis")

#Model
CBre_02B <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +b_NoComp +
                   b_NoComp:Crisis, 
                 family=binomial(link="logit"))
display(CBre_02B)

Term_02B <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp +
                   b_NoComp:Crisis, 
                 family=binomial(link="logit"))
display(Term_02B)


stargazer::stargazer(CBre_02A,CBre_02B,Term_02A,Term_02B,type="text",
                     digits=2)



summary_residual_compare(CBre_02A,CBre_02B,Term_02A,Term_02B,bins=3)
```

The expectation was not fulfilled for ceiling breaches. The expecation was fulfilled with terminations, but only significantly in the case of diaster funds.

The results are complicated. With the interactions, terminations are now associated with competition, but for all three crisis datasets, competition counters this relationship. Things are more complex with ceiing breahes, where the interaction of competition with ARRA and OCO is associated with a lower likelihood of a breach, but the relationship goes the other way for disasters.

The Variance Inflation Factor exceeds 2 for the interaction term with the addition of the interaction term.

### 02C: No Competition / Single Offer / Competition
The next step is to look at a more detailed model, where single offer competition is broken out as a middle option between competition and no competion.

Expectation: Competition has the potential to reduce terminations and ceiling breaches by giving the government more options in vendors and encouraging better behavior from the contractor that was chosen. More offers could in theory mean greater benefit, although this was not directly mentioned by the literature.

```{r Model02C}

summary_discrete_plot(crisis_smp,"EffComp")

#Model
CBre_02C <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +n_Comp ,
                 family=binomial(link="logit"))
display(CBre_02C)

Term_02C <- glm (data=crisis_smp,
                 b_Term ~ Crisis +n_Comp ,
                 family=binomial(link="logit"))
display(Term_02C)


stargazer::stargazer(CBre_02B,CBre_02C,CBre_02B,Term_02C,type="text",
                     digits=2)

summary_residual_compare(CBre_02B,CBre_02C,Term_02B,Term_02C,bins=3)


```
The results when single-offer and multi-offer competition are split are quite odd and somewhat peculiar to the crisis datasets.


Expectation: The literature suggests that competition versus non-competition could be even more important in crisis situations. The base competition variable is still expected to be negative.
### 02D: No Competition / Single Offer / Competition
```{r Model02D}
summary_discrete_plot(crisis_smp,"EffComp","Crisis")

#Model
CBre_02D <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +n_Comp+
                   Crisis:n_Comp,
                 family=binomial(link="logit"))
display(CBre_02D)

Term_02D <- glm (data=crisis_smp,
                 b_Term ~ Crisis +n_Comp+
                   Crisis:n_Comp,
                 family=binomial(link="logit"))
display(Term_02D)



stargazer::stargazer(CBre_02B,CBre_02C,CBre_02D,Term_02B,Term_02C,Term_02D,
                     type="text",
                     digits=2)

summary_residual_compare(CBre_02B,CBre_02D,Term_02B,Term_02D,bins=3)
summary_residual_compare(CBre_02C,CBre_02D,Term_02C,Term_02D,bins=3)

    
    
  
```
These results confirm that it is the crisis datasets that drive this phenomenon, but 

The correlation between the three categories of competition has a larger  coefficent and standard error, in a perplexing direction. The next step looks at the number of offers in greater detail.

Expectation: Competition has the potential to reduce terminations and ceiling breaches by giving the government more options in vendors and encouraging better behavior from the contractor that was chosen. More offers could in theory mean greater benefit, although this was not directly mentioned by the literature.
### 02E: No Competition / Number of Offer Categories 
```{r Model02E}

summary_discrete_plot(crisis_smp,"CompOffr")

#Model
CBre_02E <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +cn_Offr, family=binomial(link="logit"))
display(CBre_02E)

Term_02E <- glm (data=crisis_smp,
                 b_Term ~ Crisis +cn_Offr, family=binomial(link="logit"))
display(Term_02E)

stargazer::stargazer(CBre_02B,CBre_02D,CBre_02E,Term_02B,Term_02D,Term_02E,
                     type="text",
                     digits=2)

summary_residual_compare(CBre_02B,CBre_02E,Term_02B,Term_02E,bins=3)
summary_residual_compare(CBre_02D,CBre_02E,Term_02D,Term_02E,bins=3)
```

The more detailed breakout still doesn't make a great deal of sense.

Expectation: The literature suggests that competition versus non-competition could be even more important in crisis situations. The base competition variable is still expected to be negative.
### 02F: No Competition / Number of Offer Categories 
```{r Model02F}
summary_discrete_plot(crisis_smp,"CompOffr","Crisis")

#Model
CBre_02F <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +cn_Offr+
                   Crisis:cn_Offr,
                 family=binomial(link="logit"))
display(CBre_02F)

Term_02F <- glm (data=crisis_smp,
                 b_Term ~ Crisis +cn_Offr+
                   Crisis:cn_Offr,
                 family=binomial(link="logit"))
display(Term_02F)


stargazer::stargazer(CBre_02B,CBre_02D,CBre_02F,Term_02B,Term_02D,Term_02E,Term_02F,
                     type="text",
                     digits=2)

summary_residual_compare(CBre_02B,CBre_02F,Term_02B,Term_02F,bins=3)
summary_residual_compare(CBre_02D,CBre_02F,Term_02D,Term_02F,bins=3)
summary_residual_compare(CBre_02E,CBre_02F,Term_02E,Term_02F,bins=3)

```
The patterns are roughly similar to those found when only single offer competition is broken out, unfortunately the greater detail is not that illuminating.


Expectation: Contracts with high numbers of offers may have have fewer terminations and ceiling breaches because more competition is available.
### 02G: Log of Number of Offers  
```{r Model02G}
summary_continuous_plot(crisis_smp,"l_Offr")
#Vehicle Crossreference

summary_continuous_plot(crisis_smp,"l_Offr","Veh")


#Model
CBre_02G <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +cl_Offr, family=binomial(link="logit"))
display(CBre_02G)

Term_02G <- glm (data=crisis_smp,
                 b_Term ~ Crisis +cl_Offr, family=binomial(link="logit"))
display(Term_02G)


stargazer::stargazer(CBre_02B,CBre_02D,CBre_02G,Term_02B,Term_02D,Term_02G,
                     type="text",
                     digits=2)

summary_residual_compare(CBre_02B,CBre_02G,Term_02B,Term_02G,bins=3)
summary_residual_compare(CBre_02D,CBre_02G,Term_02D,Term_02G,bins=3)

```
Similar story with number of offers. Closer examination finds that the nature of the relationship varies greatly depending on the contract vehicle. 

Expectation: The literature suggests that competition versus non-competition could be even more important in crisis situations. The base competition variable is still expected to be negative.
### 02H: Number of Offer Categories 
```{r Model02H}

summary_continuous_plot(crisis_smp,"l_Offr","Crisis")

#Model
CBre_02H <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +cl_Offr+
                   cl_Offr:Crisis, family=binomial(link="logit"))
display(CBre_02H)

#Model
Term_02H <- glm (data=crisis_smp,
                 b_Term ~ Crisis +cl_Offr+
                   cl_Offr:Crisis, family=binomial(link="logit"))
display(Term_02H)


stargazer::stargazer(CBre_02B,CBre_02D,CBre_02G,CBre_02H,Term_02B,Term_02D,Term_02G,Term_02H,
                     type="text",
                     digits=2)

summary_residual_compare(CBre_02B,CBre_02H,Term_02B,Term_02H,bins=3)
summary_residual_compare(CBre_02D,CBre_02H,Term_02D,Term_02H,bins=3)
summary_residual_compare(CBre_02G,CBre_02H,Term_02G,Term_02H,bins=3)



```
Interestingly, unlike prior models, the interactions with the log of the number of offers now all have positive coefficient. After all this analysis, sticking with binary competition seems the best choice. The next step will be to add in a consideration of non-competition for urgency reasons.


Expectation: As before, competition has the potential to reduce terminations and ceiling breaches by giving the government more options in vendors and encouraging better behavior from the contractor that was chosen. Urgency exceptions may prove even more hazardous as they were an area of special concern in the literature.
### 02I: No Competition / Competition
```{r Model02I}

summary_discrete_plot(crisis_smp,"NoComp")

#Model
CBre_02I <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp , 
                 family=binomial(link="logit"))
display(CBre_02I)

Term_02I <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp , 
                 family=binomial(link="logit"))
display(Term_02I)


stargazer::stargazer(CBre_02A,CBre_02D,CBre_02I,Term_02B,Term_02D,Term_02I,
                     type="text",
                     digits=2)

summary_residual_compare(CBre_02A,CBre_02I,Term_02B,Term_02I,bins=3)
summary_residual_compare(CBre_02D,CBre_02I,Term_02D,Term_02I,bins=3)

```
As before the expectation is fulfilled for ceiling breaches but not for terminations. Moreover the expectation for urgeny was not found for ceiling breaches and not significant for terminatios.

Urgency estimates a higher probability of ceiling breaches and a lower probability of terminations, but the coefficients are small and not significant.


### 02J: No Competition / Crisis
Expectation: The literature suggests that competition versus non-competition could be even more important in crisis situations. However, the concern regarding urgency seemed more related to its frequency rather than being worse in crisis situations.

```{r Model02J}
summary_discrete_plot(crisis_smp,"NoComp","Crisis")

#Model
CBre_02J <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   Crisis:NoComp, 
                 family=binomial(link="logit"))
display(CBre_02J)

Term_02J <- glm (data=crisis_smp,
                 b_Term ~ Crisis +NoComp +
                   Crisis:NoComp, 
                 family=binomial(link="logit"))
display(Term_02J)


stargazer::stargazer(CBre_02B,CBre_02I,CBre_02J,Term_02B,Term_02I,Term_02J,type="text",
                     digits=2)



summary_residual_compare(CBre_02A,CBre_02J,Term_02B,Term_02J,bins=3)
summary_residual_compare(CBre_02I,CBre_02J,Term_02D,Term_02J,bins=3)

```
The expectation does hold for ceiling breaches for OCO, but not for the other two categories. Urgency is also now estimates a higher probability of ceiling breaches for OCO and non-crisis contracts, but not for ARRA or Disaster contracting. On the termination side, expectations are fulfilled that no competition for crisis funded contracts increases the likelihood of terminations. 

The interaction of OCO and urgency is perhaps most interesting, as it is significantly associated with higher rates of contract termiantion. However, the rarity of terminations for ARRA urgency contracts results in a problematically large standard error. We'll keep the urgency breakout for ceiling breaches but not for terminations.

## Undefinited Contract Awards

### 03A: Undefinitized Contract Awards
Undefinitized Contract Awards allow for quick action in situations where there is not time or information to establish all of a contracts properties at the time of signing. They have been found by the GAO and the Performance of the Defense Acquisition studies to contain notable risks, primarily    relating to cost overruns. 

Expectation: UCA will estimate a higher probability of termination and ceiling breaches.



```{r Model03A}


summary_discrete_plot(crisis_smp,"UCA")

#Model
CBre_03A <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                  Crisis:NoComp, 
                 family=binomial(link="logit"))
display(CBre_03A)

Term_03A <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp +
                   b_UCA+
                  b_NoComp:Crisis, 
                 family=binomial(link="logit"))
display(Term_03A)


stargazer::stargazer(CBre_02J,CBre_03A,Term_02B,Term_03A,type="text",
                     digits=2)

summary_residual_compare(CBre_02J,CBre_03A,Term_02B,Term_03A,bins=3)

```
Expectations are upheld for ceiling breaches but not for terminations.

### 03B: UCA and Crisis

Expectation: Unclear. The risks of UCA are well established.They are more commonly used for crisis funding, however, unlike competition there was not specific evidence found in the literature review that crises exacerbate their risk.

```{r Model03B}
summary_discrete_plot(crisis_smp,"UCA","Crisis")

summary_discrete_plot(crisis_smp,"UCA","Comp")




#Create the model
#Model
CBre_03B <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                  Crisis:NoComp+
                   b_UCA:Crisis , 
                 family=binomial(link="logit"))
display(CBre_03B)

Term_03B <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp +
                   b_UCA+
                  b_NoComp:Crisis+
                   b_UCA:Crisis , 
                 family=binomial(link="logit"))
display(Term_03B)


stargazer::stargazer(CBre_03A,CBre_03B,Term_03A,Term_03B,type="text",
                     digits=2)


summary_residual_compare(CBre_03A,CBre_03B,Term_03A,Term_03B,bins=3)

```
Expectations were not supported.

In exploratory graphs, the interaction of UCA and appear to be largely absent for breaches and while present for terminations, given that competition for terminations has a small coefficient and is not significant, it's probably not time to add an interaction. Instead this step adds an interaction between UCAs and crisis funds. The result is striking, in aknist all cases, UCAs for crisis funds have lower correlation with negative outcomes than those in the general contract population. In many cases, the coefficient is sufficient to cancel out much of the estimate for UCA directly, although for OCO ceiling breaches the coefficient is only reduced by roughly a half.

For terminations, nothing reaches 0.05 p-value significance and contrary to expectation that OCO funded UCAs would estimate a lower risk of terminations. However, this is an interaction directly relevant to a hypothesis, so keeping it in.

## Reachback Contracting


### 04A: Off. Crisis %
Expectation: Crisis-contracting is challenging, and there will be an estimated positive relationship between the percentage of crisis contracting an office performs and its ceiling breach and termination rate.

```{r Model04A}
#The model building did experiment with sqrts for before deciding against them for intepretability reasons.
crisis_smp$sqrt_OffCri<-sqrt(crisis_smp$OffCri)

corrdisp<-Hmisc::rcorr(as.matrix(cbind(subset(crisis_smp, select=c(b_UCA,
                                                             c_OffCri,cl_Ceil,
                                               cl_Days,n_Fixed,b_Intl)),
                       dummies::dummy(crisis_smp$Crisis),
                       dummies::dummy(crisis_smp$NoComp))))
corrdisp[[1]]
summary_continuous_plot(crisis_smp,"OffCri",bins=50)


#Ceiling Breaches
gridExtra::grid.arrange(freq_continuous_cbre_plot(crisis_smp,"c_OffCri"),
             binned_percent_cbre_plot(crisis_smp,"c_OffCri")+geom_vline(xintercept=c(0.1,0.10,0.25)))


#Terminations
gridExtra::grid.arrange(freq_continuous_term_plot(crisis_smp,"c_OffCri"),
                        binned_percent_term_plot(crisis_smp,"c_OffCri")+geom_vline(xintercept=c(0.1,0.10,0.25)))


#Model

CBre_04A <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+c_OffCri+ 
                  Crisis:NoComp+
                   b_UCA:Crisis , 
                 family=binomial(link="logit"))
display(CBre_04A)

Term_04A <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp +
                   b_UCA+c_OffCri+
                  b_NoComp:Crisis , 
                 family=binomial(link="logit"))
display(Term_04A)



stargazer::stargazer(CBre_03B,CBre_04A,Term_03A,Term_04A,type="text",
                     digits=2)

summary_residual_compare(CBre_03B,CBre_04A,Term_03A,Term_04A,bins=3)
```
The estimate was vindicated in for both outcomes.

Adding the confirmed crisis percent for contracting offices does align with the reachback hypothesis, with a large and significant coefficient for both terminations and ceiling breaches. The coefficient is small enough that we are not exploring interactions at this time. The next step is to look at contracting office location instead.


### 04B: OffPl. Score
Expectations: While not all international contracting is crisis related, internationally focused contracting offices seem like to encounter a range of challenges. The percent of obligations of an contracting office that takes place internationally will estimate a positive relationship with terminations and ceiling breaches.
```{r Model04B}

summary_continuous_plot(crisis_smp,"OffIntl",bins=50)
summary_continuous_plot(crisis_smp,"OffIntl","Crisis",bins=50)

corrdisp<-Hmisc::rcorr(as.matrix(cbind(subset(crisis_smp, select=c(
  b_UCA,c_OffCri,OffIntl,cl_Ceil,
  cl_Days,n_Fixed,b_Intl)),
  dummies::dummy(crisis_smp$Crisis),
  dummies::dummy(crisis_smp$NoComp))))

corrdisp[[1]][,3]
#Model
CBre_04B <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffIntl+
                  Crisis:NoComp+

                   b_UCA:Crisis , 
                 family=binomial(link="logit"))
display(CBre_04B)

Term_04B <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp +
                   b_UCA+OffIntl+
                  b_NoComp:Crisis, 
                 family=binomial(link="logit"))
display(Term_04B)


stargazer::stargazer(CBre_03B,CBre_04B,Term_03B,Term_04B,type="text",
                     digits=2)

summary_residual_compare(CBre_03B,CBre_04B,Term_03A,Term_04B,bins=3)
summary_residual_compare(CBre_04A,CBre_04B,Term_04A,Term_04B)

```
The expectations are upheld for ceiling breaches but countered for terminations, significantly in both cases.

The measure of location of the contracting office, with scores from 0 (place of performance entirely U.S.) to 1 (place of performance entirely international) is most relevant to OCO. Initially contrary to the hypothesis, the termination  rate appears higher at home than in field offices. The coefficient for base OCO contracting also rises strikingly. The results for ceiling breaches are not significant.

### 04C: Both OffPl. Score & Crisis %
Expectation: Inclusion of both variables will not change the sign from being a positive relationship in each case.

```{r Model04C}
summary_double_continuous(crisis_smp,"OffIntl","c_OffCri")
summary_continuous_plot(crisis_smp,"OffIntl","Crisis",bins=40)

corrdisp<-Hmisc::rcorr(as.matrix(cbind(subset(crisis_smp, select=c(b_UCA,
                                                             c_OffCri,OffIntl,cl_Ceil,
                                               cl_Days,n_Fixed,b_Intl)),
                       dummies::dummy(crisis_smp$Crisis),
                       dummies::dummy(crisis_smp$NoComp))))
corrdisp[[1]]

#Model
CBre_04C <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffIntl+c_OffCri+
                  Crisis:NoComp+
                   b_UCA:Crisis,
                 family=binomial(link="logit"))
display(CBre_04C)

Term_04C <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp +
                   b_UCA+
                   OffIntl+c_OffCri+
                  b_NoComp:Crisis+
                   b_UCA:Crisis,
                 family=binomial(link="logit"))
display(Term_04C)


stargazer::stargazer(CBre_04A,CBre_04B,CBre_04C,Term_04A,Term_04B,Term_04C,type="text",
                     digits=2)

summary_residual_compare(CBre_04A,CBre_04C,Term_04A,Term_04C)
summary_residual_compare(CBre_04B,CBre_04C,Term_04B,Term_04C)

```


When both variables are in place, international offices have singificantly lower rates of negative outcomes, but for percent crisis spending remains supportive of the hypothesis, albeit with a small coefficient. This model reduces deviance for ceiling breaches by just a little, but for terminations the games are more subtantial, albeit accompanied by an increase in residuals.


### 04D: OffPl. 99% 

```{r Model04D}


#Office square root is including for graphing purposes.
#The model building did experiment with sqrts before deciding against them for intepretability reasons.
crisis_smp$sqrt_OffIntl<-sqrt(crisis_smp$OffIntl)


quantile(fed$OffIntl,c(0.1,0.25,0.33,0.4,0.45,0.5,0.6,0.66,0.7,0.75,0.8),na.rm = TRUE)
quantile(crisis_smp$OffIntl,c(0.25,0.5,0.6,0.66,0.7,0.75,0.8),na.rm = TRUE)


crisis_smp$OffPl99<-Hmisc::cut2(crisis_smp$OffIntl,c(0.01,0.50))
summary(crisis_smp$OffPl99)
  levels(crisis_smp$OffPl99) <-
    list("US99"=c("[0.00,0.01)"),
         "Mixed"=c("[0.01,0.50)"),
         "Intl"=c("[0.50,1.00]"))

  
corrdisp<-Hmisc::rcorr(as.matrix(cbind(subset(crisis_smp, select=c(
  b_UCA,c_OffCri,OffIntl,cl_Ceil,
  cl_Days,n_Fixed,b_Intl)),
  dummies::dummy(crisis_smp$Crisis),
  dummies::dummy(crisis_smp$NoComp),
  dummies::dummy(crisis_smp$OffPl99))))

corrdisp[[1]]

  

summary(crisis_smp$OffPl99)





#Three place categories
summary_discrete_plot(crisis_smp,"OffPl99")
summary_continuous_plot(crisis_smp,"OffIntl",bins=100)


# summary_continuous_plot(crisis_smp,"sqrt_OffIntl",bins=100)


#Crisis
summary_discrete_plot(crisis_smp,"OffPl99","Crisis")
summary_continuous_plot(crisis_smp,"OffIntl","Crisis",bins=100)
# summary_continuous_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=100)




#Office Place
#Ceiling Breaches
gridExtra::grid.arrange(freq_continuous_cbre_plot(crisis_smp,"sqrt_OffIntl",bins=50)+aes(fill=OffPl99)+geom_vline(xintercept=c(0.1,1.73)),
             binned_percent_cbre_plot(crisis_smp,"sqrt_OffIntl",bins=50)+geom_vline(xintercept=c(0.1,1.73)))


#Terminations
gridExtra::grid.arrange(freq_continuous_term_plot(crisis_smp,"sqrt_OffIntl",bins=50)+aes(fill=OffPl99),
                        binned_percent_term_plot(crisis_smp,"sqrt_OffIntl",bins=50)+geom_vline(xintercept=c(0.1,1.87)))


#Office Place crossreferenced with Crisis
#Ceiling Breaches
gridExtra::grid.arrange(freq_continuous_cbre_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+aes(fill=OffPl99),
             binned_percent_cbre_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+geom_vline(xintercept=c(0.1,1.87)))


#Terminations
gridExtra::grid.arrange(freq_continuous_term_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+aes(fill=OffPl99),
                        binned_percent_term_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+geom_vline(xintercept=c(0.1,1.87)))

#Model
CBre_04D <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+
                  Crisis:NoComp+
                   b_UCA:Crisis, 
                 family=binomial(link="logit"))
display(CBre_04D)

Term_04D <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp +
                   b_UCA+
                   OffPl99+
                   b_NoComp:Crisis+
                   b_UCA:Crisis , 
                 family=binomial(link="logit"))
display(Term_04D)


stargazer::stargazer(CBre_04A,CBre_04C,CBre_04D,Term_04A,Term_04C,Term_04D,type="text",
                     digits=2)


summary_residual_compare(CBre_04B,CBre_04D,Term_04B,Term_04D)
summary_residual_compare(CBre_04C,CBre_04D,Term_04C,Term_04D,bins=1)

```
Drawing the line at 0.01 is a judgment call, based on the fact that 25% of contracts have a contracting office with a location score of 0.01 or below. Expanding to federal government wide, the percent is 45. Only about 8% of federal contracts by value are from contracting offices with 0% international contracts.The use of dummy variables greatly improves the interpretability of the model and comparable reduction in deviance, better for ceiling breaches, a bit worse for terminations.
 The next step will be to look at setting the cutt off for the first category to a location score of 0.05 or a minimum of 95% having a place of performance in the United States (the score rises even faster for contingency contracting environments). 

### 04E: Both OffPl. 99% & %

```{r Model04E}

summary_continuous_plot(crisis_smp,"OffCri","OffPl99",bins=50)


sum(crisis_smp$Action.Obligation[ crisis_smp$OffIntl<0.01],na.rm=TRUE)/
  sum(crisis_smp$Action.Obligation,na.rm=TRUE)
sum(crisis_smp$Action.Obligation[ crisis_smp$OffIntl<0.05&
                                   crisis_smp$OffIntl>=0.01],na.rm=TRUE)/
  sum(crisis_smp$Action.Obligation,na.rm=TRUE)
sum(crisis_smp$Action.Obligation[ crisis_smp$OffIntl<0.25&
                                   crisis_smp$OffIntl>=0.05],na.rm=TRUE)/
  sum(crisis_smp$Action.Obligation,na.rm=TRUE)
sum(crisis_smp$Action.Obligation[ crisis_smp$OffIntl>=0.25&
                                   crisis_smp$OffIntl<0.50],na.rm=TRUE)/
  sum(crisis_smp$Action.Obligation,na.rm=TRUE)
sum(crisis_smp$Action.Obligation[ crisis_smp$OffIntl>=0.50],na.rm=TRUE)/
  sum(crisis_smp$Action.Obligation,na.rm=TRUE)


sum(fed$Action.Obligation[ fed$OffIntl<=0.01],na.rm=TRUE)/
  sum(fed$Action.Obligation,na.rm=TRUE)
sum(fed$Action.Obligation[ fed$OffIntl<=0.00],na.rm=TRUE)/
  sum(fed$Action.Obligation,na.rm=TRUE)


summary(crisis_smp$OffPl99)
quantile(crisis_smp$OffIntl,c(0.25,0.5,0.6,0.66,0.7,0.75,0.8),na.rm = TRUE)

#Office Place 4 category
#Ceiling Breaches
gridExtra::grid.arrange(freq_discrete_cbre_plot(crisis_smp,"OffPl99"),
                        discrete_percent_cbre_plot(crisis_smp,"OffPl99"))
                        
#Terminations
gridExtra::grid.arrange(freq_discrete_term_plot(crisis_smp,"OffPl99"),
                        discrete_percent_term_plot(crisis_smp,"OffPl99"))



#Ceiling Breaches
gridExtra::grid.arrange(freq_discrete_cbre_plot(crisis_smp,"OffPl99","Crisis"),
                        discrete_percent_cbre_plot(crisis_smp,"OffPl99","Crisis"))
                        
#Terminations
gridExtra::grid.arrange(freq_discrete_term_plot(crisis_smp,"OffPl99","Crisis"),
                        discrete_percent_term_plot(crisis_smp,"OffPl99","Crisis"))



#Office Place
#Ceiling Breaches
gridExtra::grid.arrange(freq_continuous_cbre_plot(crisis_smp,"sqrt_OffIntl",bins=50)+aes(fill=OffPl99),
             binned_percent_cbre_plot(crisis_smp,"sqrt_OffIntl",bins=50)+geom_vline(xintercept=c(0.1,0.25,1.87)))


#Terminations
gridExtra::grid.arrange(freq_continuous_term_plot(crisis_smp,"sqrt_OffIntl",bins=50)+aes(fill=OffPl99),
                        binned_percent_term_plot(crisis_smp,"sqrt_OffIntl",bins=50)+geom_vline(xintercept=c(0.1,0.25,1.87)))


#Office Place crossreferenced with Crisis
#Ceiling Breaches
gridExtra::grid.arrange(freq_continuous_cbre_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+aes(fill=OffPl99),
             binned_percent_cbre_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+geom_vline(xintercept=c(0.1,0.25,1.87)))


#Terminations
gridExtra::grid.arrange(freq_continuous_term_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+aes(fill=OffPl99),
                        binned_percent_term_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+geom_vline(xintercept=c(0.1,0.25,1.87)))


#Model
CBre_04E <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+c_OffCri+
                  Crisis:NoComp+
                   b_UCA:Crisis, 
                 family=binomial(link="logit"))
display(CBre_04E)

Term_04E <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp +
                   b_UCA+
                   OffPl99+c_OffCri+
                  b_NoComp:Crisis+
                   b_UCA:Crisis, 
                 family=binomial(link="logit"))
display(Term_04E)


stargazer::stargazer(CBre_04C,CBre_04D,CBre_04E,Term_04C,Term_04D,Term_04E,type="text",
                     digits=2)


# Plot the model and Vehicle 
CBre_04B_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV) %*%  coef(CBre_04B))}



summary_residual_compare(CBre_04B,CBre_04E,Term_04B,Term_04E,bins=5)
summary_residual_compare(CBre_04C,CBre_04E,Term_04C,Term_04E,bins=5)
summary_residual_compare(CBre_04D,CBre_04E,Term_04D,Term_04E,bins=5)


# residuals_cbre_plot(CBre_02F,"cl_days")+
#   labs(x="Centered Log(Days)")

```
While the deviance reduction is slightly greater for 

### 04F: OffPl. 95%

```{r Model04F}


crisis_smp$OffPl95<-Hmisc::cut2(crisis_smp$OffIntl,c(0.05,0.75))


summary(crisis_smp$OffPl95)
  levels(crisis_smp$OffPl95) <-
    list("US95"=c("[0.00,0.05)"),
         "Mixed75"=c("[0.05,0.75)"),
         "Intl"=c("[0.75,1.00]"))

summary_discrete_plot(crisis_smp,"OffPl95")
summary_discrete_plot(crisis_smp,"Intl","OffPl95")


#Model
CBre_04F <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl95+
                  Crisis:NoComp+

                   b_UCA:Crisis, 
                 family=binomial(link="logit"))
display(CBre_04F)

Term_04F <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp +
                   b_UCA+
                   OffPl95+
                  b_NoComp:Crisis+

                   b_UCA:Crisis , 
                 family=binomial(link="logit"))
display(Term_04F)


stargazer::stargazer(CBre_04C,CBre_04E,CBre_04F,Term_04C,Term_04E,Term_04F,type="text",
                     digits=2)


# Plot the model and Vehicle 
CBre_04B_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV) %*%  coef(CBre_04B))}


summary_residual_compare(CBre_04C,CBre_04F,Term_04C,Term_04F,bins=0)
summary_residual_compare(CBre_04D,CBre_04F,Term_04D,Term_04F,bins=5)
summary_residual_compare(CBre_04E,CBre_04F,Term_04E,Term_04F,bins=0)


```
The higher standard, with roughly half of contracts falling beneath it, is more interperable, the 5% standard interestingly swaps the sign of the mixed category in both cases, with breaches going from lower to higher risk, and vice versa for terminations. For Iraq/Afghanistan, the lower risk remains in both cases. The 5% standard is more interesting for research purposes because it's better able to capture the theory of reachback contracting offices, ones that are primarily domestic but that do some international support. 

### 04G: Both OffPl. 95% & Crisis %

```{r Model04G}

summary_continuous_plot(crisis_smp,"OffCri","OffPl95",bins=50)



#Office Place crossreferenced with Crisis
#Ceiling Breaches
gridExtra::grid.arrange(freq_continuous_cbre_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+aes(fill=OffPl95),
             binned_percent_cbre_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+geom_vline(xintercept=c(0.1,0.5,1.87)))


#Terminations
gridExtra::grid.arrange(freq_continuous_term_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+aes(fill=OffPl95),
                        binned_percent_term_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+geom_vline(xintercept=c(0.1,0.5,1.87)))

#Model
CBre_04G <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl95+c_OffCri+
                  Crisis:NoComp+

                   b_UCA:Crisis, 
                 
                 family=binomial(link="logit"))
display(CBre_04G)

Term_04G <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp +
                   b_UCA+
                   OffPl95+c_OffCri+
                  b_NoComp:Crisis+

                   b_UCA:Crisis , 
                 family=binomial(link="logit"))
display(Term_04G)


stargazer::stargazer(CBre_04E,CBre_04F,CBre_04G,Term_04E,Term_04F,Term_04G,type="text",
                     digits=2)


# Plot the model and Vehicle 
CBre_04B_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV) %*%  coef(CBre_04B))}

summary_residual_compare(CBre_04C,CBre_04G,Term_04C,Term_04G)
summary_residual_compare(CBre_04E,CBre_04G,Term_04E,Term_04G)
summary_residual_compare(CBre_04F,CBre_04G,Term_04F,Term_04G)


```

The deviation reduction is slightly greater for this version, but the residuals are no better and 04E is somewhat easier to interpret. Pushing that logic further the next step is to look at a simple binary, above or below 50%.
### 04H: OffPl. 50%

```{r Model04H}


crisis_smp$OffPl50<-Hmisc::cut2(crisis_smp$OffIntl,c(0.50))
summary(crisis_smp$OffPl50)
summary_discrete_plot(crisis_smp,"Intl","OffPl50")


corrdisp<-Hmisc::rcorr(as.matrix(cbind(subset(crisis_smp, select=c(
  b_UCA,c_OffCri,OffIntl,cl_Ceil,
  cl_Days,n_Fixed,b_Intl)),
  dummies::dummy(crisis_smp$Crisis),
  dummies::dummy(crisis_smp$NoComp),
  dummies::dummy(crisis_smp$OffPl50))))

corrdisp[[1]]

  levels(crisis_smp$OffPl50) <-
    list("US50"=c("[0.0,0.5)"),
         "Intl50"=c("[0.5,1.0]"))


summary(crisis_smp$OffPl50)
  
summary_discrete_plot(crisis_smp,"OffPl50")


#Model
CBre_04H <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl50+
                  Crisis:NoComp+
                   b_UCA:Crisis, 
                 family=binomial(link="logit"))
display(CBre_04H)

Term_04H <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp +
                   b_UCA+
                   OffPl50+
                  b_NoComp:Crisis+
                   b_UCA:Crisis , 
                 family=binomial(link="logit"))
display(Term_04H)


stargazer::stargazer(CBre_04F,CBre_04G,CBre_04H,Term_04F,Term_04G,Term_04H,type="text",
                     digits=2)


# Plot the model and Vehicle 
CBre_04B_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV) %*%  coef(CBre_04B))}

summary_residual_compare(CBre_04F,CBre_04H,Term_04F,Term_04H, bins=3)
summary_residual_compare(CBre_04G,CBre_04H,Term_04G,Term_04H, bins=0)
```





### 04I: Both OffPl. 50% & Crisis

```{r Model04I}

summary_continuous_plot(crisis_smp,"OffCri","OffPl50",bins=50)



#Office Place crossreferenced with Crisis
#Ceiling Breaches
gridExtra::grid.arrange(freq_continuous_cbre_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+aes(fill=OffPl50),
             binned_percent_cbre_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+geom_vline(xintercept=c(0.5,1.87)))


#Terminations
gridExtra::grid.arrange(freq_continuous_term_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+aes(fill=OffPl50),
                        binned_percent_term_plot(crisis_smp,"sqrt_OffIntl","Crisis",bins=50)+geom_vline(xintercept=c(0.5,1.87)))

#Model
CBre_04I <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl50+c_OffCri+
                  Crisis:NoComp+

                   b_UCA:Crisis, 
                 
                 family=binomial(link="logit"))
display(CBre_04I)

Term_04I <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp +
                   b_UCA+
                   OffPl50+c_OffCri+
                  b_NoComp:Crisis+
                   b_UCA:Crisis, 
                 family=binomial(link="logit"))
display(Term_04I)


stargazer::stargazer(CBre_04G,CBre_04H,CBre_04I,Term_04G,Term_04H,Term_04I,type="text",
                     digits=2)


# Plot the model and Vehicle 
CBre_04B_curve<-function(x, Comp,Ceil,Days,SIDV,MIDV,OIDV,Fixed){invlogit(
  cbind(1,Comp,Ceil,Days,SIDV,MIDV,OIDV,
        Comp*Ceil,Days*Ceil,Days*Comp,
        Fixed,x,
        Days*x,Days*MIDV,Days*OIDV,
        Comp*x,Comp*MIDV,Comp*OIDV) %*%  coef(CBre_04B))}

summary_residual_compare(CBre_04G,CBre_04I,Term_04G,Term_04I)
summary_residual_compare(CBre_04H,CBre_04I,Term_04H,Term_04I, bins=3)
```
Unfortunately, even the simplest of the interactions make interpretation much harder, as the standard errors are huge for Iraq-Afghanistan. The increase in Akaike Inf. Citeria is also worth noting for Terminations.


### 04J: OffPl. 99% & UCA
Expectation: Reachback contractors may be better able to handle UCA contracts.

Expectation: Per reachback contracting, in theory, domestically oriented contracting offices may be more capable 

```{r Model04J}

summary_discrete_plot(crisis_smp,"UCA","OffPl99")
summary_continuous_plot(crisis_smp,"OffCri","UCA",bins=50)
summary_discrete_plot(crisis_smp,"UCA","Crisis")

#Model



CBre_04J <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+c_OffCri+
                   Crisis:NoComp+
                   b_UCA:Crisis+
                   b_UCA:OffPl99, 
                 
                 family=binomial(link="logit"))
display(CBre_04J)

Term_04J <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp +
                   b_UCA+
                   OffPl99+c_OffCri+
                   b_NoComp:Crisis+
                   b_UCA:Crisis+
                   b_UCA:OffPl99 , 
                 family=binomial(link="logit"))
display(Term_04J)


stargazer::stargazer(CBre_04E,CBre_04J,Term_04E,Term_04J,type="text",
                     digits=2)

summary_residual_compare(CBre_04E,CBre_04J,Term_04E,Term_04J)


```
Expectations were countered, however the VIFof UCA went above 2 in both cases, suggesting that the reason for this change might be multicollinearity. Leaving this out. Leaving this out. 


### 04K: Off. Crisis % & Crisis

Expectation: International contracting offices will estimate a higher probability of terminations and ceiling breaches for OCO and Disaster contracts. Even so, the stand-alone international percentagee is expected to allso have have a positive relationship. ARRA was domestically focused, and the study team has no expectations in that regard. 

```{r Model04K}


summary_discrete_plot(crisis_smp,"OffPl99","Crisis")
summary_continuous_plot(crisis_smp,"OffCri","Crisis")


#Model
CBre_04K <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  Crisis:NoComp+
                   b_UCA:Crisis+
                   OffPl99:Crisis, 
                 family=binomial(link="logit"))
display(CBre_04K)

Term_04K <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  b_NoComp:Crisis+
                   b_UCA:Crisis +
                   OffPl99:Crisis, 
                 family=binomial(link="logit"))
display(Term_04K)


stargazer::stargazer(CBre_04E,CBre_04K,Term_04E,Term_04K,type="text",
                     digits=2)


summary_residual_compare(CBre_04E,CBre_04K,Term_04E,Term_04K,bins=3)



```
Expectations were countered for ceiling breaches but a more mixed bag for terminations. The VIF for Office Place was  driven above 2 in both cases. Leaving this interaction out.



### 04L: Off. Crisis % & Comp
Expectation: Weak expectation that no competition will have a positive estimate of the probability of ceiling breaches and terminations. This relationship would be better captured by crisis funding directly, but fears of cronyism in international contracting can extend beyond crisis situations.

```{r Model04L}
summary_discrete_plot(crisis_smp,"OffPl99","NoComp")
summary_discrete_plot(crisis_smp,"NoComp","OffPl99")
summary_continuous_plot(crisis_smp,"OffCri","NoComp")



#Model
CBre_04L <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  Crisis:NoComp+
                   b_UCA:Crisis+
                   
                   OffPl99:NoComp, 
                 family=binomial(link="logit"))
display(CBre_04L)

Term_04L <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  b_NoComp:Crisis+
                   b_UCA:Crisis +
                   
                   OffPl99:b_NoComp, 
                 family=binomial(link="logit"))
display(Term_04L)

stargazer::stargazer(CBre_04E,CBre_04L,Term_04E,Term_04L,type="text",
                     digits=2)



summary_residual_compare(CBre_04E,CBre_04L,Term_04E,Term_04L,bins=5)



```
Expectations were partially fulfilled. A significant positive relationship is present for urgency in particular. However, the sign goes in the opposite direction for other forms of contracting, albeit not significantly. The strong negative relationship for mixed contracting office is surprising, but not directly addressed by the expectation. The new interaction drives the VIF for competition above 2 in both  cases, leaving this ariable out. 

##Scope Variables
### Ceiling
#### 05A: Cost Ceiling

The model starts by examing the influence of large ceilings on contracts, the core idea here, as observed in the fixed priced paper, is that larger contracts are at greater risk of termination. This can be explained by both the inherent risk in the contract and high transaction costs of contract termination which discourage making the effort for smaller contracts.

Expectation: Initial Ceiling size positively estimates increasing probability of ceiling breaches and terminations.

```{r Model05A}
#Frequency Plot for unlogged ceiling
freq_continuous_cbre_plot(crisis_smp,"UnmodifiedContractBaseAndAllOptionsValue",
               bins=1000)
freq_continuous_cbre_plot(subset(crisis_smp,UnmodifiedContractBaseAndAllOptionsValue<100000000),
               "UnmodifiedContractBaseAndAllOptionsValue",
               bins=1000)

summary_continuous_plot(crisis_smp,"l_Ceil",bins=50)
summary(crisis_smp$l_Ceil)

str(crisis_smp)
#Model
CBre_05A <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   Crisis:NoComp+
                   b_UCA:Crisis, 
                 family=binomial(link="logit"))
display(CBre_05A)

Term_05A <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   b_NoComp:Crisis+
                   b_UCA:Crisis, 
                 family=binomial(link="logit"))
display(Term_05A)



stargazer::stargazer(CBre_04E,CBre_05A,Term_04E,Term_05A,type="text",
                     digits=2)

summary_residual_compare(CBre_04E,CBre_05A,Term_04E,Term_05A,bins=NA)


```

Expectations were upheld. The addition of the new variable did raise the VIF for both No Competition and for UCA. Ceiling itself has no challenges, so instead we will drop UCA:Crisis for Ceiling Breaches, because the study team did not find a clear rationale for that connection in the literature.

Contract ceiling has a significant relationship, though the residuals show a possible non-linear patterns. This is most remarkable in the positive centered values between 0 and 1. This may be driven  by a missing value and is worth watching.


```{r Model05A}
#Frequency Plot for unlogged ceiling
freq_continuous_cbre_plot(crisis_smp,"UnmodifiedContractBaseAndAllOptionsValue",
               bins=1000)
freq_continuous_cbre_plot(subset(crisis_smp,UnmodifiedContractBaseAndAllOptionsValue<100000000),
               "UnmodifiedContractBaseAndAllOptionsValue",
               bins=1000)

summary_continuous_plot(crisis_smp,"l_Ceil",bins=50)
summary(crisis_smp$l_Ceil)

str(crisis_smp)
#Model
CBre_05A <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   Crisis:NoComp+
                   b_UCA:Crisis, 
                 family=binomial(link="logit"))
display(CBre_05A)

Term_05A <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   b_NoComp:Crisis+
                   b_UCA:Crisis, 
                 family=binomial(link="logit"))
display(Term_05A)



stargazer::stargazer(CBre_04E,CBre_05A,Term_04E,Term_05A,type="text",
                     digits=2)

summary_residual_compare(CBre_04E,CBre_05A,Term_04E,Term_05A,bins=NA)


```



#### 05B: Cost Ceiling and Crisis

Expectation: Crisis contracting will magnify the risk of large contracts and thus the interaction positively estimates increasing probability of ceiling breaches and terminations.

```{r Model05B}


summary_continuous_plot(crisis_smp,"l_Ceil","Crisis")
summary_continuous_plot(crisis_smp,"l_Ceil","c_OffCri")

#Model
CBre_05B <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                  Crisis:NoComp+
                   cl_Ceil:Crisis, 
                 family=binomial(link="logit"))
display(CBre_05B)

Term_05B <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                  b_NoComp:Crisis+

                   b_UCA:Crisis+
                   cl_Ceil:Crisis,
                 family=binomial(link="logit"))
display(Term_05B)



stargazer::stargazer(CBre_05A,CBre_05B,Term_05A,Term_05B,type="text",
                     digits=2)

summary_residual_compare(CBre_05A,CBre_05B,Term_05A,Term_05B)

```
The expectation was upheld. However, the VIF does exceed 2 for the new interaction for ceiling breaches and also for No Competition. For ceiling breaches, removing both Crisis:NoComp and sadly Crisis:cl_Ceil. 

For the Recovery Act and disasters, higher ceiling contracts are associated with greater contract risk by both measures. For OCO, the greater risk is only the case for terminations. For terminations, the overall risk associated with larger cost ceilings has also vanished.




#### 05C: Cost Ceiling and UCA

Expectation: Weakly expecting a positive relationship between the interation of UCA and ceiling size and the estimated probability of ceiling breaches and terminations.

```{r Model05C}



summary_continuous_plot(crisis_smp,"l_Ceil","c_OffCri")
summary_continuous_plot(crisis_smp,"l_Ceil","OffPl99")
summary_continuous_plot(crisis_smp,"l_Ceil","UCA")
#Model
CBre_05C <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ 
                   c_OffCri+
                   cl_Ceil+
                   cl_Ceil:b_UCA,
                 family=binomial(link="logit"))
display(CBre_05C)

Term_05C <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp+
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                  b_NoComp:Crisis+

                   b_UCA:Crisis+
                   cl_Ceil:Crisis+
                   cl_Ceil:b_UCA, 
                 family=binomial(link="logit"))
display(Term_05C)

# texreg::texreg(list(CBre_05A,CBre_05B,CBre_05C,Term_05A,Term_05B,Term_05C))

stargazer::stargazer(CBre_05A,CBre_05B,CBre_05C,Term_05A,Term_05B,Term_05C,type="text",
                     digits=2,keep.stat=c("n","aic","res.dev","null.dev"))


summary_residual_compare(CBre_05A,CBre_05C,Term_05B,Term_05C)

```
Contrary to expectations, low ceiling UCAs are associated with higher risk of ceiling breaches than high ceiling UCAs, though UCAs in general remain associated with high rates of breaches. This relationship is not signicant to the 0.05 level for terminations. Examining the descriptive statistics it the pattern for binned probability of ceiling breach versus ceiling size does not show the pattern in question. Leaving it off as the deviance reduction is minimal in both cases and the residuals show a greater pattern after introduction. 



#### 05D: Cost Ceiling and Office Place


Expectations: The interaction of larger contract ceilings and internationally oriented contracting offices will positively estimate the probability of ceiling breaches and terminations.
```{r Model05D}



summary_double_continuous(crisis_smp,"l_Ceil","c_OffCri")
summary_continuous_plot(crisis_smp,"l_Ceil","OffPl99")

#Model
CBre_05D <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Ceil:OffPl99, 
                 family=binomial(link="logit"))
display(CBre_05D)

Term_05D <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp+
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                  b_NoComp:Crisis+
                   b_UCA:Crisis+
                   cl_Ceil:Crisis+
                   cl_Ceil:OffPl99, 
                 family=binomial(link="logit"))
display(Term_05D)

# texreg::texreg(list(CBre_05A,CBre_05B,CBre_05D,Term_05A,Term_05B,Term_05D))

stargazer::stargazer(CBre_05A,CBre_05D,Term_05B,Term_05D,type="text",
                     digits=2,keep.stat=c("n","aic","res.dev","null.dev"))

summary_residual_compare(CBre_05B,CBre_05D,Term_05B,Term_05D)

```
Expectations are defied, as ceiling breaches prove to have less predictive power for 

For Ceiling breaches, the new relationship is significant but also throws off fitted vs. actual values and increases residuals. For terminations, the coefficients are greater and cl_ceiling gains a larger coefficient. Dropping for both.


#### 05E: Cost Ceiling and Competition

Expectation: This is challenging, as competition for the largest contracts may encourage bidding to win rather than realistic pricing. The primary expectation is that competition will positively estimate a the probability of ceiling breaches and terminations.

```{r Model05E}
summary_continuous_plot(crisis_smp,"l_Ceil","NoComp")
#Model
CBre_05E <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                 cl_Ceil:NoComp, 
                 family=binomial(link="logit"))
display(CBre_05E)

Term_05E <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp+
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                  b_NoComp:Crisis+
                   b_UCA:Crisis+
                   cl_Ceil:Crisis+
                 cl_Ceil:b_NoComp, 
                 family=binomial(link="logit"))
display(Term_05E)
# texreg::texreg(list(CBre_05A,CBre_05B,CBre_05E,Term_05A,Term_05B,Term_05E))

stargazer::stargazer(CBre_05A,CBre_05E,Term_05B,Term_05E,type="text",
                     digits=2,keep.stat=c("n","aic","res.dev","null.dev"))

summary_residual_compare(CBre_05B,CBre_05E,Term_05B,Term_05E)

```
For ceiling breaches, the somewhat complex and weak expectations are supported. No competition significantly and positively estimates a higher rate of ceiling breaches and terminations, however, this is countered by the interaction of competition and ceiling size. For terminations, the sign does not flip to positive for competition and the VIF exceeds 2.0. Leaving it out for terminations.

#### 05F: Square Root of Ceiling
```{r Model05F}
#Frequency Plot for unlogged ceiling
crisis_smp$sqrt_ceil<-sqrt(crisis_smp$UnmodifiedContractBaseAndAllOptionsValue)
crisis_smp$csqrt_ceil<-scale(crisis_smp$sqrt_ceil)
freq_continuous_cbre_plot(crisis_smp,"sqrt_ceil",
               bins=1000)

summary_continuous_plot(crisis_smp,"csqrt_ceil",bins=50)
summary(crisis_smp$l_Ceil)

str(crisis_smp)
#Model
CBre_05F <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+csqrt_ceil+
                   Crisis:NoComp+
                   b_UCA:Crisis, 
                 family=binomial(link="logit"))
display(CBre_05F)

Term_05F <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+csqrt_ceil+
                   b_NoComp:Crisis+
                   b_UCA:Crisis, 
                 family=binomial(link="logit"))
display(Term_05F)



stargazer::stargazer(CBre_05A,CBre_05F,Term_05B,Term_05F,type="text",
                     digits=2,keep.stat=c("n","aic","res.dev","null.dev"))

summary_residual_compare(CBre_05B,CBre_05F,Term_05B,Term_05F)

```
This addition magnifies residuals, the opposite of the desired effect. Leaving it out.

#### 05G: Addressing the right skew of the data
The challenges in the residuals for ceiling prompt a closer look at the data. 

```{r Explore05G}


freq_continuous_plot(crisis_smp,"l_Ceil",
               bins=100)+geom_vline(xintercept=log(2500))

freq_continuous_plot(crisis_smp,"l_Ceil","Veh",
               bins=100)+geom_vline(xintercept=log(2500))

binned_percent_plot(crisis_smp,"l_Ceil",bins=100)+
  geom_vline(xintercept=log(2500))+
  geom_vline(xintercept=log(150000))

binned_percent_plot(crisis_smp,"l_Ceil","Veh",bins=100)+
  geom_vline(xintercept=log(2500))+
  geom_vline(xintercept=log(150000))
```
Two vertical lines are added to this plot, one for the lowest micro-purchase threshold during this period USD2,500. The other is the low end simplified acquisiton threshold, at USD150,000. Both of these have subsequently been raised and vary situationally. However, for simplicity the model is using the low and generally applicable value for categorization. The next step is to attempt a piecemeal/segmented approach, which allows for different slopes for cl_ceil depending on whether the value is above or below certain thresholds.

Expectation: Surpassing the microtransaction threshold and the simplified acquisition threshold mandates additional regulatory requirements and also scrutiny. Contracts that exceed them are thus likely to have a greater irreducible complexity that prevented use of smaller contracting forms. The study team expects that the lower thresholds will negatively estimate the probability of ceiling breaches and terminations.

```{r Model05G}
crisis_smp$thresh<-Hmisc::cut2(crisis_smp$UnmodifiedContractBaseAndAllOptionsValue,c(2500,15000))

levels(crisis_smp$thresh)<-c("25C","150K","Above")
crisis_smp$thresh<-factor(crisis_smp$thresh,levels=c("Above","150K","25C"))


summary(crisis_smp$thresh)
summary_discrete_plot(crisis_smp,"thresh")



#Model
CBre_05G <- glm (data=crisis_smp,
                 b_CBre ~  Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+cl_Ceil:thresh+
                   cl_Ceil:NoComp,  
                 family=binomial(link="logit"))
display(CBre_05G)

Term_05G <- glm (data=crisis_smp,
                  b_Term ~ Crisis +b_NoComp+
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+cl_Ceil:thresh+
                   b_NoComp:Crisis+
                   b_UCA:Crisis+
                   
                   cl_Ceil:Crisis, 
                 family=binomial(link="logit"))
display(Term_05G)



stargazer::stargazer(CBre_05E,CBre_05G,Term_05B,Term_05G,type="text",
                     digits=2,keep.stat=c("n","aic","res.dev","null.dev"))

summary_residual_compare(CBre_05E,CBre_05G,Term_05B,Term_05G)



Term_05G2 <- glm (data=crisis_smp,
                  b_Term ~ Crisis +b_NoComp+
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+cl_Ceil:thresh+
                   b_NoComp:Crisis+
                   b_UCA:Crisis, 
                 family=binomial(link="logit"))
display(Term_05G2)



stargazer::stargazer(CBre_05E,CBre_05G,Term_05B,Term_05G2,type="text",
                     digits=2,keep.stat=c("n","aic","res.dev","null.dev"))

summary_residual_compare(CBre_05E,CBre_05G,Term_05B,Term_05G2)

```
The results do not aligne with expectations, though the magnitude of the negative coefficient is surprising for threshold150k terminations because it flips the sign on the ceiling. However, while the coefficients make sense, the change is ultimately unsuccessful in its main goal, reducing the size of residuals in the model. As a result, given the increase in complexity and the greater difficulty in interpretability, it will be left out of the model.

This causes cl_Ceil VIF to exceed 2, and thus it must be removed.

#### 05H: Threshold and ceiling interaction

```{r Model05H}
summary_continuous_plot(crisis_smp,"cl_ceil","thresh")



#Model
CBre_05H <- glm (data=crisis_smp,
                 b_CBre ~  Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+thresh+
                   cl_Ceil:NoComp+
                   cl_Ceil:thresh,  
                 family=binomial(link="logit"))
display(CBre_05H)

Term_05H <- glm (data=crisis_smp,
                  b_Term ~ Crisis +b_NoComp+
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+thresh+
                   b_NoComp:Crisis+
                   b_UCA:Crisis+
                   cl_Ceil:Crisis+
                   cl_Ceil:thresh, 
                 family=binomial(link="logit"))
display(Term_05H)



stargazer::stargazer(CBre_05E,CBre_05G,CBre_05H,Term_05B,Term_05G,Term_05H,type="text",
                     digits=2,keep.stat=c("n","aic","res.dev","null.dev"))

summary_residual_compare(CBre_05E,CBre_05H,Term_05B,Term_05H)
summary_residual_compare(CBre_05G,CBre_05H,Term_05G,Term_05H)

```

### Maximum Duration
#### 06A: Maximum Duration

Expectation: Greater maximum duration will positively estimate the probability ceiling of  breaches and terminations.

```{r Model06A}
#Frequency Plot for max duration
freq_continuous_cbre_plot(crisis_smp,"UnmodifiedDays",
               bins=1000)



summary_continuous_plot(crisis_smp,"l_Days")
#Model
CBre_06A <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   cl_Ceil:NoComp, 
                 family=binomial(link="logit"))
display(CBre_06A)

Term_06A <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp+
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   b_NoComp:Crisis+
                   b_UCA:Crisis+
                   
                   cl_Ceil:Crisis, 
                 family=binomial(link="logit"))
display(Term_06A)


stargazer::stargazer(CBre_05E,CBre_06A,Term_05B,Term_06A,type="text",
                     digits=2)

summary_residual_compare(CBre_05E,CBre_06A,Term_05B,Term_06A)
```
Expectations are met.

Duration has significant correlations with both outcome variables, but the coefficient is larger for terminations. The initial model results are surprising as ceiling change direction, reducing and correlates with a lower risk of termiation now, although the interaction between crisis funding and ceiling remains roughly the same. The graph of the fitted values shows that this model The next step will be to look at the interaction of ceiling and duration. The residuals for both ceiling and days do fall out of the 95% confidence interval more than expected and particularly for ceiling breaches show some signs of patterns.

#### 06B: Ceiling and Duration
Expectation: All else equal, large ceiling contracts with short time horizons may be higher risk. The interaction of ceiling and day positively estimates the probability of ceiling breaches and terminations.
```{r Mode06B}

summary_double_continuous(crisis_smp,"cl_Days","cl_Ceil")

#Model
CBre_06B <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                  cl_Ceil:NoComp+

                   
                   
                   cl_Ceil:cl_Days, 
                 family=binomial(link="logit"))
display(CBre_06B)

Term_06B <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp+
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                  b_NoComp:Crisis+
                   b_UCA:Crisis+
                   cl_Ceil:Crisis+
                   cl_Ceil:cl_Days, 
                 family=binomial(link="logit"))
display(Term_06B)

stargazer::stargazer(CBre_06A,CBre_06B,Term_06A,Term_06B,type="text",
                     digits=2)

summary_residual_compare(CBre_06A,CBre_06B,Term_06A,Term_06B)
```

The expectation was defied in both cases. The interaction of ceiling and duration is correlated with a higher rate of ceiling breaches and no change at all to terminations. The coefficient is minor and the reduction in the deviance of the minor is minimal for ceiling breaches. For ceiling breaches, the interaction exceeds to while for terminations ceiling exceeds 2. Leaving it out.


#### 06C: Duration and Crisis
Expectation: Policy makers and the literature are leary of longer crisis contracts. The itneraction of greater duration and crisis funding positively estimates the probability of ceiling breaches and terminations.

```{r Mode06C}

summary_continuous_plot(crisis_smp,"l_Days","Crisis")

#Model
CBre_06C <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                  cl_Ceil:NoComp+
                   cl_Days:Crisis, 
                 family=binomial(link="logit"))
display(CBre_06C)

Term_06C <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp+
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                  b_NoComp:Crisis+
                   b_UCA:Crisis+
                   cl_Ceil:Crisis+
                   cl_Days:Crisis, 
                 family=binomial(link="logit"))
display(Term_06C)

stargazer::stargazer(CBre_06A,CBre_06C,Term_06A,Term_06C,type="text",
                     digits=2)


summary_residual_compare(CBre_06A,CBre_06C,Term_06A,Term_06C,bins=20)


```
Expectations are upheld for ARRA and OCO for ceiling breaches, but not at all for terminations. However, the VIF in both cases comes to exceed 2 on days in both cases and for the interaction as well for termination. Leaving it out.

#### 06D: Duration and UCA
Expectation: The UCA variable is imprecise for this purpose. The longer a contract goes undefinitized the higher the risk is likely to be. However, UCA just evaluates starting conditions, not duration. Nonetheless the expectation is that the interaction of UCA and maximum duration positively estimates the probability of ceiling breach and termination.
```{r Mode06D}


summary_continuous_plot(crisis_smp,"l_Days","UCA")

#Model
CBre_06D <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                  cl_Ceil:NoComp+
                   cl_Days:b_UCA, 
                 family=binomial(link="logit"))
display(CBre_06D)

Term_06D <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp+
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                  b_NoComp:Crisis+
                   b_UCA:Crisis+
                   cl_Ceil:Crisis+
                   
                   cl_Days:b_UCA, 
                 family=binomial(link="logit"))
display(Term_06D)



stargazer::stargazer(CBre_06A,CBre_06D,Term_06A,Term_06D,type="text",
                     digits=2)


summary_residual_compare(CBre_06A,CBre_06D,Term_06A,Term_06D)


```
The expectations are defied in the case of ceiling breach. For termination, the results are not significant and the VIF is greater than 2.0.

Similar to the model of the interaction of ceiling breaches UCA, smaller scope appears to be associated with somewhat greater risk. Unfortunately, the residuals increase in magnitude for ceiling breaches and the deviance is worse than adding a random data for terminations, leaving this variable out.



#### 06E: Duration and Office Place
Expectation: Policy makers and the literature are leary of longer crisis contracts and their may be a similar dynamic for international orders. The interaction of place of internationally oriented contracting offices and greater duration positively estimates the probability of ceiling breaches and terminations.
```{r Mode06E}
summary_double_continuous(crisis_smp,"l_Days","c_OffCri")
summary_continuous_plot(crisis_smp,"l_Days","OffPl99")


#Model
CBre_06E <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                  cl_Ceil:NoComp+
                   cl_Days:OffPl99, 
                 family=binomial(link="logit"))
display(CBre_06E)

Term_06E <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp+
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                  b_NoComp:Crisis+
                   b_UCA:Crisis+
                   cl_Ceil:Crisis+
                        cl_Days:OffPl99, 
                 family=binomial(link="logit"))
display(Term_06E)



stargazer::stargazer(CBre_06A,CBre_06E,Term_06C,Term_06E,type="text",
                     digits=2)


summary_residual_compare(CBre_06A,CBre_06E,Term_06C,Term_06E,bins=30)


```
The expectation is upheld. The interaction between duration and locations for terminations is shows that in international cases, longer duration estimates greater risks, though not significantly for ceiling breaches. This Interestingly,in mixed cases the risk is reduced significant. This is may be a mechanism to explain reachback contracting, and also occurs with ceiling terminations, bigger contracts may be easier to handle in mixed contracting offices where there is more capacity. 

Unfortunately, VIF knocks out this interaction as in both cases cl_days goes above 2.0.


#### 06F: Duration and Competition
Expectation: Policy guidance often encourages regular use of competition, which suggests a believe that the results where off over time. This is disputed by others in the field. Nonetheless, the expectation is that the interaction of the absence of competition and duration negatively estimates a greater probability of terminations and ceiling breaches.
```{r Mode06F}
summary_continuous_plot(crisis_smp,"l_Days","NoComp")


#Model
CBre_06F <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   cl_Ceil:NoComp+
                   cl_Days:NoComp,
                 family=binomial(link="logit"))
display(CBre_06F)

Term_06F <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp+
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   b_NoComp:Crisis+
                   b_UCA:Crisis+
                   cl_Ceil:Crisis+
                   cl_Days:b_NoComp, 
                 family=binomial(link="logit"))
display(Term_06F)



stargazer::stargazer(CBre_06A,CBre_06F,Term_06A,Term_06F,type="text",
                     digits=2)


summary_residual_compare(CBre_06A,CBre_06F,Term_06A,Term_06F,bins=30)


```
Expectations are met in both cases, although the negative sign for no competition for terminations  still defies expecations, although the coefficient has reduced and is no longer significant at the 0.05 level. 

The contracts with longer maximum duration when interacting with no competition are associated with better results. 


##Contract Vehicle
Our dataset includes both stand alone contract awards and task orders that are under larger indefinite delivery vehicles (IDVs). This does fit with literature review findings about the risk of long duration contracts in a crisis, so will be kept in despite its minimal coefficient.

### 07A: Single-Award, Multi-Award, and Other Indefinite Delivery Vehicles

Expectation: Indefinite delivery vehicles, means that the government has an existing relationship with the vendor and administration is easier. The downside is that the government may be locked into the vendor, although exit does not necessarily require outright termination, instead the government may simply cease to use a vehicle. Taken together, across the board the four categories of vehicles are expected to  negatively estimate the probability of termination. Ceiling breaches are a more complex topic and the study team does not have immediate expecations aside from likely significance.

```{r Model07A}

  summary_discrete_plot(crisis_smp,"Veh")

#Model
CBre_07A <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   Veh+
                  cl_Ceil:NoComp+
                   cl_Days:NoComp, 
                 family=binomial(link="logit"))
display(CBre_07A)

Term_07A <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp+
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                   Veh+
                  b_NoComp:Crisis+
                   b_UCA:Crisis+
                   cl_Ceil:Crisis+
                   cl_Days:b_NoComp, 
                 family=binomial(link="logit"))
display(Term_07A)



stargazer::stargazer(CBre_06F,CBre_07A,Term_06F,Term_07A,type="text",
                     digits=2)


summary_residual_compare(CBre_06F,CBre_07A,Term_06F,Term_07A)

#Update after VIF finding and removing cl_Ceil:Crisis

Term_07A2 <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp+
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                   Veh+
                  b_NoComp:Crisis+
                   b_UCA:Crisis+
                   cl_Days:b_NoComp, 
                 family=binomial(link="logit"))
display(Term_07A2)

  summary_discrete_plot(crisis_smp,"Comp","Crisis")
  summary_continuous_plot(crisis_smp,"l_Ceil","Comp")

stargazer::stargazer(Term_07A,Term_07A2,type="text",
                     digits=2)

summary_residual_compare(CBre_06F,CBre_07A,Term_07A,Term_07A2)
#Update after VIF finding and removing b_NoComp:Crisis

Term_07A3 <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp+
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                   Veh+
                   b_UCA:Crisis+
                   cl_Days:b_NoComp, 
                 family=binomial(link="logit"))
display(Term_07A3)
stargazer::stargazer(Term_07A2,Term_07A3,type="text",
                     digits=2)

summary_residual_compare(CBre_06F,CBre_07A,Term_07A2,Term_07A3)

```
Ex[ectatopms were fulfilled with regard to terminations. 
The first check lumps looks at four categories of IDVs, each associated with a notably rate of negative outcomes. The largest negative coefficient varies by measure. Both single award IDCs (S-IDC) and Blanket Purchase Agreements/Basic Order Agreements (BPA/BOA) have singifcant negative coefficients in both categories. Multiple award IDVs have the largest negative coefficient for terminations but the smalling for breaches. FSS/GWAC on the other hand have the smallest coefficent for terminations, but are associated with a lower rate of breaches only a bit smaller in magnuted to S-IDCs or BPA/BOAs. second, and other IDVs third. The deviance of the both models is notably reduced, the main warning bell though is some signs of flattening out in the fitted versus residuals. The residual pattern around 0.5 for log of cost ceiling is still not explained.

This addition pushes the VIF for cl_Ceil above 2 for terminations. Crisis:cl_Ceil will be removed. After which, the VIF for b_NoComp exceeded 2. The study team chose to remove b_NoCompTRUE:cl_Days as when examining the descriptive statistics, there was a more noticable difference in pattern for that set of variables and better alignment between the Term and Ceil models is an additional feature.

The next step is to check the intersections with duration.


### 07B: Vehicle and Duration
Expectation: Indirect vehicles allow for disaggregation of larger contracts into smaller task orders. As a result, when the duration on these contracts they may act more like definitive contracts. The interaction of duration and initial contract duration may have the opposite coefficient as the base vehicle coefficients.
```{r Model07B}

  summary_continuous_plot(crisis_smp,"l_Days","Veh")

#Model
CBre_07B <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   Veh+
                  cl_Ceil:NoComp+
                   cl_Days:NoComp+
                   
                   
                   cl_Days:Veh, 
                 family=binomial(link="logit"))
display(CBre_07B)

Term_07B <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp+
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                   Veh+
                  b_NoComp:cl_Days+
                   b_UCA:Crisis+
                   cl_Days:Veh                   , 
                 family=binomial(link="logit"))
display(Term_07B)



stargazer::stargazer(CBre_07A,CBre_07B,Term_07A3,Term_07B,type="text",
                     digits=2)


summary_residual_compare(CBre_07A,CBre_07B,Term_07A3,Term_07B)



```

Expectations were not upheld, with the exception of FSS/GWAC for termination and Ceiling breaches for for Multi-aWard IDCs

1 day contracts are disproportionately common for Defintive Contracts/Purchase Orders, Single-Award ICs, and BPA/BOAs. The interactions between vehicles and duration are full of contrasts. BPA/BOA are the only clearcut categories where the interaction lowers or eliminates the higher risk of negative outcomes that long duration contracts have. For terminations, both single-award IDCs and FSS/GWAC contracts also are associated with lower risk for long contracts, but not to the same degree as BPA/BOA. For ceiling breaches, single-award IDCs have a small but higher risk as contracts go longer but multiaward IDC go inthe opposite direction. Interestingly, the coefficient on multi-award contracts for ceiling breaches also flips direction, they are now more likely to have breaches once interactions with duration are accounted for. 





### 07C: Vehicle and Contract Ceiling
Expectation: Expectations mirror days. Indirect vehicles allow for disaggregation of larger contracts into smaller task orders. As a result, when the ceiling on these contracts they may act more like definitive contracts. The interaction of duration and initial ceiling may have the opposite coefficient as the base vehicle coefficients.

```{r Model07C}

  
summary_continuous_plot(crisis_smp,"l_Ceil","Veh",bins=50)
freq_continuous_plot(subset(crisis_smp,Veh=="M-IDC"),"l_Ceil","Crisis",bins=50)+
  geom_vline(xintercept=c(log(12500),log(17500)))
summary_continuous_plot(subset(crisis_smp,Veh=="M-IDC"& Crisis=="ARRA"),
                        "l_Ceil",bins=50)
#Model
CBre_07C <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   Veh+
                  cl_Ceil:NoComp+cl_Days:NoComp+
                   
                   
                   
                   cl_Days:Veh+ 
                 cl_Ceil:Veh, 
                 family=binomial(link="logit"))
display(CBre_07C)

Term_07C <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp+
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                   Veh+
                  cl_Days:b_NoComp+
                   b_UCA:Crisis+
                   
                   
                   
                   cl_Days:Veh+ 
                 cl_Ceil:Veh, 
                 family=binomial(link="logit"))
display(Term_07C)



stargazer::stargazer(CBre_07B,CBre_07C,Term_07B,Term_07C,type="text",
                     digits=2)

summary_residual_compare(CBre_07B,CBre_07C,Term_07B,Term_07C,bins=20)



```
Expectations were upheld in some cases, Multi-Award IDCs and BPA/BOA for ceiling breaches and multi-ward IDCs and FSS/GWAC for termination
Indefinite delivery vehicles, when interacting with contract ceiling, generally have lower ceiling breach rates and termination rates. The big exception is multi-award IDVs for terminations. High ceiling contracts are associated with a significantly higher risk of termination when a multiaward vehicle is used. The effects for the residuals are mixed, but the reduction in model deviance seems sufficient to justify it.

Multi-award also depicts an odd pattern, specifically with ARRA contracts, namely, a significant frequence 

### 07D: Vehicle and Competition

The next step is to check interactions with the contract vehicles. Each has a slightly different approach to competition. For example, the competition for a Single-Award IDV happens at the start of the IDV, after that, contracts awarded through that vehicle go to that single winning vendor.

Expectations: Competition seems likely to have the biggest effect for multiple-award IDCs and FSS/GWAC contracts as that covers task order competition and not just the overall initial competition of Single-award IDCs and some form of BPA/BOAs. Writ large, we would expect that no competition would positively estimate the probability of ceiling breach and termination.
```{r Model07D}

  summary_discrete_plot(crisis_smp,"NoComp","Veh")

#Model
CBre_07D <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   Veh+
                  cl_Ceil:NoComp+cl_Days:NoComp+
                   
                   
                   cl_Days:Veh+ 
                   cl_Ceil:Veh+
                 NoComp:Veh, 
                 family=binomial(link="logit"))
display(CBre_07D)

Term_07D <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp+
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                   Veh+
                  cl_Days:b_NoComp+
                   b_UCA:Crisis+
                   
                   
                   
                   cl_Days:Veh+ 
                   cl_Ceil:Veh+
                 b_NoComp:Veh, 
                 family=binomial(link="logit"))
display(Term_07D)



stargazer::stargazer(CBre_07C,CBre_07D,Term_07C,Term_07D,type="text",
                     digits=2)




summary_residual_compare(CBre_07C,CBre_07D,Term_07C,Term_07D,20)


summary(crisis_smp$Term[crisis_smp$NoComp=="Urgency"&crisis_smp$Veh=="M-IDC"])


```
Expectations held with the biggest exception of BPA/BOA.

The average plots did show varying relationships and slopes between different types of vehicles. Uncompeted single-awards and fss/gwacs are associated with more terminations as are uncompeted multiawards/ Urgency exceptions for FSS?GWAC are strongly correlated with a greater risk of ceiling breaches. 

##Type of Contract

The next step adds a measure for whether the contract was cost-based or fixed-price. 

Expectation Prior CSIS research has found that fixed-price contracts estimate a higher probability of terminations but did not find a notable relationship for ceiling breaches.

### 08A: Fixed-Price
```{r Model08A}

  summary_discrete_plot(crisis_smp,"FxCb")

#Model
CBre_08A <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   Veh+
                   n_Fixed +
                  cl_Ceil:NoComp+cl_Days:NoComp+
                   
                   
                   
                   
                   cl_Days:Veh+ 
                   cl_Ceil:Veh+
                 NoComp:Veh, 
                 family=binomial(link="logit"))
display(CBre_08A)

Term_08A <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp+
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                   Veh+
                   n_Fixed +
                  cl_Days:b_NoComp+
                   b_UCA:Crisis+

                   cl_Days:Veh+ 
                   cl_Ceil:Veh+
                   b_NoComp:Veh
                 , 
                 family=binomial(link="logit"))
display(Term_08A)

stargazer::stargazer(CBre_07D,CBre_08A,Term_07D,Term_08A,type="text",
                     digits=2)



summary_residual_compare(CBre_07D,CBre_08A,Term_07D,Term_08A,30)


```
Expectations were upheld for terminations.

And fixed price contracts do indeed have a significant coefficient that correlates with higher termination risk. In addition, the addition of this variable reduces the pattern in the residuals that in the middle range. 

### 08B: Fixed-Price and Duration Intersection 
Past CSIS research has found that fixed-price contracts do appear to be at higher risk if they have a longer maximum duration. Fixed-price contracting does require upfront estimation of likely costs, and thus a longer duration means more opportunity for changed circumstance.

Expectation: The interaction of fixed price and longer duration will positively estimate the probability of ceiling breaches and terminations.

```{r Model08B}

  summary_continuous_plot(crisis_smp,"l_Days","FxCb")

#Model
CBre_08B <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   Veh+
                   n_Fixed +
                  cl_Ceil:NoComp+cl_Days:NoComp+
                   
                   
                   cl_Days:Veh+ 
                   cl_Ceil:Veh+
                 NoComp:Veh+
                   cl_Days:n_Fixed , 
                 family=binomial(link="logit"))
display(CBre_08B)

Term_08B <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp+
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                   Veh+
                   n_Fixed +
                  cl_Days:b_NoComp+
                   b_UCA:Crisis+
                   
                   
                   
                   cl_Days:Veh+ 
                   cl_Ceil:Veh+
                 
                   cl_Days:n_Fixed, 
                 family=binomial(link="logit"))
display(Term_08B)

stargazer::stargazer(CBre_08A,CBre_08B,Term_08A,Term_08B,type="text",
                     digits=2)



summary_residual_compare(CBre_08A,CBre_08B,Term_08A,Term_08B)


```
Estimates are upheld for ceiling breaches. The probability of ceiling breach is strongly associated with lnger duration contracts. This fits with expectations, longer contracts will face more changing circumstances which are harder to anticipate at contract creation, this effect only adds to the model for ceiling breaches, dropping for terminations. However, VIF is off the charts in both cases, jumping above 5. Excluding from the model.

### 08C: Fixed-Price and Vehicle

Expectation: Unclear. 
```{r Model08C}

  summary_discrete_plot(crisis_smp,"FxCb","Veh")

#Model
CBre_08C <- glm (data=crisis_smp,
                 b_CBre ~ Crisis +NoComp +
                   b_UCA+
                   OffPl99+ c_OffCri+
                   cl_Ceil+
                   cl_Days+
                   Veh+
                   n_Fixed +
                  cl_Ceil:NoComp+cl_Days:NoComp+
                   
                   
                   cl_Days:Veh+ 
                   cl_Ceil:Veh+
                 NoComp:Veh+
                   
                   Veh:n_Fixed, 
                 family=binomial(link="logit"))
display(CBre_08C)

Term_08C <- glm (data=crisis_smp,
                 b_Term ~ Crisis +b_NoComp+
                   b_UCA+
                   OffPl99+ c_OffCri+
                  cl_Ceil+
                   cl_Days+
                   Veh+
                   n_Fixed +
                  cl_Days:b_NoComp+
                   b_UCA:Crisis+
                   
                   
                   
                   cl_Days:Veh+ 
                   cl_Ceil:Veh+
                 
                   Veh:n_Fixed, 
                 family=binomial(link="logit"))
display(Term_08C)

stargazer::stargazer(CBre_08A,CBre_08C,Term_08A,Term_08C,type="text",
                     digits=2)



summary_residual_compare(CBre_08A,CBre_08C,Term_08A,Term_08C)

```
The interactions lead the n_Fixed variable to lose  significant and do little to reduce the residual deviance. They will not be added to the model. The VIF is also extrordinary.


### 08D: Fixed Price and Crisis

Expectation: There can be significant uncertainty in crisis contracting, so the interaction of fixed price contracting and crisis funding may positively estimate the probability of terminations and ceiling breaches. However, this possibility was not covered in the literature.
```{r Model08D}

  summary_continuous_plot(crisis_smp,"l_Ceil","FxCb")
  
  #Model
summary_discrete_plot(crisis_smp,"FxCb","Crisis")
  
  #Model
  CBre_08D <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     OffPl99+ c_OffCri+
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     
                     
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                     
                     Crisis:n_Fixed, 
                   family=binomial(link="logit"))
  display(CBre_08D)
  
  Term_08D <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     OffPl99+ c_OffCri+
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     
                     
                     
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   
                     Crisis:n_Fixed, 
                   family=binomial(link="logit"))
  display(Term_08D)
  
  stargazer::stargazer(CBre_08A,CBre_08D,Term_08A,Term_08D,type="text",
                       digits=2)
  vif(Term_02G)
  

summary_residual_compare(CBre_08A,CBre_08D,Term_08A,Term_08D)

```
Expections were upheld for ceiling breaches but not for terminations (other than insignificantly Disaster funds). However, the VIFs are quite high, so leaving this out.


### 08E: Fixed Price and Ceiling
Estimate: Larger contracts are likely to be more complex, and thus positively estimated probability of terminations and ceiling breaches.


```{r Model08E}
  summary_continuous_plot(crisis_smp,"l_Ceil","FxCb")
  

  CBre_08E <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     OffPl99+ c_OffCri+
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                    cl_Ceil:NoComp+
                     cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                     
                     cl_Ceil:n_Fixed, 
                   family=binomial(link="logit"))
  display(CBre_08E)
  
  Term_08E <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     OffPl99+ c_OffCri+
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     cl_Ceil:n_Fixed, 
                   family=binomial(link="logit"))
  display(Term_08E)
  

  stargazer::stargazer(CBre_08B,CBre_08E,Term_08A,Term_08E,type="text",
                       digits=2)
  
  

summary_residual_compare(CBre_08B,CBre_08E,Term_08A,Term_08E,bins=30)

```
Expecations are upheld. Larger fixed price contracts are associated with larger negative outcomes, though not significantly for terminations. The VIF however well exceeds 2. Leaving it out.



### 08F: Fixed Price and Competition

Estimate: Low-ball bids are a higher risk for fixed-price contracts than for cost-based contracts. Thus the interaction of fixed-price and cost based is expected to positively estimate the probability of ceiling breaches and terminations.
```{r Model08F}
  summary_discrete_plot(crisis_smp,"n_Fixed","NoComp")
summary_discrete_plot(crisis_smp,"n_Fixed","FxCb")
  

  CBre_08F <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     OffPl99+ c_OffCri+
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     
                     
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                     
                     NoComp:n_Fixed, 
                   family=binomial(link="logit"))
  display(CBre_08F)
  
  Term_08F <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     OffPl99+ c_OffCri+
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     
                     
                     
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   
                     b_NoComp:n_Fixed, 
                   family=binomial(link="logit"))
  display(Term_08F)
  

  stargazer::stargazer(CBre_08B,CBre_08F,Term_08A,Term_08F,type="text",
                       digits=2)
  
  

summary_residual_compare(CBre_08B,CBre_08F,Term_08A,Term_08F,bins=20)

```
The expectation holds true for ceiling breaches and not terminations, but in neither case is significant. The VIF surpasses 2.0, leaving this off.

##Place of Performance
### 09A: Any International
Because office level and contract level location are highly correlated (specifically the Intl state), they both can't be included in the model. This step will check the inclusion of both but expect a VIF problem.

Expectation: The reachback hypothesis suggests that international will postively estimate the probability of terminations and ceiling breaches
```{r Model09A}
corrdisp<-Hmisc::rcorr(as.matrix(cbind(subset(crisis_smp, select=c(b_UCA,
                                                             c_OffCri,cl_Ceil,
                                               cl_Days,n_Fixed,b_Intl)),
                       dummies::dummy(crisis_smp$Crisis),
                       dummies::dummy(crisis_smp$NoComp),
                       dummies::dummy(crisis_smp$OffPl99),
                       dummies::dummy(crisis_smp$Veh))))

corrdisp[[1]]#[,1:9]



  CBre_09A <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     b_Intl+
                     c_OffCri+
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh, 
                   family=binomial(link="logit"))
  display(CBre_09A)
  
  Term_09A <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     b_Intl+
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh, 
                   family=binomial(link="logit"))
  display(Term_09A)
  

  stargazer::stargazer(CBre_08A,CBre_09A,Term_08A,Term_09A,type="text",
                       digits=2)
  
  

summary_residual_compare(CBre_08A,CBre_09A,Term_08A,Term_09A,bins=20)

```
The expectation was fulfilled for ceiling breaches but not for terminations. This had not proven true in earlier versions of the sample, though the addition of a wider range of non-crisis international contracts changed the dynamic.

International and Office place have roughly similar deviances, even though international has less granularity. However, for termination international is a much less effective estimator. Office place also ran contrary to expectation, so the choice of variables  does not appear to affect hypothesis outcome. From a diagnostic point of view, international is an improvement over office place, as it appears to reduce the magnitude of residuals. 

### 09B: Reach 6 category

```{r Model09B}
crisis_smp$Reach<-factor(paste(crisis_smp$OffPl99,crisis_smp$Intl,sep="-"))
summary(crisis_smp$Reach)

  summary_discrete_plot(crisis_smp,"Intl","OffPl99")
crisis_smp$Reach6<-crisis_smp$Reach
    levels(crisis_smp$Reach6) <-
    list( "US99-Dom"=c("US99-Just U.S."),
          "Mixed-Dom"=c("Mixed-Just U.S."),
         "Intl-Dom"=c("Intl-Just U.S."),
         "US99-Intl"=c("US99-Any International"),
         "Mixed-Intl"=c("Mixed-Any International"),
         "Intl-Intl"=c("Intl-Any International"))


  
    summary_discrete_plot(crisis_smp,"Reach6")
  

  CBre_09B <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     c_OffCri+
                     Reach6+
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                    cl_Ceil:NoComp+
                     cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh, 
                   family=binomial(link="logit"))
  display(CBre_09B)
  
  Term_09B <- glm (data=crisis_smp,
                   b_Term ~ Crisis +
                     b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach6+
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh, 
                   family=binomial(link="logit"))
  display(Term_09B)
  

  stargazer::stargazer(CBre_08A,CBre_09A,CBre_09B,Term_08A,Term_09A,Term_09B,type="text",
                       digits=2)
  
  

summary_residual_compare(CBre_08A,CBre_09B,Term_08A,Term_09B,bins=20)
summary_residual_compare(CBre_09A,CBre_09B,Term_09A,Term_09B,bins=20)

```
Expectations were upheld for ceiling breaches but not for terminations. For terminations, expectations are reversed, mixed contracting offices, with more than 1% international contracting but less than 50%, have a higher termination rate regardless of whether the contracts

Given the rarity of international contracts from contracting offices where 99% of dollars go to domestic contracts, and the similarity between US99-Dom annd Mixed-Dom, seperating out that category seems to add little value, at least on the ceiling side. 
### 09C: Reach 4 Category
Expectations: Unchanged from 6 category. Reachback contracting office negatively estimate, relative to international offices, the probabilit of ceilingbreaches and terminations.
```{r Model09C}
    levels(crisis_smp$Reach) <-
    list( "US50-Dom"=c("US99-Just U.S.","Mixed-Just U.S."),
         "Mixed-Dom"=c(),
         "Intl-Dom"=c("Intl-Just U.S."),
         "US50-Intl"=c("Mixed-Any International","US99-Any International"),
         "Intl-Intl"=c("Intl-Any International"))


  
    summary_discrete_plot(crisis_smp,"Reach")
  

  CBre_09C <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     c_OffCri+
                     Reach+
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                    cl_Ceil:NoComp+
                     cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh, 
                   family=binomial(link="logit"))
  display(CBre_09C)
  
  Term_09C <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach++
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh, 
                   family=binomial(link="logit"))
  display(Term_09C)
  

  stargazer::stargazer(CBre_08A,CBre_09A,CBre_09B,CBre_09C,Term_08A,Term_09A,Term_09B,Term_09C,type="text",
                       digits=2)
  
  

summary_residual_compare(CBre_08A,CBre_09C,Term_08A,Term_09C,bins=20)
summary_residual_compare(CBre_09A,CBre_09C,Term_09A,Term_09C,bins=20)
summary_residual_compare(CBre_09B,CBre_09C,Term_09B,Term_09C,bins=20)

```
Expectations are upheld for ceiling breaches but not for terminations.
For ceiling breaches, the four category reach variation is an easy choice, it reduces deviance by a comparable degree to its more detailed alternative. For terminations, the choice is harder. The greater detail does distinguish between overwhelming domestic contrating offices and mixed ones. This is not directly relevant to the research question and does reduce the similarity between the two models but may be worth it. We will check one more variant, reach 5, in which the domestic and the rare international contracts for US99 contracting offices are grouped together.

### 09D: Reach 5 Category
Expectations: Unchanged from 6 category. Reachback contracting office negatively estimate, relative to international offices, the probabilit of ceilingbreaches and terminations.
```{r Model09D}
  crisis_smp$Reach5<-crisis_smp$Reach6
    levels(crisis_smp$Reach5) <-
    list( "US99-Dom"=c("US99-Just U.S.","US99-Any International"),
         "Mixed-Dom"=c("Mixed-Just U.S."),
         "Intl-Dom"=c("Intl-Just U.S."),
         "Mixed-Intl"=c("Mixed-Any International"),
         "Intl-Intl"=c("Intl-Any International"))


  
    summary_discrete_plot(crisis_smp,"Reach5")
  

  CBre_09D <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     c_OffCri+
                     Reach5+
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                    cl_Ceil:NoComp+
                     cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh, 
                   family=binomial(link="logit"))
  display(CBre_09D)
  
  Term_09D <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach5++
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh, 
                   family=binomial(link="logit"))
  display(Term_09D)
  

  stargazer::stargazer(CBre_08A,CBre_09B,CBre_09C,CBre_09D,Term_08A,Term_09B,Term_09C,Term_09D,type="text",
                       digits=2)
  
  

summary_residual_compare(CBre_08A,CBre_09D,Term_08A,Term_09D,bins=20)
summary_residual_compare(CBre_09A,CBre_09D,Term_09A,Term_09D,bins=20)
summary_residual_compare(CBre_09B,CBre_09D,Term_09B,Term_09D,bins=20)
summary_residual_compare(CBre_09C,CBre_09D,Term_09C,Term_09D,bins=20)

```
After comparing a few models, the 4 category reach seems most parsimonious and other options do not so dramatically improve terminations as to be worth using two different approaches.
##Who


### 10A: Defense and Civilian

Expectation: DoD contracts are often higher risk technologies or more direct exposure to conflict situations. Defense as a customer will positively estimate the probability of ceiling breaches and terminations.
```{r Model10A}
corrdisp<-Hmisc::rcorr(
  as.matrix(cbind(subset(crisis_smp, select=c(b_UCA,c_OffCri,cl_Ceil,
                                            cl_Days,n_Fixed,b_Intl)),
                       dummies::dummy(crisis_smp$Crisis),
                       dummies::dummy(crisis_smp$NoComp),
                       dummies::dummy(crisis_smp$Reach),
                       dummies::dummy(crisis_smp$Veh),
                                    dummies::dummy(crisis_smp$Is.Defense))))
corrdisp[[1]]
   summary_discrete_plot(crisis_smp,"Is.Defense")


  CBre_10A <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ c_OffCri+
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+
                     cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh, 
                   family=binomial(link="logit"))
  display(CBre_10A)
  
  Term_10A <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     Reach+ c_OffCri+
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh, 
                   family=binomial(link="logit"))
  display(Term_10A)
  

  stargazer::stargazer(CBre_09C,CBre_10A,Term_09C,Term_10A,type="text",
                       digits=2)
  
  

summary_residual_compare(CBre_09C,CBre_10A,Term_09C,Term_10A,bins=20)

```
Expectations are countered for ceiling breaches but upheld for terminations.

Defense contracts are associated with fewer ceiling breaches but more terminations. The residuals for ceiling breaches are reduced, though there's a pattern for low fitted values.


##What
### 11A: Product/Service/R&D
Expectation: R&D and, to a lesser extent, services can be harder to quantify and will be positively estimate the probability of ceiling breaches and terminations.
```{r Model11A}
corrdisp<-Hmisc::rcorr(
  as.matrix(cbind(subset(crisis_smp, select=c(b_UCA,c_OffCri,cl_Ceil,
                                              cl_Days,n_Fixed,b_Intl)),
                  dummies::dummy(crisis_smp$Crisis),
                  dummies::dummy(crisis_smp$NoComp),
                  dummies::dummy(crisis_smp$Reach),
                  dummies::dummy(crisis_smp$Veh),
                  dummies::dummy(crisis_smp$Is.Defense),
                  dummies::dummy(crisis_smp$Simple))))
corrdisp[[1]]


#Frequency Plot
freq_discrete_plot(crisis_smp,"Simple")

#Percent Terminated Plot 
discrete_percent_cbre_plot(crisis_smp,"Simple")

#Create the model

  CBre_11A <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ c_OffCri+  
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   Simple, 
                   family=binomial(link="logit"))
  display(CBre_11A)
  
  Term_11A <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     Reach+ c_OffCri+
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   Simple, 
                   family=binomial(link="logit"))
  display(Term_11A)
  

  stargazer::stargazer(CBre_10A,CBre_11A,Term_10A,Term_11A,type="text",
                       digits=2)
  
  

summary_residual_compare(CBre_10A,CBre_11A,Term_10A,Term_11A,bins=20)


```
Expectations are upheld for ceiling breaches, although the coefficient for services is unexpectedly higher than for R&D. Expectations are not upheld for terminations, where R&D contracts are notably less likely to be cancelled and fixed price contracts


### 11B: Product or Service Area
Expectation: More complex and higher risk (i.e. fuel) product or service areas positively estimate a higher probability of terminations and ceiling breaches.

```{r Model11B}

crisis_smp$PSA<-as.character(crisis_smp$ProductOrServiceArea)
crisis_smp$PSA<-gsub(" & ","+",crisis_smp$PSA)
corrdisp<-Hmisc::rcorr(
  as.matrix(cbind(subset(crisis_smp, select=c(b_UCA,c_OffCri,cl_Ceil,
                                            cl_Days,n_Fixed,b_Intl)),
                       dummies::dummy(crisis_smp$Crisis),
                       dummies::dummy(crisis_smp$NoComp),
                       dummies::dummy(crisis_smp$Reach),
                       dummies::dummy(crisis_smp$Veh),
                                    dummies::dummy(crisis_smp$Is.Defense),
                  dummies::dummy(crisis_smp$PSA))))
corrdisp[[1]]


summary_discrete_plot(crisis_smp,"PSA",rotate_text=TRUE)
freq_discrete_plot(crisis_smp,"PSA",rotate_text=TRUE)
discrete_percent_plot(crisis_smp,"PSA",caption=FALSE,rotate_text=TRUE)

#Create the model

  CBre_11B <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ c_OffCri+  
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA, 
                   family=binomial(link="logit"))
  display(CBre_11B)
  
  Term_11B <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     Reach+ c_OffCri+
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   PSA, 
                   family=binomial(link="logit"))
  display(Term_11B)
  


  stargazer::stargazer(CBre_11A,CBre_11B,Term_11A,Term_11B,type="text",
                       digits=2)
summary_residual_compare(CBre_11A,CBre_11B,Term_11A,Term_11B,bins=20)

```
Expectations are partially upheld, though particularly for military platform related goods and services often estimate higher probability of ceiling breaches but lower probabiltiy of terminations. ICT, missiles and space, and electronics and communications are exceptions to this trend.


### 11C: Product or Service Code
Expectation: Complex or higher risk product or service caregories will have a positive estimate with the probability of ceiling breaches and terminations. This ran into memory areas and did not run successfully.
```{r Model11C}
# corrdisp<-Hmisc::rcorr(
#   as.matrix(cbind(subset(crisis_smp, select=c(b_UCA,c_OffCri,cl_Ceil,
#                                             cl_Days,n_Fixed,b_Intl)),
#                        dummies::dummy(crisis_smp$Crisis),
#                        dummies::dummy(crisis_smp$NoComp),
#                        dummies::dummy(crisis_smp$Reach),
#                        dummies::dummy(crisis_smp$Veh),
#                                     dummies::dummy(crisis_smp$Is.Defense),
#                   dummies::dummy(crisis_smp$ProdServ))))
# corrdisp[[1]]
# 
# 


  # CBre_11C <-  glm (data=crisis_smp,
  #                  b_CBre ~ Crisis +NoComp +
  #                    b_UCA+
  #                    Reach+ c_OffCri+  
  #                    cl_Ceil+
  #                    cl_Days+
  #                    Veh+
  #                    n_Fixed +
  #                    Is.Defense +
  #                   cl_Ceil:NoComp+cl_Days:NoComp+
  #                    cl_Days:Veh+ 
  #                    cl_Ceil:Veh+
  #                  NoComp:Veh+
  #                  ProdServ, 
  #                  family=binomial(link="logit"))

  
  # Term_11C <-  glm (data=crisis_smp,
  #                  b_Term ~ Crisis +b_NoComp+
  #                    b_UCA+
  #                    Reach+ c_OffCri+
  #                   cl_Ceil+
  #                    cl_Days+
  #                    Veh+
  #                    n_Fixed +
  #                    Is.Defense +
  #                   cl_Days:b_NoComp+
  #                    b_UCA:Crisis+
  #                    cl_Days:Veh+ 
  #                    cl_Ceil:Veh+
  #                    b_NoComp:Veh+
  #                  ProdServ, 
  #                  family=binomial(link="logit"))
#   display(Term_11C)
#   
# 
#   stargazer::stargazer(CBre_11B,CBre_11C,Term_11B,Term_11C,type="text",
#                        digits=2)
#   
#   
# 
# summary_residual_compare(CBre_10A,CBre_11C,Term_10A,Term_11C,bins=20)
# 
# texreg::htmlreg(list(CBre_11C,
#                      Term_11C),file="CrisisModel.html",single.row = TRUE,
#                 custom.model.name=c("Ceiling Breach",
#                                     "Complete\nand Partial\nTermination"
#                                     ),
#                         stars=c(0.05))
# summary(factor(crisis_smp$PSA))
```



### 11D: Removing OffCri
Including Product/Service/R&D or Product or Service Area both removed the significance from the percent of Office spending going to crisis funding. The next step will be to examine how the model fairs without that input.
```{r Model11D}


#Create the model

  CBre_11D <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA, 
                   family=binomial(link="logit"))
  display(CBre_11D)
  
  Term_11D <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   PSA, 
                   family=binomial(link="logit"))
  display(Term_11D)
  


  stargazer::stargazer(CBre_11B,CBre_11D,Term_11B,Term_11D,type="text",
                       digits=2)
summary_residual_compare(CBre_11B,CBre_11D,Term_11B,Term_11D,bins=20)

```
Removing  Office Cri for crisis ceiling makes sense, however, it does still seem to reduce deviance  for the termination model and the coefficient still  aligns with expectations. Leaving it for terminations.

The next step will be to examine the possiblity of removing Ceil:Comp from the Ceiling breach model. It is already absent from terminations. The coefficients are small and no longer significant. In addition, Ceiling has a VIF below 2, but it is the closest of the batch. 

### 11E: Removing Comp:Ceil
Including Product/Service/R&D or Product or Service Area both removed the significance from the percent of Office spending going to crisis funding. The next step will be to examine how the model fairs without that input.
```{r Model11E}


#Create the model

  CBre_11E <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA, 
                   family=binomial(link="logit"))
  display(CBre_11E)
  
  stargazer::stargazer(CBre_11D,CBre_11E,type="text",
                       digits=2)

  stargazer::stargazer(CBre_11D,CBre_11E,type="text",
                       digits=2)
  
summary_residual_compare(CBre_11D,CBre_11E,Term_11B,Term_11D,bins=30)

```
The deviance reduction provided by Ceil:Comp remains significance, and without it, Comp/No Other loses significance. Leaving it in for now.

# Traditional Interactions
Midway through the model building, the study team switched to an approach of first adding all the variables, then seeking out interactions. This approach has the advantage of having all the available inputs in first.

## Reachback

### 12A: Crisis and Reachback
Expectation: Reachback contracting is not particularly important for ARRA. However, the interactions of disasters and OCO with US50-Intl should negatively estimate the risk of ceiling breaches and terminations

```{r Model2A}


#Create the model

  CBre_12A <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis, 
                   family=binomial(link="logit"))
  display(CBre_12A)
  
  Term_12A <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   PSA+
                     Reach:Crisis, 
                   family=binomial(link="logit"))
  display(Term_12A)
  


  stargazer::stargazer(CBre_11D,CBre_12A,Term_11B,Term_12A,type="text",
                       digits=2)
summary_residual_compare(CBre_11D,CBre_12A,Term_11B,Term_12A,bins=20)

```
The results partially meet expectatios, leaving it in.



### 12B: Reachback Ceiling
Expectation: In a crisis, internationally stationed contracting officers may offten have smaller warrants. THus, international contracting offices positively estimate probability of ceiling breaches and terminations.

```{r Model12B}


#Create the model

  CBre_12B <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                   Reach:cl_Ceil, 
                   family=binomial(link="logit"))
  display(CBre_12B)
  
  Term_12B <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                   Reach:cl_Ceil, 
                   family=binomial(link="logit"))
  display(Term_12B)
  


  stargazer::stargazer(CBre_12A,CBre_12B,Term_12A,Term_12B,type="text",
                       digits=2)
summary_residual_compare(CBre_12A,CBre_12B,Term_12A,Term_12B,bins=20)

```
Expectations were met for terminations but not ceiling breaches. However, VIF was exceed in both cases, leaving this out.


### 12C: Reachback Duration
Expectation: In a crisis, remote deployment, there are sometimes rules against longer durations. Thus, the interaction of duration and international contracting offices positively estimate probability of ceiling breaches and terminations.

```{r Model12C}


#Create the model

  CBre_12C <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                   Reach:cl_Days, 
                   family=binomial(link="logit"))
  display(CBre_12C)
  
  Term_12C <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                   Reach:cl_Days, 
                   family=binomial(link="logit"))
  display(Term_12C)
  


  stargazer::stargazer(CBre_12A,CBre_12C,Term_12A,Term_12C,type="text",
                       digits=2)
summary_residual_compare(CBre_12A,CBre_12C,Term_12A,Term_12C,bins=20)

```
Results were in line with expecatations for terminations but against them for crisis. The VIF proved too high in both cases, leaving this interaction out.


### 12D: Reachback and Vehicle
Expectation: Indirect Contract Vehicles lower the burden on contracting offices, whether or not they improve outcomes, because they can offer as a template where a large portion of the work is already done. As a result, the study team expects that international located contracts using any form of S-IDC/M-IDC/FSS/GWAC negatively estimated the probability of ceiling breaches and terminations. This may also be a benefit for domestic contracting offices as they may have a wider range of indirect contract vehicles to choose from. This seems unlikely to entirely explain the strengths of reachback contracting, but may reduce the coefficient on the base reachback domestic variables.

```{r Model12D}


#Create the model

  CBre_12D <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                   Reach:Veh, 
                   family=binomial(link="logit"))
  display(CBre_12D)
  
  Term_12D <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                   Reach:Veh, 
                   family=binomial(link="logit"))
  display(Term_12D)
  


  stargazer::stargazer(CBre_12A,CBre_12D,Term_12A,Term_12D,type="text",
                       digits=2)
summary_residual_compare(CBre_12A,CBre_12D,Term_12A,Term_12D,bins=20)



  CBre_12D2 <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                   Reach:Veh, 
                   family=binomial(link="logit"))
  display(CBre_12D2)
  
  Term_12D2 <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   PSA+
                   Reach:Veh, 
                   family=binomial(link="logit"))
  display(Term_12D2)

  
  
  stargazer::stargazer(CBre_12A,CBre_12D2,Term_12A,Term_12D2,type="text",
                       digits=2)
summary_residual_compare(CBre_12A,CBre_12D2,Term_12A,Term_12D2,bins=20)




  CBre_12D3 <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                   NoComp:Veh+
                   PSA+
                   Reach:Veh, 
                   family=binomial(link="logit"))
  display(CBre_12D3)

  
  stargazer::stargazer(CBre_12A,CBre_12D3,Term_12A,Term_12D2,type="text",
                       digits=2)
summary_residual_compare(CBre_12A,CBre_12D3,Term_12A,Term_12D2,bins=20)


```
Expectations were hold for ceiling breaches and single and multi award IDCs. However, not for FSS/GWAC nor for multiaward idcs for international contracts from internationally oriented contracting offies. Leaving it out.
## Customer Interactions
### 13A: Defense and Reachback

Expectation: The reachback concept originated with the Department of Defense. The interaction of international reachback contracting and defense will positively estimate the probability of ceiling breaches and terminations.

```{r Model3A}
    summary_discrete_plot(crisis_smp,"Reach","Is.Defense")


#Create the model

  CBre_13A <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Reach:Is.Defense, 
                   family=binomial(link="logit"))
  display(CBre_13A)
  
  Term_13A <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Reach:Is.Defense, 
                   family=binomial(link="logit"))
  display(Term_13A)
  


  stargazer::stargazer(CBre_12A,CBre_13A,Term_12A,Term_13A,type="text",
                       digits=2)
summary_residual_compare(CBre_12A,CBre_13A,Term_12A,Term_13A,bins=20)


```
The results ran contrary to expectations and ran into VIF problems when combined with reach:Crisis and even on their own for terminations. Leaving this out.

### 13B: Defense and Crisis

Expectation: The relationship could run either way. One the one hand, DoD tends to operate in less permissive environments. On the other, the organization is more attuned to handling crisis and the challenging logistics of these situations and also has considerable advantages of scale. Leaning on the latter idea, the study team expects that the interaction of Defense and Crisis will negatively estimate the probability of ceiling breaches and terminations.

```{r Model13B}
    summary_discrete_plot(crisis_smp,"Is.Defense","Crisis")


#Create the model

  CBre_13B <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  display(CBre_13B)
  
  Term_13B <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  display(Term_13B)
  


  stargazer::stargazer(CBre_12A,CBre_13B,Term_12A,Term_13B,type="text",
                       digits=2)
summary_residual_compare(CBre_12A,CBre_13B,Term_12A,Term_13B,bins=20)


```
The outcome proved to vary by type of crisis. The expectation held for OCO ceiling breaches, but not for disasters or fror ARRA. For Terminations, expectations were largerly thwarted, with the exception of disasters where the termination rate was lower.

### 13C: Defense and Competiion
Expectation: The market for Defense goods is more of a monosopy than other forms of contracting, as a result, the benefits of competition may be less pronounced. The study team expects that the interaction of defense and no competition will negatively estimate the probability of ceiling breaches and terminations while no competition alone will positively estimate the same.


```{r Model13C}
    summary_discrete_plot(crisis_smp,"NoComp","Is.Defense")
summary_discrete_plot(crisis_smp,"Comp","Is.Defense")


#Create the model

  CBre_13C <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     NoComp:Is.Defense, 
                   family=binomial(link="logit"))
  display(CBre_13C)
  
  Term_13C <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     b_NoComp:Is.Defense, 
                   family=binomial(link="logit"))
  display(Term_13C)
  


  stargazer::stargazer(CBre_13B,CBre_13C,Term_13B,Term_13C,type="text",
                       digits=2)

summary_residual_compare(CBre_13B,CBre_13C,Term_13B,Term_13C,bins=20)


  CBre_13C2 <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     NoComp:Is.Defense, 
                   family=binomial(link="logit"))
  display(CBre_13C2)
  
  
  stargazer::stargazer(CBre_13B,CBre_13C2,Term_13B,Term_13C,type="text",
                       digits=2)

summary_residual_compare(CBre_13B,CBre_13C2,Term_13B,Term_13C,bins=20)

```
The results are striking and, for ceiling breaches, unexpected. For Defense contracts, competition estimateds a higher probability of a ceiling breach while the opposite is estimated for civilian contracts. With terminations, the results went the other way, aligning with expectations. For Ceiling breaches the VIF goes above 2, meaning that either Comp:Is.Defense or Crisis:Comp needs to be dropped. Dropping Comp:Is.Defense as the residuals seem smaller and it ran closer to expectations.

##Product or Service Area
### 14A: Defense and Product or Service Area

Expectation: Some categories, specifically weapons and launchers, already likely heavily overlap with defense so the results will not be especailly illuminating. However, for advanced weapon systems, ships, planes, land vehicles, R&D, and professional and managerial services interaction with defense will positively estimate the probability of ceiling breaches and terminations. However, the DoD also has a well established global logistics chain, and for commodities, Defense will negatively estimate the probability of ceiling breaches and terminations. 

```{r Model3A}
    summary_discrete_plot(crisis_smp,"PSA","Is.Defense")


#Create the model

  CBre_14A <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     PSA:Is.Defense, 
                   family=binomial(link="logit"))
  display(CBre_14A)
  
  Term_14A <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     PSA:Is.Defense, 
                   family=binomial(link="logit"))
  display(Term_14A)
  


  stargazer::stargazer(CBre_13B,CBre_14A,Term_13B,Term_14A,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14A,Term_13B,Term_14A,bins=20)

  
```
VIF proves off the charts. This interaction will be drpopped.

### 14B: Ceiling and Product or Service Area
Expectation: Complex and risky product or service areas still have some comparatively simple product or service codes in addition to covering highly volatile ones. The study team expects that size will help determine which is which and thus that the interaction of Ceiling and the complex PSAs (major defense acquisition programs and, given sourcing challenges, fuels) will positively estimate the probability of terminations and ceiling breaches
```{r Model4B}
    summary_continuous_plot(crisis_smp,"l_Ceil","PSA")


#Create the model

  CBre_14B <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     PSA:cl_Ceil, 
                   family=binomial(link="logit"))
  display(CBre_14B)
  
  Term_14B <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     PSA:cl_Ceil, 
                   family=binomial(link="logit"))
  display(Term_14B)
  


  stargazer::stargazer(CBre_13B,CBre_14B,Term_13B,Term_14B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14B,Term_13B,Term_14B,bins=20)


  CBre_14B2 <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     PSA:cl_Ceil, 
                   family=binomial(link="logit"))
  display(CBre_14B2)
  
  Term_14B2 <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+
                     b_NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     PSA:cl_Ceil, 
                   family=binomial(link="logit"))
  display(Term_14B2)
  
  stargazer::stargazer(CBre_13B,CBre_14B2,Term_13B,Term_14B2,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14B2,Term_13B,Term_14B2,bins=20)



  CBre_14B3 <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     cl_Days:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     PSA:cl_Ceil, 
                   family=binomial(link="logit"))
  display(CBre_14B3)

  stargazer::stargazer(CBre_13B,CBre_14B3,Term_13B,Term_14B2,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14B3,Term_13B,Term_14B2,bins=20)

```
Even with other ceiling interactions removed, the VIF for ceiling remains above 2. Leaving out this interaction

### 14C: Fixed and Product or Service Area

Expectation: Cost-base contnracts are more oriented towards products and services where costs are difficult to estimate in advanced, for  example professional and managerial services or MDAP developments. The study team expects that the  interaction of fixed-price and commodities will negatively estiate the probability of ceiling breaches and terminations, even if the net coefficient for terminations remains positive..

```{r Model14C}
    summary_discrete_plot(crisis_smp,"PSA","n_Fixed")


#Create the model

  CBre_14C <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     PSA:n_Fixed, 
                   family=binomial(link="logit"))
  display(CBre_14C)
  
  Term_14C <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     PSA:n_Fixed, 
                   family=binomial(link="logit"))
  display(Term_14C)
  


  stargazer::stargazer(CBre_13B,CBre_14C,Term_13B,Term_14C,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14C,Term_13B,Term_14C,bins=20)

  
```
VIFs are prohibitive.

###14D: Removing Days

```{r Model4E}

#Create the model

  CBre_14D <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     # cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+
                   # cl_Days:NoComp+
                     # cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  display(CBre_14D)
  
  stargazer::stargazer(CBre_13B,CBre_14D,Term_13B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14,Term_13B,Term_13B,bins=20)

  
```

###14E: Removing Ceiling

```{r Model14E}

#Create the model

  CBre_14E <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     # cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    # cl_Ceil:NoComp+
                   cl_Days:NoComp+
                     cl_Days:Veh+
                     # cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  display(CBre_14E)

  stargazer::stargazer(CBre_13B,CBre_14E,Term_13B,Term_14E,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14E,Term_13B,Term_13B,bins=10)

  
```

###14F: Removing Urgency

```{r Model14F}

#Create the model

  CBre_14F <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +b_NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:b_NoComp+
                   cl_Days:b_NoComp+
                     cl_Days:Veh+
                     cl_Ceil:Veh+
                   b_NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  display(CBre_14F)

  stargazer::stargazer(CBre_13B,CBre_14F,Term_13B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14F,Term_13B,Term_13B,bins=20)

  
```

###14G: Removing Crisis

```{r Model14G}

#Create the model

  CBre_14G <- glm (data=crisis_smp,
                   b_CBre ~
                     # Crisis +
                     NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+
                   cl_Days:NoComp+
                     cl_Days:Veh+
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA,
                     # Reach:Crisis+
                     # Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  display(CBre_14G)

  stargazer::stargazer(CBre_13B,CBre_14G,Term_13B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14G,Term_13B,Term_13B,bins=10)

  
```

### 14H: Removing Vehicle
```{r Model14H}

#Create the model

  CBre_14H <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +
                     NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     # Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+
                   cl_Days:NoComp+
                     # cl_Days:Veh+
                     # cl_Ceil:Veh+
                   # NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense,
                   family=binomial(link="logit"))
  display(CBre_14H)

  stargazer::stargazer(CBre_13B,CBre_14H,Term_13B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14H,Term_13B,Term_13B,bins=10)

  
```

### 14I: Removing UCA
```{r Model14I}

#Create the model

  CBre_14I <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +
                     NoComp +
                     # b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+
                   cl_Days:NoComp+
                     cl_Days:Veh+
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense,
                   family=binomial(link="logit"))
  display(CBre_14I)

  stargazer::stargazer(CBre_13B,CBre_14I,Term_13B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14I,Term_13B,Term_13B,bins=20)

  
```

### 14J: Removing Comp
```{r Model14J}

#Create the model

  CBre_14J <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +
                     # NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    # cl_Ceil:NoComp+
                   # cl_Days:NoComp+
                     cl_Days:Veh+
                     cl_Ceil:Veh+
                   # NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense,
                   family=binomial(link="logit"))
  display(CBre_14J)

  stargazer::stargazer(CBre_13B,CBre_14J,Term_13B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14J,Term_13B,Term_13B,bins=10)

  
```

### 14K: Removing Fixed
```{r Model14K}

#Create the model

  CBre_14K <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +
                     NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     # n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+
                   cl_Days:NoComp+
                     cl_Days:Veh+
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense,
                   family=binomial(link="logit"))
  display(CBre_14K)

  stargazer::stargazer(CBre_13B,CBre_14K,Term_13B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14K,Term_13B,Term_13B,bins=20)

  
```

### 14L: Removing Is.Defense
```{r Model14L}

#Create the model

  CBre_14L <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +
                     NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     # Is.Defense +
                    cl_Ceil:NoComp+
                   cl_Days:NoComp+
                     cl_Days:Veh+
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis,
                     # Crisis:Is.Defense,
                   family=binomial(link="logit"))
  display(CBre_14L)

  stargazer::stargazer(CBre_13B,CBre_14L,Term_13B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14L,Term_13B,Term_13B,bins=20)

  
```

### 14M: Removing PSA
```{r Model14M}

#Create the model

  CBre_14M <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +
                     NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+
                   cl_Days:NoComp+
                     cl_Days:Veh+
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   # PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense,
                   family=binomial(link="logit"))
  display(CBre_14M)

  stargazer::stargazer(CBre_13B,CBre_14M,Term_13B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14M,Term_13B,Term_13B,bins=20)

  
```
The problem does appear to be with PSA. The study team considered reverting to product/service/R&D for ceiling, although classically in contingency situations, the division in construction/commodities(products)/services(other than construction including R&D.) That alternative approach is likely more suitable, but also suggests an additional possible solution, namely splitting Facility Based Services and Construction services. The two together are one of the more numerous categories of services, albiet still dwarfed by "other products" and clothing and subsitence.  A look back to 11A



## Breaking out Construction
The study team had not initially focused on construction as a risk area and had been surprised to see that Facility-Related and Construction services had a high coefficient. The importance of this became clear on closer examination. The team spoke to two in-house experts for their opinions, to inform the expections below.

Expecation: Construction, in and of itself, is not seen as a higher risk area than other forms of contracting or contingency contracting. One expert thought that this also extended to on base construction in the field. These conracts, likely funded as MilCon, may have run into a fair amount of trouble around 2005, but by present day, we know what we're doing.

However, outside of bases, the construction related to development work can be notably higher risk. In particular, these contracts may have to subcontract for security which can be an additional source of risk. 

Otherwise we would expect that services will positively estimate the probability of terminations and ceiling breaches as in addition to the challenges of measuring services, services also are often in the field and thus higher risk while commodities can sometimes be acquired elsewhere.

### 15A: Commmodity/Service/Construction
```{r Model15A}
summary_discrete_plot(crisis_smp,"ServCommCons",rotate_text=TRUE)

#Create the model

  CBre_15A <- glm (data=crisis_smp,
                   b_CBre ~ Crisis + NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  display(CBre_15A)
  
  Term_15A <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  display(Term_15A)
  


  stargazer::stargazer(CBre_13B,CBre_15A,Term_13B,Term_15A,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_15A,Term_13B,Term_15A,bins=20)
```
Expectations are upheld, but breaking out construction, in and of itself, is not enough to resolve the challenges with residuals.

### 15B: Crisis Product or Service Area
Expectations mirrior earlier expecations, with the addition 
```{r Model15B}
freq_discrete_plot(crisis_smp,"ServCommCons",rotate_text=TRUE)
discrete_percent_plot(crisis_smp,"ServCommCons",caption=FALSE,rotate_text=TRUE)


#Create the model

  CBre_15B <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   CPSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  display(CBre_15B)
  
  Term_15B <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   CPSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  display(Term_15B)
  


  stargazer::stargazer(CBre_13B,Term_15B,Term_13B,Term_15B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_15B,Term_13B,Term_15B,bins=50)


coefplot(CBre_15B)
save(CBre_15B,file="CBre_15B.Rda")
```

###15C: P/S/C and Crisis
Expectation: Services and construction are more likely to be performed in the field, and thus can become a greater challenge in a crisis. The interaction of Crisis with services and construction positively estimate the probability of terminations and ceiling breaches.

```{r Model15C}
summary_discrete_plot(crisis_smp,"ServCommCons",rotate_text=TRUE)
summary_discrete_plot(crisis_smp,"Crisis","ServCommCons")

#Create the model

  CBre_15C <- glm (data=crisis_smp,
                   b_CBre ~ Crisis + NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     ServCommCons:Crisis, 
                   family=binomial(link="logit"))
  display(CBre_15C)
  
  Term_15C <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     ServCommCons:Crisis, 
                   family=binomial(link="logit"))
  display(Term_15C)
  


  stargazer::stargazer(CBre_15A,CBre_15C,Term_15A,Term_15C,type="text",
                       digits=2)
summary_residual_compare(CBre_15A,CBre_15C,Term_15A,Term_15C,bins=20)


  CBre_15C2 <- glm (data=crisis_smp,
                   b_CBre ~ Crisis + NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     # Crisis:Is.Defense+
                     ServCommCons:Crisis,
                   family=binomial(link="logit"))
  display(CBre_15C2)
  
  Term_15C2 <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     # Crisis:Is.Defense+
                     ServCommCons:Crisis, 
                   family=binomial(link="logit"))
  display(Term_15C2)
  

stargazer::stargazer(CBre_15A,CBre_15C2,Term_15A,Term_15C2,type="text",
                       digits=2)
summary_residual_compare(CBre_15A,CBre_15C2,Term_15A,Term_15C2,bins=20)

```
Expectations were not upheld, but VIF threshold of two was also exceeded for both models.


###15D: P/S/C and  Is.Defense
Expectation: The Department of Defense has a substantial logistics network and a great deal of experience with construction, particularly on bases. The interaction of Defense with services and construction is expected to negatively estimate the probability of terminations and ceiling breaches.

```{r Model15D}
summary_discrete_plot(crisis_smp,"Is.Defense","ServCommCons")

#Create the model

  CBre_15D <- glm (data=crisis_smp,
                   b_CBre ~ Crisis + NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     ServCommCons:Is.Defense, 
                   family=binomial(link="logit"))
  display(CBre_15D)
  
  Term_15D <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     ServCommCons:Is.Defense, 
                   family=binomial(link="logit"))
  display(Term_15D)
  


  stargazer::stargazer(CBre_15A,CBre_15D,Term_15A,Term_15D,type="text",
                       digits=2)
summary_residual_compare(CBre_15A,CBre_15D,Term_15A,Term_15D,bins=20)


  CBre_15D2 <- glm (data=crisis_smp,
                   b_CBre ~ Crisis + NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     # Crisis:Is.Defense+
                     ServCommCons:Is.Defense,
                   family=binomial(link="logit"))
  display(CBre_15D2)
  
  Term_15D2 <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     # Crisis:Is.Defense+
                     ServCommCons:Is.Defense, 
                   family=binomial(link="logit"))
  display(Term_15D2)

stargazer::stargazer(CBre_15A,CBre_15D2,Term_15A,Term_15D2,type="text",
                       digits=2)
summary_residual_compare(CBre_15A,CBre_15D2,Term_15A,Term_15D2,bins=20)

```
The results ran contrary to expectations, but VIF was exceeded, making the point moot.


###15E: P/S/C and Reachback
Expectation: Services and construction are more likely to be performed in the field, and thus can become a greater challenge for internationally performed contracts. Products can be most easily shipped, and thus may hav the greatest advantage for domestic contracting offices. The interaction of internationally performed contracts with services and construction positively estimate the probability of terminations and ceiling breaches. The interaction of domestic offices with products (the baseline variable) will negatively positively estimate the probability of terminations and ceiling breaches.

```{r Model15E}
summary_discrete_plot(crisis_smp,"Reach","ServCommCons")

#Create the model

  CBre_15E <- glm (data=crisis_smp,
                   b_CBre ~ Crisis + NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     ServCommCons:Reach, 
                   family=binomial(link="logit"))
  display(CBre_15E)
  
  Term_15E <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     ServCommCons:Reach, 
                   family=binomial(link="logit"))
  display(Term_15E)
  


  stargazer::stargazer(CBre_15A,CBre_15E,Term_15A,Term_15E,type="text",
                       digits=2)
summary_residual_compare(CBre_15A,CBre_15E,Term_15A,Term_15E,bins=20)



  CBre_15E2 <- glm (data=crisis_smp,
                   b_CBre ~ Crisis + NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   ServCommCons+
                     # Reach:Crisis+
                     Crisis:Is.Defense+
                     ServCommCons:Reach, 
                   family=binomial(link="logit"))
  display(CBre_15E2)
  
  Term_15E2 <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   ServCommCons+
                     # Reach:Crisis+
                     Crisis:Is.Defense+
                     ServCommCons:Reach, 
                   family=binomial(link="logit"))
  display(Term_15E2)
  

  stargazer::stargazer(CBre_15A,CBre_15E2,Term_15A,Term_15E2,type="text",
                       digits=2)
summary_residual_compare(CBre_15A,CBre_15E2,Term_15A,Term_15E2,bins=20)
summary_residual_compare(CBre_15B,CBre_15E2,Term_15B,Term_15E2,bins=20)

```
The results are somewhat interesting, with the US-50-Intl experience not quite running in line with expectation but instead specifically upholding hypothesis. However, the rarity of terminations for Intl-Dom contstruction would likely cause challenges further down the line. Leaving it out.

### 15F: Crisis Product or Service Area
Expectations mirrior earlier expecations, with the addition 
```{r Model15F}
crisis_smp$sqrcl_Ceil<-crisis_smp$cl_Ceil^2


freq_discrete_plot(crisis_smp,"ServCommCons",rotate_text=TRUE)
discrete_percent_plot(crisis_smp,"ServCommCons",caption=FALSE,rotate_text=TRUE)


#Create the model

  CBre_15F <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     sqrcl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   CPSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  display(CBre_15F)
  
  Term_15F <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     sqrcl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                   CPSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  display(Term_15F)
  


  stargazer::stargazer(CBre_15B,Term_15F,Term_15B,Term_15F,type="text",
                       digits=2)
summary_residual_compare(CBre_15B,CBre_15F,Term_15B,Term_15F,bins=50)



  CBre_15F2 <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     sqrcl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+
                     sqrcl_Ceil:Veh:NoComp+
                     cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     sqrcl_Ceil:Veh+
                   NoComp:Veh+
                   CPSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  display(CBre_15F2)
  
  Term_15F2 <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     sqrcl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                      sqrcl_Ceil:Veh+

                     b_NoComp:Veh+
                   CPSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  display(Term_15F2)

  
    stargazer::stargazer(CBre_15B,Term_15F2,Term_15B,Term_15F2,type="text",
                       digits=2)
summary_residual_compare(CBre_15B,CBre_15F2,Term_15B,Term_15F2,bins=50)



  CBre_15F3 <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     sqrcl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                     cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     sqrcl_Ceil:Veh+
                   NoComp:Veh+
                   CPSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  display(CBre_15F3)
  
  Term_15F3 <- glm (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     sqrcl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     b_NoComp:Veh+
                   CPSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  display(Term_15F3)

  stargazer::stargazer(CBre_15B,Term_15F3,Term_15B,Term_15F3,type="text",
                       digits=2)
summary_residual_compare(CBre_15B,CBre_15F3,Term_15B,Term_15F3,bins=50)


  CBre_15F4 <- glm (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     sqrcl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                     cl_Days:NoComp+
                     cl_Days:Veh+ 
                   NoComp:Veh+
                   CPSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  display(CBre_15F4)
  stargazer::stargazer(CBre_15B,CBre_15F4,Term_15B,Term_15F3,type="text",
                       digits=2)
summary_residual_compare(CBre_15B,CBre_15F4,Term_15B,Term_15F3,bins=50)
  

```
Experimenting with a squared term is ultimately unsuccessful.

#Multi-Level Model
### 16A: Product/Service/R&D and Platform
```{r Model16A}
summary(crisis_smp$ServCommCons)
summary(crisis_smp$CPSA)

load("model16A.rdata")  
  CBre_16A <- glmer (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     # (1 | Simple) + 
                     (1| PSA), 
                   family=binomial(link="logit"))
  display(CBre_16A)
  
  Term_16A <- glmer (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     # (1 | Simple) +
                     (1| PSA), 
                   family=binomial(link="logit"))
  display(Term_16A)
# Plot the model and Vehicle 
stargazer::stargazer(CBre_15B,CBre_16A,Term_15B,Term_16A,type="text",
                        digits=2)
summary_residual_compare(CBre_15B,CBre_16A,Term_15B,Term_16A)

save(CBre_16A,Term_16A, file="Model16A.RData")
```
Note, the equatiosn don't actually match up. First thing I noticed was to remove the Simples.

### 16B: Interactions
```{r Model16B}


load("model16B.rdata")  

  # CBre_16B <- glmer (data=crisis_smp,
  #                  b_CBre ~ Crisis + NoComp + 
  #                    b_UCA +
  #                    Reach + c_OffCri + 
  #                    cl_Ceil + 
  #                    cl_Days + 
  #                    Veh + 
  #                    n_Fixed + 
  #                    Is.Defense + 
  #                    # NoComp:Crisis +
  #                    # b_UCA:Crisis + 
  #                    # Reach:Crisis + 
  #                    # Reach:NoComp + 
  #                    # cl_Days:Veh + 
  #                    # cl_Ceil:Veh +
  #                    # NoComp:Veh + 
  #                    (1 | Simple)+(1 |  PSA), 
  #                  family=binomial(link="logit"))
  display(CBre_16B)
  # 
  # Term_16B <- glmer (data=crisis_smp,
  #                  b_Term ~ Crisis + 
  #                    b_NoComp + 
  #                    b_UCA + 
  #                    Reach + c_OffCri + 
  #                    cl_Ceil + 
  #                    cl_Days + 
  #                    Veh +
  #                    n_Fixed +
  #                    Is.Defense + 
  #                    # Crisis:b_NoComp + 
  #                    # b_UCA:Crisis + 
  #                    # Reach:Crisis + 
  #                    # cl_Ceil:Crisis + 
  #                    # cl_Ceil:Reach + 
  #                    # cl_Days:Crisis + 
  #                    # cl_Days:NoComp+ +
  #                    # cl_Days:Veh + 
  #                    # cl_Ceil:Veh+
  #                    # b_NoComp:Veh + 
  #                     (1 |  PSA), 
  #                  family=binomial(link="logit"))
  display(Term_16B)
  # 

stargazer::stargazer(CBre_11B,CBre_16A,CBre_16B,Term_11B,Term_16A,Term_16B,type="text",
                        digits=2)

summary_residual_compare(CBre_16A,CBre_16B,Term_16A,Term_16B)
# save(CBre_16B,Term_16B, file="Model16B.RData")

```
The use of Comp as 

Ceil converges
Term Model failed to converge with max|grad| = 0.00135324 (tol = 0.001, component 1)

### 16C: Code-level detail
```{r Model16C}
load("Model16C.RData") #Only have CBre at the moment

  # CBre_16C <- glmer (data=crisis_smp,
  #                  b_CBre ~ Crisis + NoComp + 
  #                    b_UCA +
  #                    Reach + c_OffCri + 
  #                    cl_Ceil + 
  #                    cl_Days + 
  #                    Veh + 
  #                    n_Fixed + 
  #                    Is.Defense + 
  #                    # NoComp:Crisis +
  #                    # b_UCA:Crisis + 
  #                    # Reach:Crisis + 
  #                    # Reach:NoComp + 
  #                    # cl_Days:Veh + 
  #                    # cl_Ceil:Veh +
  #                    # NoComp:Veh + 
  #                    (1 | Simple)+(1 |  PSA) + (1|ProdServ), 
  #                  family=binomial(link="logit"))
  display(CBre_16C)
  # 
  # Term_16C <- glmer (data=crisis_smp,
  #                  b_Term ~ Crisis + 
  #                    b_NoComp + 
  #                    b_UCA + 
  #                    Reach + c_OffCri + 
  #                    cl_Ceil + 
  #                    cl_Days + 
  #                    Veh +
  #                    n_Fixed +
  #                    Is.Defense + 
  #                    # Crisis:b_NoComp + 
  #                    # b_UCA:Crisis + 
  #                    # Reach:Crisis + 
  #                    # cl_Ceil:Crisis + 
  #                    # cl_Ceil:Reach + 
  #                    # cl_Days:Crisis + 
  #                    # cl_Days:NoComp+ +
  #                    # cl_Days:Veh + 
  #                    # cl_Ceil:Veh +
  #                    # b_NoComp:Veh+ 
  #                      (1 | Simple)+(1 |  PSA) + (1|ProdServ), 
  #                  family=binomial(link="logit"))
  # display(Term_16C)
  stargazer::stargazer(CBre_11B,CBre_16A,CBre_16B,CBre_16C,Term_11B,Term_16A,Term_16B,type="text",
                        digits=2)

summary_residual_compare(CBre_16B,CBre_16C,Term_16A,Term_16B)
# save(CBre_16C, Term_16C, file="Model16C.RData")
```

CBre_16C Model failed to converge with max|grad| = 0.0103776 (tol = 0.001, component 1)

Term_16C 
Model failed to converge with max|grad| = 0.0338872 (tol = 0.001, component 1)




### 16D: Crisis + Product ServiceArea

```{r Model16D}
summary(crisis_smp$PSA)
crisis_smp$PSA<-factor(crisis_smp$PSA)
#Frequency Plot
freq_discrete_cbre_plot(crisis_smp,"PSR_What")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))

#Percent Terminated Plot 
discrete_percent_cbre_plot(crisis_smp,"PSR_What")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))

load("model16D.rdata")  

  CBre_16D <- glmer (data=crisis_smp,
                    b_CBre ~ NoComp +
                     b_UCA +
                     Reach + c_OffCri +
                     cl_Ceil +
                     cl_Days +
                     Veh +
                     n_Fixed +
                     Is.Defense +
                      cl_Ceil:NoComp+
                      cl_Days:NoComp+
                     cl_Days:Veh+
                     cl_Ceil:Veh+
                   NoComp:Veh+

                     (1 + Reach + Is.Defense| Crisis) + (1 | PSA),
                   family=binomial(link="logit"))
display(CBre_16D)

  Term_16D <- glmer(data=crisis_smp,
                   b_Term ~ Crisis +
                     b_NoComp +
                     b_UCA +
                     Reach + c_OffCri +
                     cl_Ceil +
                     cl_Days +
                     Veh +
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     cl_Days:Veh+
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                  (1+ b_UCA + Reach + Is.Defense | Crisis) +  (1| PSA) ,
                   family=binomial(link="logit"))


display(Term_16D)
# Plot the model and Vehicle 

stargazer::stargazer(CBre_15A,CBre_15D,Term_15A,Term_15D,type="text",
                        digits=2)
summary_residual_compare(CBre_15A,CBre_15D,Term_15A,Term_15D,50)

# save(CBre_16A,Term_16A, file="Model16A.RData")
```

CBre Model failed to converge with max|grad| = 0.00182267 (tol = 0.001, component 1)


Term Model failed to converge with max|grad| = 0.00151616 (tol = 0.001, component 1)
### 16E: Serv/Supply/Const + Area
Initial multi-level analysis used CSIS's traditional product or service areas. After additional analysis in  step 15, this approach was rerun using 
```{r Model16E}
summary(crisis_smp$ServCommCons)
summary(crisis_smp$CPSA)

load("model16E.rdata")  
  CBre_16E <- glmer (data=crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     (1 | ServCommCons) + (1| CPSA), 
                   family=binomial(link="logit"))
  display(CBre_16E)
  
  Term_16E <- glmer (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     (1 | ServCommCons) + (1| CPSA), 
                   family=binomial(link="logit"))
  display(Term_16E)
# Plot the model and Vehicle 

stargazer::stargazer(CBre_15B,CBre_16A,CBre_16C,CBre_16E,Term_15B,Term_16A,Term_16C,Term_16E,type="text",
                        digits=2)
summary_residual_compare(CBre_15B,CBre_16E,Term_15B,Term_16E)
summary_residual_compare(CBre_16A,CBre_16E,Term_16A,Term_16E)
summary_residual_compare(CBre_16C,CBre_16E,Term_16C,Term_16E)

  Term_16E2 <- glmer (data=crisis_smp,
                   b_Term ~ Crisis +b_NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:b_NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     b_NoComp:Veh+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                    (1| CPSA), 
                   family=binomial(link="logit"))
  display(Term_16E2)

  save(CBre_16E,Term_16E, file="Model16E.RData")
```
Term  failed to converge 0.004





### 16F: Revised Code-level detail no interactions
Some of the discussions of a failure to converge suggest that the model is too complex. In this step we remove all the interactions.
```{r Model16F}
load("Model16F.RData") #Only have CBre at the moment

    # CBre_16F <- glmer (data=large_crisis_smp,
    #                  b_CBre ~ Crisis + NoComp +
    #                    b_UCA +
    #                    Reach + 
    #                    # c_OffCri +
    #                    cl_Ceil +
    #                    cl_Days +
    #                    Veh +
    #                    n_Fixed +
    #                    Is.Defense +
    #                    # NoComp:Crisis +
    #                    # b_UCA:Crisis +
    #                    # Reach:Crisis +
    #                    # Reach:NoComp +
    #                    # cl_Days:Veh +
    #                    # cl_Ceil:Veh +
    #                    # NoComp:Veh +
    #                    (1 | ServCommCons)+(1 |  CPSA) + (1|ProdServ),
    #                  family=binomial(link="logit"))
    # display(CBre_16F)
    # glmer_examine(CBre_16F)
#This one was lost, but did and had a low Max|Grad than CBre_16F but still well above 
    
    
    # CBre_16F2 <- glmer (data=large_crisis_smp,
    #                  b_CBre ~ Crisis + NoComp +
    #                    b_UCA +
    #                    Reach + 
    #                    # c_OffCri +
    #                    cl_Ceil +
    #                    # cl_Days +
    #                    Veh +
    #                    n_Fixed +
    #                    Is.Defense +
    #                    # NoComp:Crisis +
    #                    # b_UCA:Crisis +
    #                    # Reach:Crisis +
    #                    # Reach:NoComp +
    #                    # cl_Days:Veh +
    #                    # cl_Ceil:Veh +
    #                    # NoComp:Veh +
    #                    # (1 | ServCommCons)+(1 |  CPSA) +
    #                    (1|ProdServ),
    #                  family=binomial(link="logit"))
    display(CBre_16F2)
    glmer_examine(CBre_16F2)
    save(CBre_16F2,file="Model16F.RData")
    rm(CBre_16F2)
```

Removing all the interactions and c_OfficeCri doesn't help the convergence, even when limiting only to prodserv as a multilevel variable. An additional step, 16F2, also removed l_days and the model had an even harder time converging (max|grad| = 0.201). The 16F results were accidentally lost but were far from convergence and not worth rerunning.

###16G: Revised Code level all interactions
```{r Model16G}
load("Model16G.RData") #Only have CBre at the moment
    CBre_16G <- glmer (data=large_crisis_smp,
                     b_CBre ~ Crisis + NoComp +
                       b_UCA +
                       Reach + 
                       c_OffCri +
                       cl_Ceil +
                       cl_Days +
                       Veh +
                       n_Fixed +
                       Is.Defense +
                       NoComp:Crisis + 
                       b_UCA:Crisis +
                       Reach:Crisis +
                       Reach:NoComp +
                       cl_Days:Veh +
                       cl_Ceil:Veh +
                       NoComp:Veh +
                       (1 | ServCommCons)+(1 |  CPSA) +
                       (1|ProdServ),
                     family=binomial(link="logit"))
glmer_examine(CBre_16F3)

CBre_16G<- glmer (data=large_crisis_smp,
                     b_CBre ~ Crisis + NoComp +
                       b_UCA +
                       Reach + 
                       c_OffCri +
                       cl_Ceil +
                       cl_Days +
                       Veh +
                       n_Fixed +
                       Is.Defense +
                     cl_Days:NoComp +
                     cl_Days:Veh + 
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
                     NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
                     # Reach:Crisis This 
                   + Crisis:Is.Defense +
                       (1 | ServCommCons)+(1 |  CPSA) +
                       (1|ProdServ),
                     family=binomial(link="logit"))
glmer_examine(CBre_16G)
display(CBre_16G)
    save(CBre_16F3,CBre_16G,file="Model16G.RData")
 
```

16G ran into multicollinearity problems, necessitating the removal of some of the interactions. New interactions were also added the analysis in step 15. Step 16 groups all of the multilevel models together, because of run-time related complications and advice regarding logit models. In some cases though, dealing with the multilevel models resulted in ideas that were then fleshed out in earlier steps.

Dropped interactions: NoComp:Crisis, b_UCA:Crisis, Reach:Crisis, Reach:NoComp,          cl_Ceil:Veh

Added interactions: cl_Days:NoComp, Crisis:Is.Defense

Collectively these changes reduced the max|grad| from 0.017 to 0.004.

## 16H: 2-Digit Prodserv
Since the max|grad| isn't reaching 0.001, trying to experiment with 2-character product or service codes, rather than the fully detailed 4-character ones.

```{r Prodserv2}
  large_crisis_smp$ProdServ2<-factor(substr(large_crisis_smp$ProdServ,1,2))
     
  # CBre_16F4<-glmer(formula = b_CBre ~ Crisis + 
  #                    NoComp + 
  #                    b_UCA + 
  #                    Reach + 
  #                    cl_Ceil + 
  #                    cl_Days + 
  #                    Veh + 
  #                    n_Fixed + 
  #                    Is.Defense + 
  #                    cl_Days:NoComp + 
  #                    cl_Days:Veh + 
  #                    cl_Ceil:Veh + 
  #                    NoComp:Veh +
  #                    Reach:Crisis +
  #                   Crisis:Is.Defense +
  #                    (1 | ProdServ2),
  #                  data = large_crisis_smp, family = binomial(link = "logit"))
  display(CBre_16F4)
  glmer_examine(CBre_16F4)
  
  CBre_16F5<-glmer(formula = b_CBre ~ Crisis + 
                     NoComp + 
                     b_UCA + 
                     Reach + 
                     cl_Ceil + 
                     cl_Days + 
                     Veh + 
                     n_Fixed + 
                     Is.Defense + 
                     cl_Days:NoComp + 
                     cl_Days:Veh + 
                     cl_Ceil:Veh + 
                     NoComp:Veh +
                     # Reach:Crisis 
                   + Crisis:Is.Defense +
                     (1 | ProdServ2),
                   data = large_crisis_smp, family = binomial(link = "logit"))
  display(CBre_16F5)
  glmer_examine(CBre_16F5)
  
  CBre_16F6<-glmer(formula = b_CBre ~ Crisis + 
                     NoComp + 
                     b_UCA + 
                     Reach + 
                     cl_Ceil + 
                     cl_Days + 
                     Veh + 
                     n_Fixed + 
                     Is.Defense + 
                     # cl_Days:NoComp + We're not that close to the max|grad, this is significant but runs contrary 
                     #to expectation and is less interesting than the NoComp:Veh
                     cl_Days:Veh + 
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
                     NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
                     # Reach:Crisis This 
                   + Crisis:Is.Defense +
                     (1 | ProdServ2),
                   data = large_crisis_smp, family = binomial(link = "logit"))
  display(CBre_16F6)
  glmer_examine(CBre_16F6)
  

  stargazer::stargazer(CBre_16F4,CBre_16F5,CBre_16F6,type="text",
                        digits=2)
save(CBre_16F4,CBre_16F5,CBre_16F6,file="Model16H.RData")
```
The first model had multicollinearity problems, but unfortunately the VIF for reach exceeded 2.0 and the only reach related interaction was crisis:reach. Taking out the variable increased the max|grad| from 0.0038 to 0.0089. 
                    
Removing additional variables (cl_Days:NoComp, cl_Ceil:Veh) for the third and final model further increased the max|grad, not helpful.




GOing more detailed proved useful for 16F7

Model failed to converge with max|grad| = 0.00400832 (tol = 0.001, component 1)


## 16I: CPSA+Prodserv
This step goes back to 4 character product or service codes. 16G included three levels in the hierarchy: ServCommCons (service/commodity/construction) and crisis product or service area, and the full product or service code. This approach drops out ServCommCons, as it had a slightly lower standard deviation.

```{r Model16I}

load(file="Model16I.RData")


# CBre_16F9<-glmer(formula = b_CBre ~ Crisis + NoComp + b_UCA + Reach + c_OffCri + 
#     cl_Ceil + cl_Days + Veh + n_Fixed + Is.Defense + cl_Days:NoComp + 
#     cl_Days:Veh + NoComp:Veh + +Crisis:Is.Defense + (1 | ServCommCons) + 
#     (1 | ProdServ), data = large_crisis_smp, family = binomial(link = "logit"))

    glmer_examine(CBre_16F9)
    display(CBre_16F9)
    
    
# CBre_16G2 <- glmer (data=large_crisis_smp,
#                      b_CBre ~ Crisis + NoComp +
#                        b_UCA +
#                        Reach + 
#                        c_OffCri +
#                        cl_Ceil +
#                        cl_Days +
#                        Veh +
#                        n_Fixed +
#                        Is.Defense +
#                      cl_Days:NoComp +
#                      cl_Days:Veh + 
#                      # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
#                      NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
#                      # Reach:Crisis This 
#                    + Crisis:Is.Defense +
#                        # (1 | ServCommCons)+
#                      (1 |  CPSA) +
#                        (1|ProdServ),
#                      family=binomial(link="logit"))
  glmer_examine(CBre_16G2)
  
  # CBre_16G3<- glmer (data=extra_large_crisis_smp,
  #                    b_CBre ~ Crisis + NoComp +
  #                      b_UCA +
  #                      Reach + 
  #                      c_OffCri +
  #                      cl_Ceil +
  #                      cl_Days +
  #                      Veh +
  #                      n_Fixed +
  #                      Is.Defense +
  #                    cl_Days:NoComp +
  #                    cl_Days:Veh + 
  #                    # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
  #                    NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
  #                    # Reach:Crisis This 
  #                  + Crisis:Is.Defense +
  #                      # (1 | ServCommCons)+
  #                    (1 |  CPSA) +
  #                      (1|ProdServ),
  #                    family=binomial(link="logit"))
    
display(CBre_16G3)
glmer_examine(CBre_16G3)

   

  save(CBre_16F9,CBre_16G2,CBre_16G3,file="Model16I.RData")
  
  
```

The Max|Grad of this model is still too high, but is already lower than that for model CBre_16G2 (or what will be once I rename things.) Switching to an extra-large version of the sample, including all international contracts and task orders and a million domestic ones, reduced the |max|grad but only from 0.0036 to 0.0024. 

## 16J: Drop cl_Days:Veh

```{r Model16J}

  
        display(CBre_16G3)
    vif(CBre_16G3)
summary_residual_compare(CBre_16C,CBre_16F3,Term_16C,Term_16C)
summary_residual_compare(CBre_16C,CBre_16G,Term_16C,Term_16C)
summary_residual_compare(CBre_16C,CBre_16G,Term_16C,Term_16C)
summary_residual_compare(CBre_16C,CBre_16G3,Term_16C,Term_16C)
coef(CBre_16G)
save(CBre_16F2,CBre_16F3,CBre_16F4,CBre_16F5,CBre_16F6,CBre_16G,CBre_16G,CBre_16F9,CBre_16G3, file="Model16F.RData")

summary_discrete_plot(large_crisis_smp,"Veh","NoComp")
summary_continuous_plot(large_crisis_smp,"l_Days","Veh")
table(fed$Crisis,fed$NoComp,fed$Veh)
table(fed$Crisis,fed$NoComp,fed$Veh,fed$CBre)
table(fed$Crisis,fed$NoComp,fed$Veh,fed$CBre)


# CBre_16G4<-    glmer (data=large_crisis_smp,
#                      b_CBre ~ Crisis + NoComp +
#                        b_UCA +
#                        Reach + 
#                        c_OffCri +
#                        cl_Ceil +
#                        cl_Days +
#                        Veh +
#                        n_Fixed +
#                        Is.Defense +
#                      cl_Days:NoComp +
#                      # cl_Days:Veh + 
#                      # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
#                      NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
#                      # Reach:Crisis This 
#                    + Crisis:Is.Defense +
#                        # (1 | ServCommCons)+
#                      (1 |  CPSA) +
#                        (1|ProdServ),
#                      family=binomial(link="logit"))
    
    display(CBre_16G4)
glmer_examine(CBre_16G4)
save(CBre_16G4,file="Model16J.RData")
```
After consideration, cl_Days:Veh seemed to add the least to the model. Comparing the large sample to large sample, taking out does lower the Max|Grid from 0.0036 to 0.0027 


### 16K: Drop NoComp:Veh

```{r Model16K}
CBre_16G5 <- glmer (data=large_crisis_smp,
                     b_CBre ~ Crisis + NoComp +
                       b_UCA +
                       Reach + 
                       c_OffCri +
                       cl_Ceil +
                       cl_Days +
                       Veh +
                       n_Fixed +
                       Is.Defense +
                     cl_Days:NoComp +
                     # cl_Days:Veh + 
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
                     # NoComp:Veh + 
                     # Reach:Crisis This 
                   + Crisis:Is.Defense +
                       # (1 | ServCommCons)+
                     (1 |  CPSA) +
                       (1|ProdServ),
                     family=binomial(link="logit"))
    
    
   display(CBre_16G5)
glmer_examine(CBre_16G5)
save(CBre_16G5,file="Model16K.RData")



```
The next to test removing is top drop NoComp:Veh which often did not have significant differences between the no comp other and urgency variants, although it did in some cases. That dramatically ups the max|grad| to 0.01, so NoComp:Veh will be staying in.

### 16L: Drop OffCri

```{r Model16L}
CBre_16G6 <- glmer (data=large_crisis_smp,
                      b_CBre ~ Crisis + NoComp +
                        b_UCA +
                       Reach + 
# +                        c_OffCri +
                        cl_Ceil +
                        cl_Days +
                        Veh +
                        n_Fixed +
                       Is.Defense +
                     cl_Days:NoComp +
                     # cl_Days:Veh + 
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
                      NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
  # Reach:Crisis This 
                   + Crisis:Is.Defense +
                       # (1 | ServCommCons)+   
  (1 |  CPSA) +
                      (1|ProdServ),
                      family=binomial(link="logit"))
    
    
    summary_residual_compare(CBre_16C,CBre_16G6,Term_16C,Term_16C)
       display(CBre_16G6)
glmer_examine(CBre_16G6)
save(CBre_16G6,file="Model16L.RData")
```
Removing c_Offcri increases the max|grad from 0.0027 to 0.0042. Leaving it in.

### 16M: Drop CPSA

```{r Model16M}

    # https://rstudio-pubs-static.s3.amazonaws.com/33653_57fc7b8e5d484c909b615d8633c01d51.html
    library(numDeriv )
    derivs1 <- CBre_16G6@optinfo$derivs
sc_grad1 <- with(derivs1,solve(Hessian,gradient))
max(abs(sc_grad1))

max(pmin(abs(sc_grad1),abs(derivs1$gradient)))

    derivs1 <- CBre_16E@optinfo$derivs
sc_grad1 <- with(derivs1,solve(Hessian,gradient))
max(abs(sc_grad1))

max(pmin(abs(sc_grad1),abs(derivs1$gradient)))

CBre_16G6a <- update(CBre_16G6,start=ss,control=glmerControl(optimizer="bobyqa",
                            optCtrl=list(maxfun=2e5)))

gr
pars <- unlist(getME(CBre_16G6,c("theta","fixef")))
grad2 <- grad(dd,pars)
hess2 <- hessian(dd,pars)
sc_grad2 <- solve(hess2,grad2)
max(pmin(abs(sc_grad2),abs(grad2)))

     
     
CBre_16G7 <- glmer (data=large_crisis_smp,
                      b_CBre ~ Crisis + NoComp +
                        b_UCA +
                       Reach + 
+                        c_OffCri +
                        cl_Ceil +
                        cl_Days +
                        Veh +
                        n_Fixed +
                       Is.Defense +
                     cl_Days:NoComp +
                     # cl_Days:Veh + 
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
                      NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
  # Reach:Crisis This 
                   + Crisis:Is.Defense +
                       # (1 | ServCommCons)+   
  # (1 |  CPSA) +
                      (1|ProdServ),
                      family=binomial(link="logit"))
    
    
glmer_examine(CBre_16G7)
save(CBre_16G7, file="Model16M.RData")
    ```
    
Dropping CPSA raises the max|grad to 0.11. It appears the heirarchy does really help.

### 16N: Multilevel Crisis
```{r Model16N}

    
# CBre_16G10<-     glmer (data=large_crisis_smp,
#                       b_CBre ~  NoComp +
#                         b_UCA +
#                        Reach + 
#                         c_OffCri +
#                         cl_Ceil +
#                         cl_Days +
#                         Veh +
#                         n_Fixed +
#                        Is.Defense +
#                      cl_Days:NoComp +
#                      # cl_Days:Veh + 
#                      # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
#                       NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
#   # Reach:Crisis This 
#                        # (1 | ServCommCons)+   
#   (1 |  CPSA) +
#                       (1|ProdServ)+(1+Is.Defense |Crisis),
#                       family=binomial(link="logit"))

           display(CBre_16G10)
    glmer_examine(CBre_16G10)
    save(CBre_16G10, file="Model16N.RData")

    ss<-getME(CBre_16G10,c("theta","fixef"))
    CBre_16N2 <- update(CBre_16G10,start=ss,control=glmerControl(optimizer="bobyqa",
                            optCtrl=list(maxfun=2e5)))
    
        CBre_16N3 <- update(CBre_16G10,start=ss,control=glmerControl(optimizer="nloptwrap",
                            optCtrl=list(maxfun=2e5)))
```
Multi-level modeling of crisis, with seperate slopes based on the value for isdefense, lowers the max|grad to 0.0013, a new low. The alternate models were not saved due to user error but has max|grads of around 0.002 (bobyqa) and 0.004 (nloptwrap) respectively.

### 16O: Crisis:Reach
```{r Model16O}           
CBre_16G9 <- glmer (data=large_crisis_smp,
                      b_CBre ~  NoComp +
                        b_UCA +
                       Reach + 
                        c_OffCri +
                        cl_Ceil +
                        cl_Days +
                        Veh +
                        n_Fixed +
                       Is.Defense +
                     cl_Days:NoComp +
                     # cl_Days:Veh + 
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
                      NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
  # Reach:Crisis This 
                       # (1 | ServCommCons)+   
  (1 |  CPSA) +
                      (1|ProdServ)+(1+Is.Defense + Reach|Crisis),
                      family=binomial(link="logit"))

           display(CBre_16G9)
    glmer_examine(CBre_16G9)
    save(CBre_16G9, file="Model16O.RData")
```
Switching Crisis to a multilevel model unfortunately doesn't resolve the problems with included Crisis:Reach. Adding that interaction dramatically increases the Max|Grad to 0.017

### 16P: Dropping OffCri again
    ```{r Model16P}
    
load(file="Model16P.RData")
CBre_16G8 <- glmer (data=large_crisis_smp,
                      b_CBre ~  NoComp +
                        b_UCA +
                       Reach + 
#                         c_OffCri +
                        cl_Ceil +
                        cl_Days +
                        Veh +
                        n_Fixed +
                       Is.Defense +
                     cl_Days:NoComp +
                     # cl_Days:Veh + 
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
                      NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
  # Reach:Crisis This 
                       # (1 | ServCommCons)+   
  (1 |  CPSA) +
                      (1|ProdServ)+(1+Is.Defense|Crisis),
                      family=binomial(link="logit"))
    
           display(CBre_16G8)
    glmer_examine(CBre_16G8)
    

CBre_16M<-     glmer (data=extra_large_crisis_smp,
                      b_CBre ~  NoComp +
                        b_UCA +
                       Reach + 
                        # c_OffCri +
                        cl_Ceil +
                        cl_Days +
                        Veh +
                        n_Fixed +
                       Is.Defense +
                     cl_Days:NoComp +
                     # cl_Days:Veh + 
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
                      NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
  # Reach:Crisis This 
                       # (1 | ServCommCons)+   
  (1 |  CPSA) +
                      (1|ProdServ)+(1+Is.Defense |Crisis),
                      family=binomial(link="logit"),
verbose=1)
     
glmer_examine(CBre_16M) 
save(CBre_16G8,CBre_16M, file="Model16P.RData")
```
Removing c_OffCri does help reducing the max|Grad to 0.0012. Unfortunately, the extra_data version of this query actually increases the max|grad to 0.0033.


### 16Q: Dropping NoComp:Veh

    ```{r Model16P}
    
    
CBre_16G11 <- glmer (data=large_crisis_smp,
                      b_CBre ~  NoComp +
                        b_UCA +
                       Reach + 
                        # c_OffCri +
                        cl_Ceil +
                        cl_Days +
                        Veh +
                        n_Fixed +
                       Is.Defense +
                     cl_Days:NoComp +
                     # cl_Days:Veh + 
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
#                       NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
  # Reach:Crisis This 
                       # (1 | ServCommCons)+   
  (1 |  CPSA) +
                      (1|ProdServ)+(1+Is.Defense |Crisis),
                      family=binomial(link="logit"))
    glmer_examine(CBre_16G11) 
      save(CBre_16G11, file="Model16Q.RData")
      
      
      stargazer::stargazer(CBre_16F8,CBre_16G,type="text",
                     digits=2)
      rm(CBre_16F8)

```
Removing NoComp:Veh still ups the max|grid, in this case to 0.005.
     
     
```{r Model16S}
    
CBre_16G12<-     glmer (data=large_crisis_smp,
                      b_CBre ~  NoComp +
                        b_UCA +
                       Reach + 
                        # c_OffCri +
                        cl_Ceil +
                        cl_Days +
                        Veh +
                        n_Fixed +
                       Is.Defense +
                     cl_Days:NoComp +
                     cl_Days:Veh +
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
                      NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
  # Reach:Crisis This 
                       # (1 | ServCommCons)+   
  (1 |  CPSA) +
                      (1|ProdServ)+(1+Is.Defense|Crisis),
                      family=binomial(link="logit"))
    glmer_examine(CBre_16F19) 
    
    

     
glmer_examine(CBre_16G10)
glmer_examine(CBre_16G11)
glmer_examine(CBre_16G11)      
```  



16G5

Model failed to converge with max|grad| = 0.0108034 (tol = 0.001, component 1)
Not so close! Got worse,

16G6
Model failed to converge with max|grad| = 0.00428272 (tol = 0.001, component 1)

Interestingly, while Office Crisis adds fairly little to the model, it does notably help convergence, and removing it is a hinderance.
After closer examination, the interaction between Days and Vehicle is less interesting than Days and Competion. There's peaks and complicated patterns in the Days and Vehicle interaction. On the other hand for the non-IDC vehicles, the interaction with urgency is interesting. 

Stiooed here

Dropping cl_Days:NoComp because of the comparatively small effect size.

Cbre16G8
Model failed to converge with max|grad| = 0.00120517 (tol = 0.001, component 1)

Cbre16G9
failure to converge in 10000 evaluationsModel failed to converge with max|grad| = 0.0175398 (tol = 0.001, component 1)

Clearly VIF problems don't go away just by switching to multilevel for the variable in question.

  CBre_16G10
  In this context OffCri doesn't add anything to the model
  
Model failed to converge with max|grad| = 0.00134054 (tol = 0.001, component 1)

Let's try dropping NoComp:Veh because it's only really interestingly significant for FSS/GWAC

16G11
It's still value added, so leaving it in,.
Model failed to converge with max|grad| = 0.00500009 (tol = 0.001, component 1)

16G12 Maybe 
