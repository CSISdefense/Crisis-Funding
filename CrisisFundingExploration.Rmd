---
title: "Crisis Funding Exploration"
author: "Greg Sanders"
date: "March 28, 2017"
output: html_document
---

```{r setup, include=FALSE}

library(plyr)
library(dplyr)
library(reshape2)
library(diigtheme1)
Path<-"K:\\2007-01 PROFESSIONAL SERVICES\\R scripts and data\\"
# Path<-"C:\\Users\\Greg Sanders\\SkyDrive\\Documents\\R Scripts and Data SkyDrive\\"
source(paste(Path,"lookups.r",sep=""))
source(paste(Path,"helper.r",sep=""))

diigtheme1:::diiggraph()

```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r Import}
# read in data    
ZipFile<-unz(file.path("Data","budget_SP_LocationVendorCrisisFundingHistoryBucketCustomer.zip"),
             "budget_SP_LocationVendorCrisisFundingHistoryBucketCustomer.csv")
FullData <- read.csv(ZipFile,
                     na.strings="NULL")
rm(ZipFile)

FullData<-apply_lookups(Path,FullData)
FullData<-subset(FullData, year(Fiscal.Year)>=2000)


```

## Including Plots

You can also embed plots, for example:

```{r NIA, echo=FALSE}




NIAdata<-ddply(FullData,.(Fiscal.Year,
                 ContractingCustomer,
                 nationalinterestactioncodeText,
                 NIAcrisisFunding,
                 CrisisFunding
                 ),
               plyr::summarise,
               Obligation.2015=sum(Obligation.2015))

NIAcrisisData<-subset(NIAdata,!is.na(NIAcrisisFunding))

ggplot(ddply(NIAcrisisData,.(Fiscal.Year,
                 ContractingCustomer,
                 NIAcrisisFunding
                 ),
               plyr::summarise,
               Obligation.2015=sum(Obligation.2015)),
       aes(y=Obligation.2015,
            x=Fiscal.Year,
            color=ContractingCustomer,
           group=ContractingCustomer))+geom_line()+facet_wrap( ~ NIAcrisisFunding)


ggplot(ddply(NIAcrisisData,.(Fiscal.Year,
                 ContractingCustomer,
                 nationalinterestactioncodeText
                 ),
               plyr::summarise,
               Obligation.2015=sum(Obligation.2015)),
       aes(y=Obligation.2015,
            x=Fiscal.Year,
            color=ContractingCustomer,
           group=ContractingCustomer))+geom_line()+facet_wrap( ~ nationalinterestactioncodeText)


write.csv(ddply(NIAcrisisData,.(
                 NIAcrisisFunding,
                 nationalinterestactioncodeText
                 ),
               plyr::summarise,
               Obligation.2015=sum(Obligation.2015),
               MinOfFiscalYear=min(Fiscal.Year),
               MaxOfFiscalYear=max(Fiscal.Year))
          ,file.path("Output","nationalinterestactioncodeSummary.csv"))


write.csv(dcast(ddply(FullData,.(
                PlaceCountryText,
                 nationalinterestactioncodeText
                 ),
               plyr::summarise,
               Obligation.2015=sum(Obligation.2015),
               MinOfFiscalYear=min(Fiscal.Year),
               MaxOfFiscalYear=max(Fiscal.Year))
            ,"PlaceCountryText ~ nationalinterestactioncodeText"
            ,value.var="Obligation.2015")
          ,file.path("Output","nationalinterestactioncodeCountry.csv"))
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
