---
title: "Contract Termination"
author: "Greg Sanders"
date: "Wednesday, February 8, 2117"
output:
  html_document:
    keep_md: yes
--- 

Modeling Likelihood of Contract Termination or Ceiling Breach
============================================================================

#Setup
```{r Libraries, echo = FALSE}
library(csis360)
library(ggplot2)
library(arm)
library(R2WinBUGS)
library(dplyr)
library(Hmisc)
library(reshape2)
source("https://raw.githubusercontent.com/CSISdefense/Vendor/master/DIIGstat.r")

axis.text.size<-10
strip.text.size<-10
legend.text.size<-8
# table.text.size<-5.75
title.text.size<-12
geom.text.size<-12

main.text.size<-1
note.text.size<-1.40


```



##Prepare Data
First we load the data. The dataset used is a U.S. Defense Contracting dataset derived from   FPDS.


```{r ReadInData, echo = TRUE}
# load(file="Data/Federal_contract_CSIScontractID_detail.Rdata")
load(file="Data/fed_transformed.Rdata")
fed$Intl <- factor(fed$Intl, c("Just U.S.", "Any International"))
save(fed,file="Data/fed_transformed.Rdata")
# head(fed)
# debug(transform_contract)
# fed<-transform_contract(fed)

# save(fed,file="Data/fed_transformed.Rdata")

```

Contracts are classified using a mix of numerical and categorical variables. While the changes in numerical variables are easy to grasp and summarize, a contract may have one line item that is competed and another that is not. As is detailed in the exploration on R&D, we are only considering information available prior to contract start. The percentage of contract obligations that were competed is a valuable benchmark, but is highly influenced by factors that occured after contract start..

### Contract Terminations

Contract terminations and the number of change orders can be calculated for the entire sample.  Contract termination is determined using the *Reason for Modification* field in FPDS.  A contract is considered to be terminated if it has at least one modification with the following values:

* "Terminate for Default (complete or partial)"
* "Terminate for Convenience (complete or partial)"
* "Terminate for Cause"
* "Legal Contract Cancellation"

These four catetegories and the "Close Out" category are used to mark a contract as closed.  Many contracts in FPDS and in the sample are never marked closed.  


* b_CBre is a binary variable that has a value of 1 for any contracts that have experienced a partial or complete termination, 0 otherwise. ('r summary(fed$b_CBre)
NA_stats(fed,"b_CBre")')     "the original variable is CBre(None/Ceiling Breach"

```{r grouped barplot for variable: b_CBre}
#the original variable for b_CBre is CBre(None/Ceiling Breach)

statsummary_discrete("CBre", fed)
grouped_barplot("CBre", fed)

```

* b_Comp is a binary variable based on competition. It has a value of 0 for uncompeted contracts and a value of 1 for competition, regardless of number of offers. 'r  summary(fed$b_Comp);         "the original variable is Comp(No Comp./Comp.)"
NA_stats(fed,"b_Comp")'

```{r grouped barplot for variable: b_Comp}
#the original variable for b_CBre is Comp(No Comp./Comp.)

statsummary_discrete("Comp", fed)
grouped_barplot("Comp", fed)

```

* n_Comp is a numeric variable based on competition and number of offers. It has a value of 0 for uncompeted contracts and a value of 1 for single-offer competition, and a value of 2 for multi-offer competition. 'r summary(fed$EffComp);
NA_stats(fed,"n_Comp")' "the original variable is EffComp(No Comp./1 Offer/2+ offers)"    
```{r grouped barplot for variable: n_Comp}
#the original variable for n_Comp is EffComp(No Comp./1 offer/2+ offers)

statsummary_discrete("EffComp", fed)
grouped_barplot("EffComp", fed)

```


* n_Offr is a numeric variable based on competition and with more granularity on number offers. It has a value of 0 for uncompeted contracts and a value of 1 for single-offer competition, and a value of 2 for 2-offers, 3 for 3-4 offers, and 4 for 5+ offers. 'r summary(fed$n_Offr);
NA_stats(fed,"n_Offr")' 



* b_Urg is a categorical variable.
It has a value of 0, stands for "Not Urgency", and 1 stands for "Urgency Except." 
summary(fed$Urg);
NA_stats(fed,"b_Urg")' 

```{r grouped barplot for variable: b_Urg}
#The original variable for b_Urg is Urg(Not Urgency/Urgency Except.)

statsummary_discrete("Urg", fed)
grouped_barplot("Urg", fed)

```


* cl_Offr is the natural log of the number of offers received. Uncompeted contracts are classified as having received one offer. 'r summary(fed$l_Offr)
NA_stats(fed,"l_Offr")'

```{r statistical summary table for variable cl_Offer}
#The original variable for cl_Offer is UnmodifiedNumberOfOffersReceived
 
statsummary_continuous(("UnmodifiedNumberOfOffersReceived"), fed)

```


* cl_Ceil is the natural log of the initial contract cost ceiling, in then-year dollars. 'r centered_log_description(fed$l_Ceil,"dollars")
NA_stats(fed,"l_Ceil")'

```{r statistical summary table for variable cl_Ceil}
#The original variable for cl_Ceil is UnmodifiedContractBaseAndAllOptionsValue

statsummary_continuous(("UnmodifiedContractBaseAndAllOptionsValue"), fed)

```


* cl_Days is the natural log of the initial maximum duration of the contract, in days. The variable is centered, by subtracting its mean ('r centered_log_description(fed$l_Days,"days");
NA_stats(fed,"l_Days")' 

```{r statistical summary table for variable cl_Days}
#The original variable for cl_Days is UnmodifiedDays

statsummary_continuous(("UnmodifiedDays"), fed)

```


* SIDV, MIDV, and OIDV are dummy variables based on the contract vehicle. They correspond to Single-Award IDVs, Multi-Award IDVs, and Other IDVs, respectively, having a value of 1 when the task order has that vehicle type, and having a 0 other. The remaining types, definitive contracts and purchase orders, are intentionally left out. ('r summary(fed$SIDV);
summary(fed$MIDV);
summary(fed$FSSGWAC);
summary(fed$BPABOA);
NA_stats(fed,"Veh")'

```{r grouped bar plot for variable Veh}

statsummary_discrete("Veh", fed)
grouped_barplot("Veh", fed)

```


* n_Fixed is a numeric variable based on contract pricing. It has a value of 0 for cost-based, 0.5 or "combination or other", 1 for any fixed price (excluding fixed-price level of effort which is classified as cost-based). ('r summary(fed$n_Fixed);
NA_stats(fed,"n_Fixed")')

```{r grouped bar plot for variable n_Fixed}
#The original variable for n_Fixed is FxCb

statsummary_discrete("FxCb", fed)
grouped_barplot("FxCb", fed)

```


* n_Incent is a numeric variable based on fee type. Ig has a value. 1 for incentive fee or cost sharing, 0.5 or "combination or other", 0 for all remaining types. ('r summary(fed$n_Incent);
NA_stats(fed,"n_Incent")')

```{r grouped barplot for variable n_Incent}
#The original variable for n_Incent is Fee

statsummary_discrete("Fee", fed)
grouped_barplot("Fee", fed)

```


* b_UCA is a binary variable with a value of 1 for contracts/task orders that begin as letter contracts or undefinitized contract awards (UCA) and a value of 0 otherwise. 'r
summary(fed$b_UCA);
NA_stats(fed,"b_UCA")'

```{r grouped bar plot for variable b_UCA}
#The original variable for b_UCA is UCA

statsummary_discrete("UCA", fed)
grouped_barplot("UCA", fed)

```


* b_Intl is a binary variable with a value of 1 for contracts/task orders with any transactions performed internationally and a value of 0 otherwise. 'r
summary(fed$b_Intl);
NA_stats(fed,"b_Intl")'


```{r grouped bar plot for variable b_Intl}
#The original variable for b_Intl is Intl

statsummary_discrete("Intl", fed)
grouped_barplot("Intl", fed)

```



In addition, l_Ceil and l_Days are rescaled to have an average value of 0 and a standard deviation of one. This standardizes interpretation and prevents a "very large eigen value" error later when l_Ceil:lDay is introduced.

```{r grouped bar plot for variable Agency, NAICS, ProdServ}

#############################################
#Group bar plot for discrete variable: Agency
#############################################

Agency_Freq <- freq_table("Agency", fed)
#Add detail description to unique Agency code
Agency_Lookup <- read.csv("https://raw.githubusercontent.com/CSISdefense/Lookup-Tables/master/Agency_AgencyID.csv")
Agency_Lookup <- Agency_Lookup[,1:2]
colnames(Agency_Lookup) <- c("Agency","Description")
Agency_Freq <- left_join(Agency_Freq, Agency_Lookup, by = "Agency")
Agency_Freq$Description <- as.character(Agency_Freq$Description)

#Get the top 10 most frequently appeared Agencies
Agency_Freq <- Agency_Freq[order(-Agency_Freq$Percent_Freq),]
Agency_Freq <- Agency_Freq[1:10,]
Agency_Freq$Description <- paste(Agency_Freq$Agency, " - ", Agency_Freq$Description)
Agency_Freq <- Agency_Freq[order(-Agency_Freq$Percent_Obli),]

#Add a row representing all other Agency categories
percent_freq_rest <- 100 - sum(Agency_Freq$Percent_Freq, na.rm = TRUE)
percent_obli_rest <- 100 - sum(Agency_Freq$Percent_Obli, na.rm = TRUE)
Agency_Freq[11,] <- c("All Other", "NA", percent_freq_rest, percent_obli_rest, "All Other")
Agency_Freq[,c(3,4)] <- lapply(Agency_Freq[,c(3,4)], function(x) as.numeric(x))
Agency_Freq$Description <- factor(Agency_Freq$Description, levels = rev(Agency_Freq$Description))

#Reshape the dataframe to long format for plot
Agency_Freq <- melt(Agency_Freq, id = c("Agency", "Count_Freq", "Description"))

#Generate the plot and add title manually
part_grouped_barplot("Agency",Agency_Freq) + 
  ggtitle("Top 10 of the most frequently appeared Agency")





############################################
#Group bar plot for discrete variable: NAICS
############################################

NAICS_Freq <- freq_table("NAICS", fed)   #need long time to run

#Add detail description to unique Agency code
NAICS_Lookup <- read.csv(file = "https://raw.githubusercontent.com/CSISdefense/Vendor/master/Lookup/Lookup_NAICS_code.csv")
colnames(NAICS_Lookup) <- c("NAICS", "Description")
NAICS_Freq <- left_join(NAICS_Freq, NAICS_Lookup, by = "NAICS")
NAICS_Freq$Description <- as.character(NAICS_Freq$Description)
NAICS_Freq$Description <- paste(NAICS_Freq$NAICS, " - ", NAICS_Freq$Description)

#Get the top 19 most frequently appeared NAICS
NAICS_Freq_top10Freq <- NAICS_Freq[order(-NAICS_Freq$Percent_Freq),]
NAICS_Freq_top10Freq <- NAICS_Freq_top10Freq[2:11, ]   #THE first records has NA ID nor description
NAICS_Freq_top10Obli <- NAICS_Freq[order(-NAICS_Freq$Percent_Obli),]
NAICS_Freq_top10Obli <- NAICS_Freq_top10Obli[1:10, ]
NAICS_Freq_TOP <- rbind(NAICS_Freq_top10Obli, NAICS_Freq_top10Freq)
NAICS_Freq_TOP <- unique(NAICS_Freq_TOP)  #19 records in total
NAICS_Freq_TOP <- NAICS_Freq_TOP[order(-NAICS_Freq_TOP$Percent_Obli),]
NAICS_Freq_TOP$Description <- factor(NAICS_Freq_TOP$Description, rev(NAICS_Freq_TOP$Description))

#Reshape the dataframe to long format for plot
NAICS_Freq_TOP <- melt(NAICS_Freq_TOP, id = c("NAICS", "Count_Freq", "Description"))

#Generate the plot and add title manually
part_grouped_barplot("NAICS", NAICS_Freq_TOP) + 
  ggtitle("Top 19 of the most frequently appeared NAICS")




###############################################
#Group bar plot for discrete variable: ProdServ
###############################################

ProdServ_Freq <- freq_table("ProdServ", fed)   #need long time to run

#Add detail description to unique Agency code
ProdServ_Lookup <- read.csv("https://raw.githubusercontent.com/CSISdefense/Lookup-Tables/master/ProductOrServiceCodes.csv")
ProdServ_Lookup <- ProdServ_Lookup[, 1:2]
colnames(ProdServ_Lookup) <- c("ProdServ", "Description")
ProdServ_Freq <- left_join(ProdServ_Freq, ProdServ_Lookup, by = "ProdServ")
ProdServ_Freq$Description <- as.character(ProdServ_Freq$Description)
ProdServ_Freq$Description <- paste(ProdServ_Freq$ProdServ, " - ", ProdServ_Freq$Description)

#Get the top 19 most frequently appeared ProdServ
ProdServ_Freq_top10Freq <- ProdServ_Freq[order(-ProdServ_Freq$Percent_Freq), ]
ProdServ_Freq_top10Freq <- ProdServ_Freq_top10Freq[1:10, ]
ProdServ_Freq_top10Obli <- ProdServ_Freq[order(-ProdServ_Freq$Percent_Obli), ]
ProdServ_Freq_top10Obli <- ProdServ_Freq_top10Obli[1:10, ]
ProdServ_Freq_TOP <- rbind(ProdServ_Freq_top10Obli, ProdServ_Freq_top10Freq)
ProdServ_Freq_TOP <- unique(ProdServ_Freq_TOP)
ProdServ_Freq_TOP <- ProdServ_Freq_TOP[order(-ProdServ_Freq_TOP$Percent_Obli), ]
ProdServ_Freq_TOP$Description <- factor(ProdServ_Freq_TOP$Description, rev(ProdServ_Freq_TOP$Description))

#Reshape the dataframe to long format for plot
ProdServ_Freq_TOP <- melt(ProdServ_Freq_TOP, id = c("ProdServ", "Count_Freq", "Description"))

#Generate the plot and add title manually
part_grouped_barplot("ProdServ", ProdServ_Freq_TOP) + 
  ggtitle("Top 19 of the most frequently appeared ProdServ")





#############################################
#Group bar plot for discrete variable: Office
#############################################

#Add detail description to unique Agency code
Office_Lookup <- read.delim("https://raw.githubusercontent.com/CSISdefense/Lookup-Tables/master/office/Office.ContractingOfficeCode.txt")
fed_dup <- fed
Total_Obli <- sum(fed_dup$Action.Obligation, na.rm = TRUE)
memory.limit(56000)
Office_Lookup <- subset(Office_Lookup, select = c("AgencyID", "ContractingOfficeCode", "ContractingOfficeName"))
fed_dup <- left_join(fed_dup, Office_Lookup, by = c("Agency" = "AgencyID", "Office" = "ContractingOfficeCode"))
fed_dup <- subset(fed_dup, select = c("Office", "ContractingOfficeName"))
Office_Freq <- fed_dup %>% group_by(Office, ContractingOfficeName) %>% summarise(n())
colnames(Office_Freq) <- c("Office", "Description", "Count_Freq")
Office_Freq$Percent_Freq <- round(Office_Freq$Count_Freq/sum(Office_Freq$Count_Freq),4)*100

#Add percent Obligation information into dataframe
Percent_Obli <- c()
for (i in Office_Freq$Office) {
  Percent_Obligation <- round(sum(fed$Action.Obligation[fed$Office == i], na.rm = TRUE)/Total_Obli,5)
  Percent_Obli <- c(Percent_Obli, Percent_Obligation)
  print(i)
}
Office_Freq$Percent_Obli <- Percent_Obli * 100
#Office_Freq_dup <- Office_Freq

#Get Top 20 most frequently appeared Office
Office_Freq_top10Freq <- Office_Freq[order(-Office_Freq$Percent_Freq),]
Office_Freq_top10Freq <- Office_Freq_top10Freq[1:10, ]  #including NULL category
Office_Freq_top10Obli <- Office_Freq[order(-Office_Freq$Percent_Obli),]
Office_Freq_top10Obli <- Office_Freq_top10Obli[1:10, ]  #including NULL category
Office_Freq_TOP <- rbind(Office_Freq_top10Obli, Office_Freq_top10Freq)
Office_Freq_TOP <- unique(Office_Freq_TOP)  #20 records in total
Office_Freq_TOP$Description[is.na(Office_Freq_TOP$Description)] <- "NULL"
Office_Freq_TOP$Description <- paste(Office_Freq_TOP$Office, " - ", Office_Freq_TOP$Description)
Office_Freq_TOP$Description <- factor(Office_Freq_TOP$Description, levels = rev(Office_Freq_TOP$Description))

#reshape the dataframe into long format for plot
Office_Freq_TOP <- melt(Office_Freq_TOP, id = c("Office", "Description", "Count_Freq"))

#Generate the plot and add title manually
part_grouped_barplot("Office", Office_Freq_TOP) + 
  ggtitle("Top 20 of the most frequently appeared Office")




#######################################################
#Group bar plot for discrete variable: PlaceCountryISO3
#######################################################

Place_Freq <- freq_table("PlaceCountryISO3", fed)
Place_Freq <- Place_Freq[order(-Place_Freq$Percent_Obli),]
Place_Freq <- Place_Freq[1:10, ]

#Add a row representing all other PlaceCountry categories
percent_freq_rest <- 100 - sum(Place_Freq$Percent_Freq, na.rm = TRUE)
percent_obli_rest <- 100 - sum(Place_Freq$Percent_Obli, na.rm = TRUE)
Place_Freq$PlaceCountryISO3 <- as.character(Place_Freq$PlaceCountryISO3)
Place_Freq[11,] <- c("All other", "NA", percent_freq_rest, percent_obli_rest)
Place_Freq[, c(3,4)] <- lapply(Place_Freq[, c(3,4)], function(x) as.numeric(x))
Place_Freq$PlaceCountryISO3 <- factor(Place_Freq$PlaceCountryISO3, levels = rev(Place_Freq$PlaceCountryISO3))

#Reshape the dataframe to long format for plot
Place_Freq <- melt(Place_Freq, id <- c("PlaceCountryISO3", "Count_Freq"))

#Generate the plot and add title manually
part_barplot <- ggplot(data = Place_Freq, 
                       aes(x = PlaceCountryISO3, 
                           y = value, 
                           fill=factor(variable))) + 
                geom_bar(stat = "identity", 
                         position= "dodge", 
                         width = 0.8) + 
                xlab("") + 
                ylab("") + 
                coord_flip() + 
                theme_grey() +
                scale_fill_grey(labels = c("% of records", "% of obligation"),
                                guide = guide_legend(reverse = TRUE)) +
                theme(legend.title = element_blank(),
                      legend.position = "bottom",
                      legend.margin = margin(t=-0.8, r=0, b=0.5, l=0, unit = "cm"),
                      legend.text = element_text(margin = margin(r=0.5, unit = "cm")),
                      plot.margin = margin(t=0.3, r=0.5, b=0, l=0.5, unit = "cm")) +
                ggtitle("Top 10 of the most frequently appeared PlaceCountry")
part_barplot 
```






Next, we eliminate missing data entries and then draw a sample. The final computation uses all of the data, but as a computation shortcut, only a subset of the data is needed to allow for processing of models in minutes rather than hours.

## Sample Creation
```{r Sample}
load("Data\\crisis_smp.Rdata")


# debug(get_complete_list)
fed<-sample_prep(fed)
fed_complete<-get_complete_list(fed)


#Percent of records incomplete
nrow(fed[!fed_complete,])/nrow(fed)
#Percent of dollars incomplete
sum(fed[!fed_complete,]$Action.Obligation,na.rm=TRUE)/
  sum(fed$Action.Obligation,na.rm=TRUE)



undebug(get_crisis_sample_with_na)
crisis_with_na<-get_crisis_sample_with_na(fed)
crisis_smp<-crisis_with_na[get_complete_list(crisis_with_na),]


large_crisis_with_na<-update_sample_col_CSIScontractID(sample=large_crisis_with_na,full=fed_full,
                                 col=c("PlaceCountryISO3","VendorCountryISO3","OriginCountryISO3"))
crisis_with_na<-update_sample_col_CSIScontractID(sample=crisis_with_na,full=fed_full,
                                 col=c("PlaceCountryISO3","VendorCountryISO3","OriginCountryISO3"))


#Percent of records incomplete
nrow(crisis_with_na[!get_complete_list(crisis_with_na),])/
  nrow(crisis_with_na)
#Percent of dollars incomplete
sum(crisis_with_na[!get_complete_list(crisis_with_na),]$Action.Obligation,na.rm=TRUE)/
  sum(crisis_with_na$Action.Obligation,na.rm=TRUE)



large_crisis_with_na<-get_crisis_sample_with_na(fed,large=TRUE)
nrow(large_crisis_with_na[!get_complete_list(large_crisis_with_na),])/
  nrow(large_crisis_with_na)
#Percent of dollars incomplete
sum(large_crisis_with_na[!get_complete_list(large_crisis_with_na),]$Action.Obligation,na.rm=TRUE)/
  sum(large_crisis_with_na$Action.Obligation,na.rm=TRUE)
large_crisis_smp<-large_crisis_with_na[get_complete_list(large_crisis_with_na),]


# 
# 
# 
# summary(crisis_with_na$Crisis)
# 
# 
# 
# #
# #8811392  to 8811392
# # 
# crisis_smp<-crisis_with_na[complete,]
# # # 
# # head(crisis_smp)

  crisis_smp<-sample_prep(crisis_smp)
  large_crisis_smp<-sample_prep(large_crisis_smp)
save(crisis_smp,crisis_with_na,
     large_crisis_with_na,large_crisis_smp,file="Data\\crisis_smp.Rdata")

summary(factor(large_crisis_smp$PlaceCountryISO3))
large_crisis_smp$origin_isforeign[large_crisis_smp$OriginCountryISO3=="*MF"]<-1
large_crisis_smp$place_isforeign[large_crisis_smp$PlaceCountryISO3=="*MF"]<-1
large_crisis_smp$vendor_isforeign[large_crisis_smp$VendorCountryISO3=="*MF"]<-1
crisis_smp$origin_isforeign[crisis_smp$OriginCountryISO3=="*MF"]<-1
crisis_smp$place_isforeign[crisis_smp$PlaceCountryISO3=="*MF"]<-1
crisis_smp$vendor_isforeign[crisis_smp$VendorCountryISO3=="*MF"]<-1



#
# large_crisis_smp$OffPl99<-Hmisc::cut2(large_crisis_smp$OffIntl,c(0.01,0.50))
# summary(large_crisis_smp$OffPl99)
#   levels(large_crisis_smp$OffPl99) <-
#     list("US99"=c("[0.00,0.01)"),
#          "Mixed"=c("[0.01,0.50)"),
#          "Intl"=c("[0.50,1.00]"))
#   large_crisis_smp$Reach<-factor(paste(large_crisis_smp$OffPl99,large_crisis_smp$Intl,sep="-"))
#
#
#      levels(crisis_smp$Reach) <-
#     list( "US50-Dom"=c("US99-Just U.S.","Mixed-Just U.S."),
#          "Mixed-Dom"=c(),
#          "Intl-Dom"=c("Intl-Just U.S."),
#          "US50-Intl"=c("Mixed-Any International","US99-Any International"),
#          "Intl-Intl"=c("Intl-Any International"))
#
# large_crisis_smp$PSA<-as.character(large_crisis_smp$ProductOrServiceArea)
# large_crisis_smp$PSA<-gsub(" & ","+",large_crisis_smp$PSA)
# load("Data\\large_crisis_smp.Rdata")
# save(large_crisis_smp,large_crisis_with_na,file="Data\\large_crisis_smp.Rdata")
# save(fed,file="Data\\transformed_fed.Rdata")
# load(file="Data\\transformed_fed.Rdata")

# extra_large_crisis_with_na<-fed[fed$Crisis %in% c("ARRA","Dis","OCO"),]
# other_intl<-fed[fed$Crisis %in% c("Other")&fed$OffIntl>=0.5,]
# other_dom<-fed[fed$Crisis %in% c("Other")&(fed$OffIntl<0.5
#                                            |is.na(fed$OffIntl)),]
# other_dom<-other_dom[sample(nrow(other_dom),1000000),]
# extra_large_crisis_with_na<-rbind(extra_large_crisis_with_na,other_dom,other_intl)
# rm(other_dom,other_intl)
# 
# extra_large_crisis_with_na<-(extra_large_crisis_with_na)
# extra_large_complete<-get_complete_list(extra_large_crisis_with_na)
# extra_large_crisis_smp<-extra_large_crisis_with_na[extra_large_complete,]
# # # summary(large_crisis_with_na$Crisis)
# # #
# #
# extra_large_crisis_smp$OffPl99<-Hmisc::cut2(extra_large_crisis_smp$OffIntl,c(0.01,0.50))
# summary(extra_large_crisis_smp$OffPl99)
#   levels(extra_large_crisis_smp$OffPl99) <-
#     list("US99"=c("[0.00,0.01)"),
#          "Mixed"=c("[0.01,0.50)"),
#          "Intl"=c("[0.50,1.00]"))
#   extra_large_crisis_smp$Reach<-factor(paste(extra_large_crisis_smp$OffPl99,extra_large_crisis_smp$Intl,sep="-"))
# 
# 
#      levels(extra_large_crisis_smp$Reach) <-
#     list( "US50-Dom"=c("US99-Just U.S.","Mixed-Just U.S."),
#          "Mixed-Dom"=c(),
#          "Intl-Dom"=c("Intl-Just U.S."),
#          "US50-Intl"=c("Mixed-Any International","US99-Any International"),
#          "Intl-Intl"=c("Intl-Any International"))
# 
# save(extra_large_crisis_smp,extra_large_crisis_with_na,file="Data\\extra_large_crisis_smp.Rdata")
load("Data\\extra_large_crisis_smp.Rdata")

```

