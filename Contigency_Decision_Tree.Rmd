---
title: "Crisis Funding Exploration"
author: "Greg Sanders"
date: "March 28, 2017"
output:
  html_document: 
  keep_md: yes
pdf_document: default
---
  
#Setup
```{r setup, include=FALSE}

library(plyr)
library(dplyr)
library(reshape2)
library(Hmisc)
library(csis360)
library(scales)

Path<-"K:\\2007-01 PROFESSIONAL SERVICES\\R scripts and data\\"
# Path<-"C:\\Users\\Greg Sanders\\SkyDrive\\Documents\\R Scripts and Data SkyDrive\\"
# Path<-"C:\\Users\\gsand_000.ALPHONSE\\Documents\\Development\\R-scripts-and-data\\"
source(paste(Path,"lookups.r",sep=""))
source(paste(Path,"helper.r",sep="")) 

# diigtheme1:::diiggraph()

Coloration<-read.csv(
  paste(Path,"Lookups\\","lookup_coloration.csv",sep=""),
  header=TRUE, sep=",", na.strings="", dec=".", strip.white=TRUE, 
  stringsAsFactors=FALSE
)

Coloration<-ddply(Coloration
                  , c(.(R), .(G), .(B))
                  , transform
                  , ColorRGB=as.character(
                    if(min(is.na(c(R,G,B)))) {NA} 
                    else {rgb(max(R),max(G),max(B),max=255)}
                  )
)


axis.text.size<-12
strip.text.size<-12
legend.text.size<-8
# table.text.size<-5.75
title.text.size<-12
geom.text.size<-12

main.text.size<-2
note.text.size<-1.40


load(
     file="Defense_budget_SP_LocationVendorCrisisFundingHistoryBucketCustomerDetail.Rdata")

```

#Decision Tree
#Step 1: Direct Crisis Labels 
##Step 1A: Is this an ARRA labled contract (or a CSIS labeled one)
```{r Step1A}
full_data<-replace_nas_with_unlabeled(full_data,"ContractCrisisFunding")
full_data<-replace_nas_with_unlabeled(full_data,"Is.Defense")
defense_data<-replace_nas_with_unlabeled(defense_data,"ContractCrisisFunding")


full_data$CrisisFunding<-"Unlabeled"
full_data$CrisisFunding<-ordered(full_data$CrisisFunding,levels=c("OCO","Disaster","ARRA","Unlabeled"))
full_data$CrisisFunding[full_data$CrisisFunding=="Unlabeled"]<-
  full_data$ContractCrisisFunding[full_data$CrisisFunding=="Unlabeled"]


Tree1A<-LatticePlotWrapper(
  VAR.color.legend.label="ARRA/CSIS Labeled Contract",
  VAR.main.label="",
  VAR.X.label="Fiscal Year",
  VAR.Y.label="Constant ($ Billions)",
  VAR.Coloration=Coloration,
  VAR.long.DF=full_data,
  # NA, #VAR.ncol
  VAR.x.variable="Fiscal.Year", #VAR.x.variable
  VAR.y.variable="Obligation.2016", #VAR.y.variable
  VAR.y.series="CrisisFunding", #VAR.y.series
  VAR.facet.primary= "ContractCrisisFunding", #VAR.facet.primary
  VAR.facet.secondary="Is.Defense", # VAR.facet.secondary=NA
  # ,MovingAverage=0
  # ,MovingSides=1
  DataLabels=FALSE
  #                       ,VAR.override.coloration=NA
)+facet_grid(primary ~ secondary
              , scales="free_y" #The scales actually do stay fixed
              , space="fixed")

Tree1A

ggsave("Output//Tree1A.png", Tree1A, width=6.5, height= 3, units="in",dpi=300)
```

##Step 1B: Contingency or Humanitarian Peacekeeping Operation
```{r Step1B}
full_data<-replace_nas_with_unlabeled(full_data,"ContractCrisisFunding")
full_data<-replace_nas_with_unlabeled(full_data,"Theater")
full_data<-replace_nas_with_unlabeled(full_data,"contingencyhumanitarianpeacekeepingoperationText")
full_data$contingencyhumanitarianpeacekeepingoperationText[
  full_data$contingencyhumanitarianpeacekeepingoperationText=="Not Applicable"]<-"Unlabeled"


defense_data<-replace_nas_with_unlabeled(defense_data,"Theater")

# ConHumIsOCOcrisisFunding=1
# ,[ContingencyHumanitarianPeacekeepingOperation]

Tree1B<-LatticePercentLineWrapper(
  VAR.color.legend.label="Classification As of Prior Step",
  VAR.main.label="",
  VAR.X.label="Fiscal Year",
  VAR.Y.label="Percent of Obligations",
  VAR.Coloration=Coloration,
  VAR.long.DF=subset(full_data,Theater!="Unlabeled"),
  # NA, #VAR.ncol
  VAR.x.variable="Fiscal.Year", #VAR.x.variable
  VAR.y.variable="Obligation.2016", #VAR.y.variable
  VAR.y.series="contingencyhumanitarianpeacekeepingoperationText", #VAR.y.series
  VAR.facet.primary= "Theater", #VAR.facet.primary
  # VAR.facet.secondary="contingencyhumanitarianpeacekeepingoperationText", # VAR.facet.secondary=NA
  # ,MovingAverage=0
  # ,MovingSides=1
  DataLabels=FALSE
  #                       ,VAR.override.coloration=NA
)
# +facet_grid(primary ~ secondary
#               , scales="free_y" #The scales actually do stay fixed
#               , space="fixed")


Contradictions1B<-LatticePlotWrapper(
  VAR.color.legend.label="Classification As of Prior Step",
  VAR.main.label="",
  VAR.X.label="Fiscal Year",
  VAR.Y.label="Constant ($ Billions)",
  VAR.Coloration=Coloration,
  VAR.long.DF=subset(full_data,Theater!="Unlabeled"),
  # NA, #VAR.ncol
  VAR.x.variable="Fiscal.Year", #VAR.x.variable
  VAR.y.variable="Obligation.2016", #VAR.y.variable
  VAR.y.series="CrisisFunding", #VAR.y.series
  VAR.facet.primary="contingencyhumanitarianpeacekeepingoperationText", #VAR.facet.primary
  VAR.facet.secondary= "Theater", # VAR.facet.secondary=NA
  # ,MovingAverage=0
  # ,MovingSides=1
  DataLabels=FALSE
  #                       ,VAR.override.coloration=NA
)+facet_grid(primary ~ secondary
              , scales="free_y" #The scales actually do stay fixed
              , space="fixed")


Tree1B
Contradictions1B

ggsave("Output//Tree1B.png", Tree1B, width=6.5, height= 4.5, units="in",dpi=300)

full_data$CrisisFunding[full_data$CrisisFunding=="Unlabeled" & full_data$ConHumIsOCOcrisisFunding==1]<-"OCO"

```



##Step 1C: National Action Interest Code
```{r Step1C}
full_data<-replace_nas_with_unlabeled(full_data,"NIAcrisisFunding")
defense_data<-replace_nas_with_unlabeled(defense_data,"NIAcrisisFunding")
full_data<-replace_nas_with_unlabeled(full_data,"NIAcrisisFunding")

#       ,[nationalinterestactioncode]

Tree1Coco<-LatticePlotWrapper(
  VAR.color.legend.label="Contigency or Humanitarian Peacekeeping Operation",
  VAR.main.label="",
  VAR.X.label="Fiscal Year",
  VAR.Y.label="Constant ($ Billions)",
  VAR.Coloration=Coloration,
  VAR.long.DF=subset(full_data,NAICcrisisFunding=="OCO" | (CrisisFunding=="OCO" & nationalinterestactioncodeText=="None")),
  # NA, #VAR.ncol
  VAR.x.variable="Fiscal.Year", #VAR.x.variable
  VAR.y.variable="Obligation.2016", #VAR.y.variable
  VAR.y.series="CrisisFunding", #VAR.y.series
  VAR.facet.primary= "nationalinterestactioncodeText", #VAR.facet.primary
  # VAR.facet.secondary="Theater", # VAR.facet.secondary=NA
  # ,MovingAverage=0
  # ,MovingSides=1
  DataLabels=FALSE
  #                       ,VAR.override.coloration=NA
)+facet_wrap(~primary,ncol=3)
# +facet_grid(primary ~ secondary
#               , scales="free_y" #The scales actually do stay fixed
#               , space="fixed")

 
    undebug(prepare_labels_and_colors)
      labels.x.DF<-prepare_labels_and_colors(full_data,"nationalinterestactioncodeText")
      full_data$nationalinterestactioncodeText<-factor(full_data$nationalinterestactioncodeText,
        levels=c(labels.x.DF$variable),
        labels=c(labels.x.DF$Label),
        ordered=TRUE)
    

debug(LatticePlotWrapper)
Tree1C<-LatticePlotWrapper(
  VAR.color.legend.label="Contigency or Humanitarian Peacekeeping Operation",
  VAR.main.label="",
  VAR.X.label="", #"Fiscal Year",
  VAR.Y.label="Constant ($ Billions)",
  VAR.Coloration=Coloration,
  VAR.long.DF=subset(full_data,!nationalinterestactioncodeText %in% c("None","Unlabeled")|
      (CrisisFunding=="OCO" & nationalinterestactioncodeText=="None")),
  # NA, #VAR.ncol
  VAR.x.variable="nationalinterestactioncodeText", #VAR.x.variable
  VAR.y.variable="Obligation.2016", #VAR.y.variable
  VAR.y.series="CrisisFunding", #VAR.y.series
  # VAR.facet.primary= NA ,#"NAICcrisisFunding", #VAR.facet.primary
  # VAR.facet.secondary="Theater", # VAR.facet.secondary=NA
  # ,MovingAverage=0
  # ,MovingSides=1
  DataLabels=FALSE
  #                       ,VAR.override.coloration=NA
)+ theme(axis.text.x = element_text(angle = 90, hjust = 1))+
  coord_flip()
#
# +facet_grid(primary ~ secondary
#               , scales="free_y" #The scales actually do stay fixed
#               , space="fixed")

#NAICcrisisFunding
Tree1Coco
Tree1C

ggsave("Output//Tree1Coco.png", Tree1Coco, width=6.5, height= 3, units="in",dpi=300)
ggsave("Output//Tree1C.png", Tree1C, width=6.5, height= 5, units="in",dpi=300)

```


##Step 1D: Revealing Waivers to the CCR Reporting Requirement
```{r Step1D}
# CCRexception 



LatticePlotWrapper(
  VAR.color.legend.label="Contigency or Humanitarian Peacekeeping Operation",
  VAR.main.label="",
  VAR.X.label="Fiscal Year",
  VAR.Y.label="Constant ($ Billions)",
  VAR.Coloration=Coloration,
  VAR.long.DF=defense_data,
  # NA, #VAR.ncol
  VAR.x.variable="Fiscal.Year", #VAR.x.variable
  VAR.y.variable="Obligation.2016", #VAR.y.variable
  VAR.y.series="CCRexception", #VAR.y.series
  VAR.facet.primary= "CCRexception", #VAR.facet.primary
  VAR.facet.secondary="Theater", # VAR.facet.secondary=NA
  # ,MovingAverage=0
  # ,MovingSides=1
  DataLabels=FALSE
  #                       ,VAR.override.coloration=NA
)+facet_grid(primary ~ secondary
              , scales="free_y" #The scales actually do stay fixed
              , space="fixed")

```

##Step 1E: Local Area Set-Aside
```{r Step1E}
# localareasetaside



LatticePlotWrapper(
  VAR.color.legend.label="Contigency or Humanitarian Peacekeeping Operation",
  VAR.main.label="",
  VAR.X.label="Fiscal Year",
  VAR.Y.label="Constant ($ Billions)",
  VAR.Coloration=Coloration,
  VAR.long.DF=defense_data,
  # NA, #VAR.ncol
  VAR.x.variable="Fiscal.Year", #VAR.x.variable
  VAR.y.variable="Obligation.2016", #VAR.y.variable
  VAR.y.series="localareasetaside", #VAR.y.series
  VAR.facet.primary= "localareasetaside", #VAR.facet.primary
  VAR.facet.secondary="Theater", # VAR.facet.secondary=NA
  # ,MovingAverage=0
  # ,MovingSides=1
  DataLabels=FALSE
  #                       ,VAR.override.coloration=NA
)+facet_grid(primary ~ secondary
              , scales="free_y" #The scales actually do stay fixed
              , space="fixed")

```


#Trimming this away
```{r Step1}



#Is OCO Crisis Funding
LatticePlotWrapper(
  VAR.color.legend.label="IsOCOcrisisFunding",
  VAR.main.label="Labeled Theater Defense Contracts",
  VAR.X.label="Theater",
  VAR.Y.label="Constant ($ Billions)",
  VAR.Coloration=Coloration,
  VAR.long.DF=defense_data,
  # NA, #VAR.ncol
  VAR.x.variable="Fiscal.Year", #VAR.x.variable
  VAR.y.variable="Obligation.2016", #VAR.y.variable
  VAR.y.series="IsOCOcrisisFunding", #VAR.y.series
  VAR.facet.primary= "IsOCOcrisisFunding", #VAR.facet.primary
  VAR.facet.secondary="Theater", # VAR.facet.secondary=NA
  # ,MovingAverage=0
  # ,MovingSides=1
  DataLabels=FALSE
  #                       ,VAR.override.coloration=NA
)+facet_grid(primary ~ secondary
                                              # , labeller=Label_Wrap
              , scales="free_y" #The scales actually do stay fixed
              , space="fixed")

LatticePlotWrapper(
  VAR.color.legend.label="FUll Data CrisisFunding",
  VAR.main.label="Labeled Theater Defense Contracts",
  VAR.X.label="Theater",
  VAR.Y.label="Constant ($ Billions)",
  VAR.Coloration=Coloration,
  VAR.long.DF=full_data,
  # NA, #VAR.ncol
  VAR.x.variable="Fiscal.Year", #VAR.x.variable
  VAR.y.variable="Obligation.2016", #VAR.y.variable
  VAR.y.series="CrisisFunding", #VAR.y.series
  VAR.facet.primary= "CrisisFunding", #VAR.facet.primary
  VAR.facet.secondary="Theater", # VAR.facet.secondary=NA
  # ,MovingAverage=0
  # ,MovingSides=1
  DataLabels=FALSE
  #                       ,VAR.override.coloration=NA
)+facet_grid(primary ~ secondary
                                              # , labeller=Label_Wrap
              , scales="free_y" #The scales actually do stay fixed
              , space="fixed")


#Just NIAcrisisFunding
LatticePlotWrapper(
  VAR.color.legend.label="NIAcrisisFunding",
  VAR.main.label="Labeled Theater Defense Contracts",
  VAR.X.label="Theater",
  VAR.Y.label="Constant ($ Billions)",
  VAR.Coloration=Coloration,
  VAR.long.DF=full_data,
  # NA, #VAR.ncol
  VAR.x.variable="Fiscal.Year", #VAR.x.variable
  VAR.y.variable="Obligation.2016", #VAR.y.variable
  VAR.y.series="NIAcrisisFunding", #VAR.y.series
  VAR.facet.primary= "NIAcrisisFunding", #VAR.facet.primary
  VAR.facet.secondary="Theater", # VAR.facet.secondary=NA
  # ,MovingAverage=0
  # ,MovingSides=1
  DataLabels=FALSE
  #                       ,VAR.override.coloration=NA
)+facet_grid(primary ~ secondary
                                              # , labeller=Label_Wrap
              , scales="free_y" #The scales actually do stay fixed
              , space="fixed")



#Just NIAcrisisFunding
LatticePlotWrapper(
  VAR.color.legend.label="NIAcrisisFunding",
  VAR.main.label="Labeled Theater Defense Contracts",
  VAR.X.label="Theater",
  VAR.Y.label="Constant ($ Billions)",
  VAR.Coloration=Coloration,
  VAR.long.DF=full_data,
  # NA, #VAR.ncol
  VAR.x.variable="Fiscal.Year", #VAR.x.variable
  VAR.y.variable="Obligation.2016", #VAR.y.variable
  VAR.y.series="NIAcrisisFunding", #VAR.y.series
  VAR.facet.primary= "NIAcrisisFunding", #VAR.facet.primary
  VAR.facet.secondary="Theater", # VAR.facet.secondary=NA
  # ,MovingAverage=0
  # ,MovingSides=1
  DataLabels=FALSE
  #                       ,VAR.override.coloration=NA
)+facet_grid(primary ~ secondary
                                              # , labeller=Label_Wrap
              , scales="free_y" #The scales actually do stay fixed
              , space="fixed")



#Just CrisisFunding
LatticePlotWrapper(
  VAR.color.legend.label="OCO labeling detail",
  VAR.main.label="Labeled Theater Defense Contracts",
  VAR.X.label="Theater",
  VAR.Y.label="Constant ($ Billions)",
  VAR.Coloration=Coloration,
  VAR.long.DF=defense_data,
  # NA, #VAR.ncol
  VAR.x.variable="Fiscal.Year", #VAR.x.variable
  VAR.y.variable="Obligation.2016", #VAR.y.variable
  VAR.y.series="CrisisFunding", #VAR.y.series
  VAR.facet.primary= "CrisisFunding", #VAR.facet.primary
  VAR.facet.secondary="Theater", # VAR.facet.secondary=NA
  # ,MovingAverage=0
  # ,MovingSides=1
  DataLabels=FALSE
  #                       ,VAR.override.coloration=NA
)+facet_grid(primary ~ secondary
              , scales="free_y" #The scales actually do stay fixed
              , space="fixed")




LatticePlotWrapper(
  VAR.color.legend.label="OCO labeling detail",
  VAR.main.label="Labeled Theater Defense Contracts",
  VAR.X.label="Theater",
  VAR.Y.label="Constant ($ Billions)",
  VAR.Coloration=Coloration,
  VAR.long.DF=subset(defense_data,Theater!='Domestic'),
  # NA, #VAR.ncol
  VAR.x.variable="Fiscal.Year", #VAR.x.variable
  VAR.y.variable="Obligation.2016", #VAR.y.variable
  VAR.y.series="IsOCOcrisisFunding", #VAR.y.series
  VAR.facet.primary= "IsOCOcrisisFunding", #VAR.facet.primary
  VAR.facet.secondary="Theater", # VAR.facet.secondary=NA
  # ,MovingAverage=0
  # ,MovingSides=1
  DataLabels=FALSE
  #                       ,VAR.override.coloration=NA
)

# defense_data$ContractCrisisFunding
```

##Points
```{r Points}

Evaluation<-ddply(full_data,
                  .(
                    IsOCOcrisisFunding,
                    OCOcrisisScore,
                    Theater
                  ),
                  plyr::summarise,
                  Obligations=sum(Obligation.2015)
)


Evaluation<-ddply(Evaluation,
                  .(
                    OCOcrisisScore,
                    Theater
                  ),
                  plyr::mutate,
                  pObligations=Obligations/sum(Obligations)
)


LatticePlotWrapper(
  VAR.color.legend.label="OCO labeling detail",
  VAR.main.label="Labeled Theater Defense Contracts",
  VAR.X.label="Theater",
  VAR.Y.label="Percent of Obligations That Are Confirmed OCO",
  VAR.Coloration=Coloration,
  VAR.long.DF=subset(Evaluation,IsOCOcrisisFunding=="OCO" & !is.na(Theater)),
  # NA, #VAR.ncol
  VAR.x.variable="Theater", #VAR.x.variable
  VAR.y.variable="pObligations", #VAR.y.variable
  VAR.y.series="Theater", #VAR.y.series
  VAR.facet.primary="OCOcrisisScore" #VAR.facet.primary
  # VAR.facet.secondary= NULL # VAR.facet.secondary=NA
  # ,MovingAverage=0
  # ,MovingSides=1
  ,DataLabels=FALSE
  #                       ,VAR.override.coloration=NA
)+  facet_wrap(  ~ primary
                 , nrow=2)+
  scale_y_continuous("Percent of Obligations",
                     labels = scales::percent)+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))




Points<-ddply(full_data,
              .(
                Fiscal.Year,
                IsOCOcrisisFunding,
                OCOscoreBuckets
              ),
              plyr::summarise,
              Obligations=sum(Obligation.2015)
)


Points<-ddply(Points,
              .(
                Fiscal.Year,
                IsOCOcrisisFunding
              ),
              plyr::mutate,
              pObligations=Obligations/sum(Obligations)
)


LatticePlotWrapper(
  VAR.color.legend.label="OCO labeling detail",
  VAR.main.label="Defense Contracts",
  VAR.X.label="Fiscal Year",
  VAR.Y.label="Percent of Obligations",
  VAR.Coloration=Coloration,
  VAR.long.DF=Points,
  # NA, #VAR.ncol
  VAR.x.variable="Fiscal.Year", #VAR.x.variable
  VAR.y.variable="pObligations", #VAR.y.variable
  VAR.y.series="OCOscoreBuckets", #VAR.y.series
  VAR.facet.primary="IsOCOcrisisFunding" #VAR.facet.primary
  # VAR.facet.secondary= NULL # VAR.facet.secondary=NA
  # ,MovingAverage=0
  # ,MovingSides=1
  ,DataLabels=FALSE
  #                       ,VAR.override.coloration=NA
)+ scale_y_continuous("Percent of Obligations",
                      labels = scales::percent)+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

PointsRegion<-ddply(full_data,
                    .(
                      Fiscal.Year,
                      IsOCOcrisisFunding,
                      OCOscoreBuckets,
                      Theater
                    ),
                    plyr::summarise,
                    Obligations=sum(Obligation.2015)
)

PointsRegion<-ddply(PointsRegion,
                    .(
                      Fiscal.Year,
                      IsOCOcrisisFunding,
                      Theater
                    ),
                    plyr::mutate,
                    pObligations=Obligations/sum(Obligations)
)

PointsRegion$OCOscoreBuckets<-ordered(PointsRegion$OCOscoreBuckets)

LatticePlotWrapper(
  VAR.color.legend.label="OCO labeling detail",
  VAR.main.label="Defense Contracts",
  VAR.X.label="Fiscal Year",
  VAR.Y.label="Percent of Obligations",
  VAR.Coloration=Coloration,
  VAR.long.DF=subset(PointsRegion,!is.na(Theater)),
  # NA, #VAR.ncol
  VAR.x.variable="Fiscal.Year", #VAR.x.variable
  VAR.y.variable="pObligations", #VAR.y.variable
  VAR.y.series="OCOscoreBuckets", #VAR.y.series
  VAR.facet.primary="IsOCOcrisisFunding", #VAR.facet.primary
  VAR.facet.secondary= "Theater" # VAR.facet.secondary=NA
  # ,MovingAverage=0
  # ,MovingSides=1
  ,DataLabels=FALSE
  #                       ,VAR.override.coloration=NA
)+ scale_y_continuous("Percent of Obligations",
                      labels = scales::percent)+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))



```



##Labeling
```{r Labeling}

full_data$OCOlabelDetail<-full_data$OCOscoreBuckets
levels(full_data$OCOlabelDetail) <- 
  c(levels(full_data$OCOlabelDetail),"Confirmed OCO")
full_data$OCOlabelDetail[full_data$CrisisFunding=="OCO"]<-"Confirmed OCO"


full_data$IsCSISOCO<-"All Other"
full_data$IsCSISOCO[full_data$CrisisFunding=="OCO"|full_data$OCOcrisisScore>=6]<-"Confident OCO"







Dollars<-ddply(full_data,
               .(
                 Fiscal.Year,
                 OCOlabelDetail,
                 IsCSISOCO
               ),
               plyr::summarise,
               Obligations=sum(Obligation.2015)
)



LatticePlotWrapper(
  VAR.color.legend.label="OCO labeling detail",
  VAR.main.label="All Defense Contracts",
  VAR.X.label="Fiscal Year",
  VAR.Y.label="Obligations (2015 $ Billions)",
  VAR.Coloration=Coloration,
  VAR.long.DF=Dollars,
  # NA, #VAR.ncol
  VAR.x.variable="Fiscal.Year", #VAR.x.variable
  VAR.y.variable="Obligations", #VAR.y.variable
  VAR.y.series="OCOlabelDetail", #VAR.y.series
  VAR.facet.primary="IsCSISOCO" #VAR.facet.primary
  # VAR.facet.secondary= NULL # VAR.facet.secondary=NA
  # ,MovingAverage=0
  # ,MovingSides=1
  ,DataLabels=FALSE
  #                       ,VAR.override.coloration=NA
)+theme(legend.position="bottom")



DollarsTheater<-ddply(full_data,
                      .(
                        Fiscal.Year,
                        OCOlabelDetail,
                        IsCSISOCO,
                        Theater
                      ),
                      plyr::summarise,
                      Obligations=sum(Obligation.2015)
)


full_data[full_data$PlaceCountryText %in% c("Jordan","Turkey"),]



LatticePlotWrapper(
  VAR.color.legend.label="OCO labeling detail",
  VAR.main.label="Defense Contracts with Labeled Theater",
  VAR.X.label="Fiscal Year",
  VAR.Y.label="Obligations (2015 $ Billions)",
  VAR.Coloration=Coloration,
  VAR.long.DF=subset(DollarsTheater,!is.na(Theater)),
  # NA, #VAR.ncol
  VAR.x.variable="Fiscal.Year", #VAR.x.variable
  VAR.y.variable="Obligations", #VAR.y.variable
  VAR.y.series="OCOlabelDetail", #VAR.y.series
  VAR.facet.primary="Theater", #VAR.facet.primary
  VAR.facet.secondary="IsCSISOCO" # VAR.facet.secondary=NA
  # ,MovingAverage=0
  # ,MovingSides=1
  # ,DataLabels=NA
  #                       ,VAR.override.coloration=NA
)+theme(legend.position="right")


DollarsInternational<-ddply(full_data,
                            .(
                              Fiscal.Year,
                              OCOlabelDetail,
                              IsCSISOCO,
                              International
                            ),
                            plyr::summarise,
                            Obligations=sum(Obligation.2015)
)


full_data[full_data$PlaceCountryText %in% c("Jordan","Turkey"),]




OCOdetail<-LatticePlotWrapper(
  VAR.color.legend.label="OCO labeling detail",
  VAR.main.label="Defense Contracts with Labeled Location",
  VAR.X.label="Fiscal Year",
  VAR.Y.label="Obligations (2015 $ Billions)",
  VAR.Coloration=Coloration,
  VAR.long.DF=subset(DollarsInternational,!is.na(International)),
  # NA, #VAR.ncol
  VAR.x.variable="Fiscal.Year", #VAR.x.variable
  VAR.y.variable="Obligations", #VAR.y.variable
  VAR.y.series="OCOlabelDetail", #VAR.y.series
  VAR.facet.primary="International", #VAR.facet.primary
  VAR.facet.secondary="IsCSISOCO" # VAR.facet.secondary=NA
  # ,MovingAverage=0
  # ,MovingSides=1
  # ,DataLabels=NA
  #                       ,VAR.override.coloration=NA
)

OCOdetail+theme(legend.position="right")

```