---
title: "Contract Outcomes Trimmed"
author: "Greg Sanders"
date: "November 12, 2018"
output: html_document
---

#Dropped in later stages
These are kept for the record to show approaches that the study team later decided undercut the focus on the hypothesis or were not necessary 



##Who


### 10A: Defense and Civilian

Expectation: DoD contracts are often higher risk technologies or more direct exposure to conflict situations. Defense as a customer will positively estimate the probability of ceiling breaches and terminations.
```{r Model10A}
corrdisp<-Hmisc::rcorr(
  as.matrix(cbind(subset(large_crisis_smp, select=c(b_UCA,c_OffCri,cl_Ceil,
                                            cl_Days,n_Fixed,b_Intl)),
                       dummies::dummy(large_crisis_smp$Crisis),
                       dummies::dummy(large_crisis_smp$NoComp),
                       dummies::dummy(large_crisis_smp$Reach),
                       dummies::dummy(large_crisis_smp$Veh),
                                    dummies::dummy(large_crisis_smp$Is.Defense))))
corrdisp[[1]]
   summary_discrete_plot(large_crisis_smp,"Is.Defense")


  CBre_10A <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ c_OffCri+
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+
                     cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_10A)
  
  Term_10A <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     Reach+ c_OffCri+
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh, 
                   family=binomial(link="logit"))
  glmer_examine(Term_10A)
  

  stargazer::stargazer(CBre_09C,CBre_10A,Term_09C,Term_10A,type="text",
                       digits=2)
  
  

summary_residual_compare(CBre_09C,CBre_10A,Term_09C,Term_10A,bins=20)

```
Expectations are countered for ceiling breaches but upheld for terminations.

Defense contracts are associated with fewer ceiling breaches but more terminations. The residuals for ceiling breaches are reduced, though there's a pattern for low fitted values.


##What
### 11A: Product/Service/R&D
Expectation: R&D and, to a lesser extent, services can be harder to quantify and will be positively estimate the probability of ceiling breaches and terminations.
```{r Model11A}
corrdisp<-Hmisc::rcorr(
  as.matrix(cbind(subset(large_crisis_smp, select=c(b_UCA,c_OffCri,cl_Ceil,
                                              cl_Days,n_Fixed,b_Intl)),
                  dummies::dummy(large_crisis_smp$Crisis),
                  dummies::dummy(large_crisis_smp$NoComp),
                  dummies::dummy(large_crisis_smp$Reach),
                  dummies::dummy(large_crisis_smp$Veh),
                  dummies::dummy(large_crisis_smp$Is.Defense),
                  dummies::dummy(large_crisis_smp$Simple))))
corrdisp[[1]]


#Frequency Plot
freq_discrete_plot(large_crisis_smp,"Simple")

#Percent Terminated Plot 
discrete_percent_cbre_plot(large_crisis_smp,"Simple")

#Create the model

  CBre_11A <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ c_OffCri+  
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   Simple, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_11A)
  
  Term_11A <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     Reach+ c_OffCri+
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   Simple, 
                   family=binomial(link="logit"))
  glmer_examine(Term_11A)
  

  stargazer::stargazer(CBre_10A,CBre_11A,Term_10A,Term_11A,type="text",
                       digits=2)
  
  

summary_residual_compare(CBre_10A,CBre_11A,Term_10A,Term_11A,bins=20)


```
Expectations are upheld for ceiling breaches, although the coefficient for services is unexpectedly higher than for R&D. Expectations are not upheld for terminations, where R&D contracts are notably less likely to be cancelled and fixed price contracts


### 11B: Product or Service Area
Expectation: More complex and higher risk (i.e. fuel) product or service areas positively estimate a higher probability of terminations and ceiling breaches.

```{r Model11B}

large_crisis_smp$PSA<-as.character(large_crisis_smp$ProductOrServiceArea)
large_crisis_smp$PSA<-gsub(" & ","+",large_crisis_smp$PSA)
corrdisp<-Hmisc::rcorr(
  as.matrix(cbind(subset(large_crisis_smp, select=c(b_UCA,c_OffCri,cl_Ceil,
                                            cl_Days,n_Fixed,b_Intl)),
                       dummies::dummy(large_crisis_smp$Crisis),
                       dummies::dummy(large_crisis_smp$NoComp),
                       dummies::dummy(large_crisis_smp$Reach),
                       dummies::dummy(large_crisis_smp$Veh),
                                    dummies::dummy(large_crisis_smp$Is.Defense),
                  dummies::dummy(large_crisis_smp$PSA))))
corrdisp[[1]]


summary_discrete_plot(large_crisis_smp,"PSA",rotate_text=TRUE)
freq_discrete_plot(large_crisis_smp,"PSA",rotate_text=TRUE)
discrete_percent_plot(large_crisis_smp,"PSA",caption=FALSE,rotate_text=TRUE)

#Create the model

  CBre_11B <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ c_OffCri+  
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_11B)
  
  Term_11B <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     Reach+ c_OffCri+
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   PSA, 
                   family=binomial(link="logit"))
  glmer_examine(Term_11B)
  


  stargazer::stargazer(CBre_11A,CBre_11B,Term_11A,Term_11B,type="text",
                       digits=2)
summary_residual_compare(CBre_11A,CBre_11B,Term_11A,Term_11B,bins=20)

```
Expectations are partially upheld, though particularly for military platform related goods and services often estimate higher probability of ceiling breaches but lower probabiltiy of terminations. ICT, missiles and space, and electronics and communications are exceptions to this trend.


### 11C: Product or Service Code
Expectation: Complex or higher risk product or service caregories will have a positive estimate with the probability of ceiling breaches and terminations. This ran into memory areas and did not run successfully.
```{r Model11C}
# corrdisp<-Hmisc::rcorr(
#   as.matrix(cbind(subset(large_crisis_smp, select=c(b_UCA,c_OffCri,cl_Ceil,
#                                             cl_Days,n_Fixed,b_Intl)),
#                        dummies::dummy(large_crisis_smp$Crisis),
#                        dummies::dummy(large_crisis_smp$NoComp),
#                        dummies::dummy(large_crisis_smp$Reach),
#                        dummies::dummy(large_crisis_smp$Veh),
#                                     dummies::dummy(large_crisis_smp$Is.Defense),
#                   dummies::dummy(large_crisis_smp$ProdServ))))
# corrdisp[[1]]
# 
# 


  # CBre_11C <-  glm (data=large_crisis_smp,
  #                  b_CBre ~ Crisis +NoComp +
  #                    b_UCA+
  #                    Reach+ c_OffCri+  
  #                    cl_Ceil+
  #                    cl_Days+
  #                    Veh+
  #                    n_Fixed +
  #                    Is.Defense +
  #                   cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
  #                    cl_Days:Veh+ 
  #                    cl_Ceil:Veh+
  #                  NoComp:Veh+
  #                  ProdServ, 
  #                  family=binomial(link="logit"))

  
  # Term_11C <-  glm (data=large_crisis_smp,
  #                  b_Term ~ Crisis +NoComp+
  #                    b_UCA+
  #                    Reach+ c_OffCri+
  #                   cl_Ceil+
  #                    cl_Days+
  #                    Veh+
  #                    n_Fixed +
  #                    Is.Defense +
  #                   cl_Days:NoComp+
  #                    b_UCA:Crisis+
  #                    cl_Days:Veh+ 
  #                    cl_Ceil:Veh+
  #                    NoComp:Veh+
  #                  ProdServ, 
  #                  family=binomial(link="logit"))
#   glmer_examine(Term_11C)
#   
# 
#   stargazer::stargazer(CBre_11B,CBre_11C,Term_11B,Term_11C,type="text",
#                        digits=2)
#   
#   
# 
# summary_residual_compare(CBre_10A,CBre_11C,Term_10A,Term_11C,bins=20)
# 
# texreg::htmlreg(list(CBre_11C,
#                      Term_11C),file="CrisisModel.html",single.row = TRUE,
#                 custom.model.name=c("Ceiling Breach",
#                                     "Complete\nand Partial\nTermination"
#                                     ),
#                         stars=c(0.05))
# summary(factor(large_crisis_smp$PSA))
```



### 11D: Removing OffCri
Including Product/Service/R&D or Product or Service Area both removed the significance from the percent of Office spending going to crisis funding. The next step will be to examine how the model fairs without that input.
```{r Model11D}


#Create the model

  CBre_11D <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_11D)
  
  Term_11D <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   PSA, 
                   family=binomial(link="logit"))
  glmer_examine(Term_11D)
  


  stargazer::stargazer(CBre_11B,CBre_11D,Term_11B,Term_11D,type="text",
                       digits=2)
summary_residual_compare(CBre_11B,CBre_11D,Term_11B,Term_11D,bins=20)

```
Removing  Office Cri for crisis ceiling makes sense, however, it does still seem to reduce deviance  for the termination model and the coefficient still  aligns with expectations. Leaving it for terminations.

The next step will be to examine the possiblity of removing Ceil:Comp from the Ceiling breach model. It is already absent from terminations. The coefficients are small and no longer significant. In addition, Ceiling has a VIF below 2, but it is the closest of the batch. 

### 11E: Removing Comp:Ceil
Including Product/Service/R&D or Product or Service Area both removed the significance from the percent of Office spending going to crisis funding. The next step will be to examine how the model fairs without that input.
```{r Model11E}


#Create the model

  CBre_11E <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_11E)
  
  stargazer::stargazer(CBre_11D,CBre_11E,type="text",
                       digits=2)

  stargazer::stargazer(CBre_11D,CBre_11E,type="text",
                       digits=2)
  
summary_residual_compare(CBre_11D,CBre_11E,Term_11B,Term_11D,bins=30)

```
The deviance reduction provided by Ceil:Comp remains significance, and without it, Comp/No Other loses significance. Leaving it in for now.

# Traditional Interactions
Midway through the model building, the study team switched to an approach of first adding all the variables, then seeking out interactions. This approach has the advantage of having all the available inputs in first.

## Reachback

### 12A: Crisis and Reachback
Expectation: Reachback contracting is not particularly important for ARRA. However, the interactions of disasters and OCO with US50-Intl should negatively estimate the risk of ceiling breaches and terminations

```{r Model2A}


#Create the model

  CBre_12A <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Customer +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_12A)
  
  Term_12A <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Customer +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   PSA+
                     Reach:Crisis, 
                   family=binomial(link="logit"))
  glmer_examine(Term_12A)
  


  stargazer::stargazer(CBre_11D,CBre_12A,Term_11B,Term_12A,type="text",
                       digits=2)
summary_residual_compare(CBre_11D,CBre_12A,Term_11B,Term_12A,bins=20)

```
The results partially meet expectatios, leaving it in.



### 12B: Reachback Ceiling
Expectation: In a crisis, internationally stationed contracting officers may offten have smaller warrants. THus, international contracting offices positively estimate probability of ceiling breaches and terminations.

```{r Model12B}


#Create the model

  CBre_12B <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                   Reach:cl_Ceil, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_12B)
  
  Term_12B <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                   Reach:cl_Ceil, 
                   family=binomial(link="logit"))
  glmer_examine(Term_12B)
  


  stargazer::stargazer(CBre_12A,CBre_12B,Term_12A,Term_12B,type="text",
                       digits=2)
summary_residual_compare(CBre_12A,CBre_12B,Term_12A,Term_12B,bins=20)

```
Expectations were met for terminations but not ceiling breaches. However, VIF was exceed in both cases, leaving this out.


### 12C: Reachback Duration
Expectation: In a crisis, remote deployment, there are sometimes rules against longer durations. Thus, the interaction of duration and international contracting offices positively estimate probability of ceiling breaches and terminations.

```{r Model12C}


#Create the model

  CBre_12C <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                   Reach:cl_Days, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_12C)
  
  Term_12C <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                   Reach:cl_Days, 
                   family=binomial(link="logit"))
  glmer_examine(Term_12C)
  


  stargazer::stargazer(CBre_12A,CBre_12C,Term_12A,Term_12C,type="text",
                       digits=2)
summary_residual_compare(CBre_12A,CBre_12C,Term_12A,Term_12C,bins=20)

```
Results were in line with expecatations for terminations but against them for crisis. The VIF proved too high in both cases, leaving this interaction out.


### 12D: Reachback and Vehicle
Expectation: Indirect Contract Vehicles lower the burden on contracting offices, whether or not they improve outcomes, because they can offer as a template where a large portion of the work is already done. As a result, the study team expects that international located contracts using any form of S-IDC/M-IDC/FSS/GWAC negatively estimated the probability of ceiling breaches and terminations. This may also be a benefit for domestic contracting offices as they may have a wider range of indirect contract vehicles to choose from. This seems unlikely to entirely explain the strengths of reachback contracting, but may reduce the coefficient on the base reachback domestic variables.

```{r Model12D}


#Create the model

  CBre_12D <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                   Reach:Veh, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_12D)
  
  Term_12D <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                   Reach:Veh, 
                   family=binomial(link="logit"))
  glmer_examine(Term_12D)
  


  stargazer::stargazer(CBre_12A,CBre_12D,Term_12A,Term_12D,type="text",
                       digits=2)
summary_residual_compare(CBre_12A,CBre_12D,Term_12A,Term_12D,bins=20)



  CBre_12D2 <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                   Reach:Veh, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_12D2)
  
  Term_12D2 <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   PSA+
                   Reach:Veh, 
                   family=binomial(link="logit"))
  glmer_examine(Term_12D2)

  
  
  stargazer::stargazer(CBre_12A,CBre_12D2,Term_12A,Term_12D2,type="text",
                       digits=2)
summary_residual_compare(CBre_12A,CBre_12D2,Term_12A,Term_12D2,bins=20)




  CBre_12D3 <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                   NoComp:Veh+
                   PSA+
                   Reach:Veh, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_12D3)

  
  stargazer::stargazer(CBre_12A,CBre_12D3,Term_12A,Term_12D2,type="text",
                       digits=2)
summary_residual_compare(CBre_12A,CBre_12D3,Term_12A,Term_12D2,bins=20)


```
Expectations were hold for ceiling breaches and single and multi award IDCs. However, not for FSS/GWAC nor for multiaward idcs for international contracts from internationally oriented contracting offies. Leaving it out.
## Customer Interactions
### 13A: Defense and Reachback

Expectation: The reachback concept originated with the Department of Defense. The interaction of international reachback contracting and defense will positively estimate the probability of ceiling breaches and terminations.

```{r Model3A}
    summary_discrete_plot(large_crisis_smp,"Reach","Is.Defense")


#Create the model

  CBre_13A <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Reach:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_13A)
  
  Term_13A <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Reach:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(Term_13A)
  


  stargazer::stargazer(CBre_12A,CBre_13A,Term_12A,Term_13A,type="text",
                       digits=2)
summary_residual_compare(CBre_12A,CBre_13A,Term_12A,Term_13A,bins=20)


```
The results ran contrary to expectations and ran into VIF problems when combined with reach:Crisis and even on their own for terminations. Leaving this out.

### 13B: Defense and Crisis

Expectation: The relationship could run either way. One the one hand, DoD tends to operate in less permissive environments. On the other, the organization is more attuned to handling crisis and the challenging logistics of these situations and also has considerable advantages of scale. Leaning on the latter idea, the study team expects that the interaction of Defense and Crisis will negatively estimate the probability of ceiling breaches and terminations.

```{r Model13B}
    summary_discrete_plot(large_crisis_smp,"Is.Defense","Crisis")


#Create the model

  CBre_13B <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_13B)
  
  Term_13B <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(Term_13B)
  


  stargazer::stargazer(CBre_12A,CBre_13B,Term_12A,Term_13B,type="text",
                       digits=2)
summary_residual_compare(CBre_12A,CBre_13B,Term_12A,Term_13B,bins=20)


```
The outcome proved to vary by type of crisis. The expectation held for OCO ceiling breaches, but not for disasters or fror ARRA. For Terminations, expectations were largerly thwarted, with the exception of disasters where the termination rate was lower.

### 13C: Defense and Competiion
Expectation: The market for Defense goods is more of a monosopy than other forms of contracting, as a result, the benefits of competition may be less pronounced. The study team expects that the interaction of defense and no competition will negatively estimate the probability of ceiling breaches and terminations while no competition alone will positively estimate the same.


```{r Model13C}
    summary_discrete_plot(large_crisis_smp,"NoComp","Is.Defense")
summary_discrete_plot(large_crisis_smp,"Comp","Is.Defense")


#Create the model

  CBre_13C <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     NoComp:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_13C)
  
  Term_13C <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     NoComp:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(Term_13C)
  


  stargazer::stargazer(CBre_13B,CBre_13C,Term_13B,Term_13C,type="text",
                       digits=2)

summary_residual_compare(CBre_13B,CBre_13C,Term_13B,Term_13C,bins=20)


  CBre_13C2 <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     NoComp:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_13C2)
  
  
  stargazer::stargazer(CBre_13B,CBre_13C2,Term_13B,Term_13C,type="text",
                       digits=2)

summary_residual_compare(CBre_13B,CBre_13C2,Term_13B,Term_13C,bins=20)

```
The results are striking and, for ceiling breaches, unexpected. For Defense contracts, competition estimateds a higher probability of a ceiling breach while the opposite is estimated for civilian contracts. With terminations, the results went the other way, aligning with expectations. For Ceiling breaches the VIF goes above 2, meaning that either Comp:Is.Defense or Crisis:Comp needs to be dropped. Dropping Comp:Is.Defense as the residuals seem smaller and it ran closer to expectations.

##Product or Service Area
### 14A: Defense and Product or Service Area

Expectation: Some categories, specifically weapons and launchers, already likely heavily overlap with defense so the results will not be especailly illuminating. However, for advanced weapon systems, ships, planes, land vehicles, R&D, and professional and managerial services interaction with defense will positively estimate the probability of ceiling breaches and terminations. However, the DoD also has a well established global logistics chain, and for commodities, Defense will negatively estimate the probability of ceiling breaches and terminations. 

```{r Model3A}
    summary_discrete_plot(large_crisis_smp,"PSA","Is.Defense")


#Create the model

  CBre_14A <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     PSA:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_14A)
  
  Term_14A <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     PSA:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(Term_14A)
  


  stargazer::stargazer(CBre_13B,CBre_14A,Term_13B,Term_14A,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14A,Term_13B,Term_14A,bins=20)

  
```
VIF proves off the charts. This interaction will be drpopped.

### 14B: Ceiling and Product or Service Area
Expectation: Complex and risky product or service areas still have some comparatively simple product or service codes in addition to covering highly volatile ones. The study team expects that size will help determine which is which and thus that the interaction of Ceiling and the complex PSAs (major defense acquisition programs and, given sourcing challenges, fuels) will positively estimate the probability of terminations and ceiling breaches
```{r Model4B}
    summary_continuous_plot(large_crisis_smp,"l_Ceil","PSA")


#Create the model

  CBre_14B <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     PSA:cl_Ceil, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_14B)
  
  Term_14B <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     PSA:cl_Ceil, 
                   family=binomial(link="logit"))
  glmer_examine(Term_14B)
  


  stargazer::stargazer(CBre_13B,CBre_14B,Term_13B,Term_14B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14B,Term_13B,Term_14B,bins=20)


  CBre_14B2 <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     PSA:cl_Ceil, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_14B2)
  
  Term_14B2 <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+
                     NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     PSA:cl_Ceil, 
                   family=binomial(link="logit"))
  glmer_examine(Term_14B2)
  
  stargazer::stargazer(CBre_13B,CBre_14B2,Term_13B,Term_14B2,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14B2,Term_13B,Term_14B2,bins=20)



  CBre_14B3 <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     cl_Days:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     PSA:cl_Ceil, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_14B3)

  stargazer::stargazer(CBre_13B,CBre_14B3,Term_13B,Term_14B2,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14B3,Term_13B,Term_14B2,bins=20)

```
Even with other ceiling interactions removed, the VIF for ceiling remains above 2. Leaving out this interaction

### 14C: Fixed and Product or Service Area

Expectation: Cost-base contnracts are more oriented towards products and services where costs are difficult to estimate in advanced, for  example professional and managerial services or MDAP developments. The study team expects that the  interaction of fixed-price and commodities will negatively estiate the probability of ceiling breaches and terminations, even if the net coefficient for terminations remains positive..

```{r Model14C}
    summary_discrete_plot(large_crisis_smp,"PSA","n_Fixed")


#Create the model

  CBre_14C <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     PSA:n_Fixed, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_14C)
  
  Term_14C <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     PSA:n_Fixed, 
                   family=binomial(link="logit"))
  glmer_examine(Term_14C)
  


  stargazer::stargazer(CBre_13B,CBre_14C,Term_13B,Term_14C,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14C,Term_13B,Term_14C,bins=20)

  
```
VIFs are prohibitive.

###14D: Removing Days

```{r Model4E}

#Create the model

  CBre_14D <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     # cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+
                   # cl_Days:NoComp+
                     # cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_14D)
  
  stargazer::stargazer(CBre_13B,CBre_14D,Term_13B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14,Term_13B,Term_13B,bins=20)

  
```

###14E: Removing Ceiling

```{r Model14E}

#Create the model

  CBre_14E <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     # cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    # cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+
                   cl_Days:NoComp+
                     cl_Days:Veh+
                     # cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_14E)

  stargazer::stargazer(CBre_13B,CBre_14E,Term_13B,Term_14E,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14E,Term_13B,Term_13B,bins=10)

  
```

###14F: Removing Urgency

```{r Model14F}

#Create the model

  CBre_14F <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+
                   cl_Days:NoComp+
                     cl_Days:Veh+
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_14F)

  stargazer::stargazer(CBre_13B,CBre_14F,Term_13B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14F,Term_13B,Term_13B,bins=20)

  
```

###14G: Removing Crisis

```{r Model14G}

#Create the model

  CBre_14G <- glm (data=large_crisis_smp,
                   b_CBre ~
                     # Crisis +
                     NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+
                   cl_Days:NoComp+
                     cl_Days:Veh+
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA,
                     # Reach:Crisis+
                     # Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_14G)

  stargazer::stargazer(CBre_13B,CBre_14G,Term_13B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14G,Term_13B,Term_13B,bins=10)

  
```

### 14H: Removing Vehicle
```{r Model14H}

#Create the model

  CBre_14H <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +
                     NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     # Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+
                   cl_Days:NoComp+
                     # cl_Days:Veh+
                     # cl_Ceil:Veh+
                   # NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense,
                   family=binomial(link="logit"))
  glmer_examine(CBre_14H)

  stargazer::stargazer(CBre_13B,CBre_14H,Term_13B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14H,Term_13B,Term_13B,bins=10)

  
```

### 14I: Removing UCA
```{r Model14I}

#Create the model

  CBre_14I <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +
                     NoComp +
                     # b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+
                   cl_Days:NoComp+
                     cl_Days:Veh+
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense,
                   family=binomial(link="logit"))
  glmer_examine(CBre_14I)

  stargazer::stargazer(CBre_13B,CBre_14I,Term_13B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14I,Term_13B,Term_13B,bins=20)

  
```

### 14J: Removing Comp
```{r Model14J}

#Create the model

  CBre_14J <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +
                     # NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    # cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+
                   # cl_Days:NoComp+
                     cl_Days:Veh+
                     cl_Ceil:Veh+
                   # NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense,
                   family=binomial(link="logit"))
  glmer_examine(CBre_14J)

  stargazer::stargazer(CBre_13B,CBre_14J,Term_13B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14J,Term_13B,Term_13B,bins=10)

  
```

### 14K: Removing Fixed
```{r Model14K}

#Create the model

  CBre_14K <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +
                     NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     # n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+
                   cl_Days:NoComp+
                     cl_Days:Veh+
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense,
                   family=binomial(link="logit"))
  glmer_examine(CBre_14K)

  stargazer::stargazer(CBre_13B,CBre_14K,Term_13B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14K,Term_13B,Term_13B,bins=20)

  
```

### 14L: Removing Is.Defense
```{r Model14L}

#Create the model

  CBre_14L <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +
                     NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     # Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+
                   cl_Days:NoComp+
                     cl_Days:Veh+
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   PSA+
                     Reach:Crisis,
                     # Crisis:Is.Defense,
                   family=binomial(link="logit"))
  glmer_examine(CBre_14L)

  stargazer::stargazer(CBre_13B,CBre_14L,Term_13B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14L,Term_13B,Term_13B,bins=20)

  
```

### 14M: Removing PSA
```{r Model14M}

#Create the model

  CBre_14M <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +
                     NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+
                   cl_Days:NoComp+
                     cl_Days:Veh+
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   # PSA+
                     Reach:Crisis+
                     Crisis:Is.Defense,
                   family=binomial(link="logit"))
  glmer_examine(CBre_14M)

  stargazer::stargazer(CBre_13B,CBre_14M,Term_13B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_14M,Term_13B,Term_13B,bins=20)

  
```
The problem does appear to be with PSA. The study team considered reverting to product/service/R&D for ceiling, although classically in contingency situations, the division in construction/commodities(products)/services(other than construction including R&D.) That alternative approach is likely more suitable, but also suggests an additional possible solution, namely splitting Facility Based Services and Construction services. The two together are one of the more numerous categories of services, albiet still dwarfed by "other products" and clothing and subsitence.  A look back to 11A



## Breaking out Construction
The study team had not initially focused on construction as a risk area and had been surprised to see that Facility-Related and Construction services had a high coefficient. The importance of this became clear on closer examination. The team spoke to two in-house experts for their opinions, to inform the expections below.

Expecation: Construction, in and of itself, is not seen as a higher risk area than other forms of contracting or contingency contracting. One expert thought that this also extended to on base construction in the field. These conracts, likely funded as MilCon, may have run into a fair amount of trouble around 2005, but by present day, we know what we're doing.

However, outside of bases, the construction related to development work can be notably higher risk. In particular, these contracts may have to subcontract for security which can be an additional source of risk. 

Otherwise we would expect that services will positively estimate the probability of terminations and ceiling breaches as in addition to the challenges of measuring services, services also are often in the field and thus higher risk while commodities can sometimes be acquired elsewhere.

### 15A: Commmodity/Service/Construction
```{r Model15A}
summary_discrete_plot(large_crisis_smp,"ServCommCons",rotate_text=TRUE)

#Create the model

  CBre_15A <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis + NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_15A)
  
  Term_15A <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(Term_15A)
  


  stargazer::stargazer(CBre_13B,CBre_15A,Term_13B,Term_15A,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_15A,Term_13B,Term_15A,bins=20)
```
Expectations are upheld, but breaking out construction, in and of itself, is not enough to resolve the challenges with residuals.

### 15B: Crisis Product or Service Area
Expectations mirrior earlier expecations, with the addition 
```{r Model15B}
freq_discrete_plot(large_crisis_smp,"ServCommCons",rotate_text=TRUE)
discrete_percent_plot(large_crisis_smp,"ServCommCons",caption=FALSE,rotate_text=TRUE)


#Create the model

  CBre_15B <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   CPSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_15B)
  
  Term_15B <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   CPSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(Term_15B)
  


  stargazer::stargazer(CBre_13B,Term_15B,Term_13B,Term_15B,type="text",
                       digits=2)
summary_residual_compare(CBre_13B,CBre_15B,Term_13B,Term_15B,bins=50)


coefplot(CBre_15B)
save(CBre_15B,file="CBre_15B.Rda")
```

###15C: P/S/C and Crisis
Expectation: Services and construction are more likely to be performed in the field, and thus can become a greater challenge in a crisis. The interaction of Crisis with services and construction positively estimate the probability of terminations and ceiling breaches.

```{r Model15C}
summary_discrete_plot(large_crisis_smp,"ServCommCons",rotate_text=TRUE)
summary_discrete_plot(large_crisis_smp,"Crisis","ServCommCons")

#Create the model

  CBre_15C <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis + NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     ServCommCons:Crisis, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_15C)
  
  Term_15C <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     ServCommCons:Crisis, 
                   family=binomial(link="logit"))
  glmer_examine(Term_15C)
  


  stargazer::stargazer(CBre_15A,CBre_15C,Term_15A,Term_15C,type="text",
                       digits=2)
summary_residual_compare(CBre_15A,CBre_15C,Term_15A,Term_15C,bins=20)


  CBre_15C2 <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis + NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     # Crisis:Is.Defense+
                     ServCommCons:Crisis,
                   family=binomial(link="logit"))
  glmer_examine(CBre_15C2)
  
  Term_15C2 <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     # Crisis:Is.Defense+
                     ServCommCons:Crisis, 
                   family=binomial(link="logit"))
  glmer_examine(Term_15C2)
  

stargazer::stargazer(CBre_15A,CBre_15C2,Term_15A,Term_15C2,type="text",
                       digits=2)
summary_residual_compare(CBre_15A,CBre_15C2,Term_15A,Term_15C2,bins=20)

```
Expectations were not upheld, but VIF threshold of two was also exceeded for both models.


###15D: P/S/C and  Is.Defense
Expectation: The Department of Defense has a substantial logistics network and a great deal of experience with construction, particularly on bases. The interaction of Defense with services and construction is expected to negatively estimate the probability of terminations and ceiling breaches.

```{r Model15D}
summary_discrete_plot(large_crisis_smp,"Is.Defense","ServCommCons")

#Create the model

  CBre_15D <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis + NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     ServCommCons:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_15D)
  
  Term_15D <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     ServCommCons:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(Term_15D)
  


  stargazer::stargazer(CBre_15A,CBre_15D,Term_15A,Term_15D,type="text",
                       digits=2)
summary_residual_compare(CBre_15A,CBre_15D,Term_15A,Term_15D,bins=20)


  CBre_15D2 <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis + NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     # Crisis:Is.Defense+
                     ServCommCons:Is.Defense,
                   family=binomial(link="logit"))
  glmer_examine(CBre_15D2)
  
  Term_15D2 <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     # Crisis:Is.Defense+
                     ServCommCons:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(Term_15D2)

stargazer::stargazer(CBre_15A,CBre_15D2,Term_15A,Term_15D2,type="text",
                       digits=2)
summary_residual_compare(CBre_15A,CBre_15D2,Term_15A,Term_15D2,bins=20)

```
The results ran contrary to expectations, but VIF was exceeded, making the point moot.


###15E: P/S/C and Reachback
Expectation: Services and construction are more likely to be performed in the field, and thus can become a greater challenge for internationally performed contracts. Products can be most easily shipped, and thus may hav the greatest advantage for domestic contracting offices. The interaction of internationally performed contracts with services and construction positively estimate the probability of terminations and ceiling breaches. The interaction of domestic offices with products (the baseline variable) will negatively positively estimate the probability of terminations and ceiling breaches.

```{r Model15E}
summary_discrete_plot(large_crisis_smp,"Reach","ServCommCons")

#Create the model

  CBre_15E <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis + NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     ServCommCons:Reach, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_15E)
  
  Term_15E <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   ServCommCons+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     ServCommCons:Reach, 
                   family=binomial(link="logit"))
  glmer_examine(Term_15E)
  


  stargazer::stargazer(CBre_15A,CBre_15E,Term_15A,Term_15E,type="text",
                       digits=2)
summary_residual_compare(CBre_15A,CBre_15E,Term_15A,Term_15E,bins=20)



  CBre_15E2 <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis + NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   ServCommCons+
                     # Reach:Crisis+
                     Crisis:Is.Defense+
                     ServCommCons:Reach, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_15E2)
  
  Term_15E2 <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   ServCommCons+
                     # Reach:Crisis+
                     Crisis:Is.Defense+
                     ServCommCons:Reach, 
                   family=binomial(link="logit"))
  glmer_examine(Term_15E2)
  

  stargazer::stargazer(CBre_15A,CBre_15E2,Term_15A,Term_15E2,type="text",
                       digits=2)
summary_residual_compare(CBre_15A,CBre_15E2,Term_15A,Term_15E2,bins=20)
summary_residual_compare(CBre_15B,CBre_15E2,Term_15B,Term_15E2,bins=20)

```
The results are somewhat interesting, with the US-50-Intl experience not quite running in line with expectation but instead specifically upholding hypothesis. However, the rarity of terminations for Intl-Dom contstruction would likely cause challenges further down the line. Leaving it out.

### 15F: Crisis Product or Service Area
Expectations mirrior earlier expecations, with the addition 
```{r Model15F}
large_crisis_smp$sqrcl_Ceil<-large_crisis_smp$cl_Ceil^2


freq_discrete_plot(large_crisis_smp,"ServCommCons",rotate_text=TRUE)
discrete_percent_plot(large_crisis_smp,"ServCommCons",caption=FALSE,rotate_text=TRUE)


#Create the model

  CBre_15F <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     sqrcl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                   CPSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_15F)
  
  Term_15F <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     sqrcl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     NoComp:Veh+
                   CPSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(Term_15F)
  


  stargazer::stargazer(CBre_15B,Term_15F,Term_15B,Term_15F,type="text",
                       digits=2)
summary_residual_compare(CBre_15B,CBre_15F,Term_15B,Term_15F,bins=50)



  CBre_15F2 <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     sqrcl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+
                     sqrcl_Ceil:Veh:NoComp+
                     cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     sqrcl_Ceil:Veh+
                   NoComp:Veh+
                   CPSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_15F2)
  
  Term_15F2 <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     sqrcl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                      sqrcl_Ceil:Veh+

                     NoComp:Veh+
                   CPSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(Term_15F2)

  
    stargazer::stargazer(CBre_15B,Term_15F2,Term_15B,Term_15F2,type="text",
                       digits=2)
summary_residual_compare(CBre_15B,CBre_15F2,Term_15B,Term_15F2,bins=50)



  CBre_15F3 <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     sqrcl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                     cl_Days:NoComp+
                     cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     sqrcl_Ceil:Veh+
                   NoComp:Veh+
                   CPSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_15F3)
  
  Term_15F3 <- glm (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     sqrcl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                    cl_Days:NoComp+
                     b_UCA:Crisis+
                     cl_Days:Veh+ 
                     NoComp:Veh+
                   CPSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(Term_15F3)

  stargazer::stargazer(CBre_15B,Term_15F3,Term_15B,Term_15F3,type="text",
                       digits=2)
summary_residual_compare(CBre_15B,CBre_15F3,Term_15B,Term_15F3,bins=50)


  CBre_15F4 <- glm (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     sqrcl_Ceil+
                     cl_Days+
                     Veh+
                     n_Fixed +
                     Is.Defense +
                     cl_Days:NoComp+
                     cl_Days:Veh+ 
                   NoComp:Veh+
                   CPSA+
                     Reach:Crisis+
                     Crisis:Is.Defense, 
                   family=binomial(link="logit"))
  glmer_examine(CBre_15F4)
  stargazer::stargazer(CBre_15B,CBre_15F4,Term_15B,Term_15F3,type="text",
                       digits=2)
summary_residual_compare(CBre_15B,CBre_15F4,Term_15B,Term_15F3,bins=50)
  

```
Experimenting with a squared term is ultimately unsuccessful.

#16
### 16B: Interactions
```{r Model16B}


load("model16B.rdata")  

  # CBre_16B <- glmer (data=large_crisis_smp,
  #                  b_CBre ~ Crisis + NoComp + 
  #                    b_UCA +
  #                    Reach + c_OffCri + 
  #                    cl_Ceil + 
  #                    capped_cl_Days + 
  #                    Veh + 
  #                    PricingBasis + 
  #                    Is.Defense + 
  #                    # NoComp:Crisis +
  #                    # b_UCA:Crisis + 
  #                    # Reach:Crisis + 
  #                    # Reach:NoComp + 
  #                    # capped_cl_Days:Veh + 
  #                    # cl_Ceil:Veh +
  #                    # NoComp:Veh + 
  #                    (1 | Simple)+(1 |  PSA), 
  #                  family=binomial(link="logit"))
  glmer_examine(CBre_16B)
  # 
  # Term_16B <- glmer (data=large_crisis_smp,
  #                  b_Term ~ Crisis + 
  #                    NoComp + 
  #                    b_UCA + 
  #                    Reach + c_OffCri + 
  #                    cl_Ceil + 
  #                    capped_cl_Days + 
  #                    Veh +
  #                    PricingBasis +
  #                    Is.Defense + 
  #                    # Crisis:NoComp + 
  #                    # b_UCA:Crisis + 
  #                    # Reach:Crisis + 
  #                    # cl_Ceil:Crisis + 
  #                    # cl_Ceil:Reach + 
  #                    # capped_cl_Days:Crisis + 
  #                    # capped_cl_Days:NoComp+ +
  #                    # capped_cl_Days:Veh + 
  #                    # cl_Ceil:Veh+
  #                    # NoComp:Veh + 
  #                     (1 |  PSA), 
  #                  family=binomial(link="logit"))
  glmer_examine(Term_16B)
  # 

stargazer::stargazer(CBre_11B,CBre_16A,CBre_16B,Term_11B,Term_16A,Term_16B,type="text",
                        digits=2)

summary_residual_compare(CBre_16A,CBre_16B,Term_16A,Term_16B)
# save(CBre_16B,Term_16B, file="Model16B.RData")

```
The use of Comp as 

Ceil converges
Term Model failed to converge with max|grad| = 0.00135324 (tol = 0.001, component 1)

### 16C: Code-level detail
```{r Model16C}
load("Model16C.RData") #Only have CBre at the moment

  # CBre_16C <- glmer (data=large_crisis_smp,
  #                  b_CBre ~ Crisis + NoComp + 
  #                    b_UCA +
  #                    Reach + c_OffCri + 
  #                    cl_Ceil + 
  #                    capped_cl_Days + 
  #                    Veh + 
  #                    PricingBasis + 
  #                    Is.Defense + 
  #                    # NoComp:Crisis +
  #                    # b_UCA:Crisis + 
  #                    # Reach:Crisis + 
  #                    # Reach:NoComp + 
  #                    # capped_cl_Days:Veh + 
  #                    # cl_Ceil:Veh +
  #                    # NoComp:Veh + 
  #                    (1 | Simple)+(1 |  PSA) + (1|ProdServ), 
  #                  family=binomial(link="logit"))
  glmer_examine(CBre_16C)
  # 
  # Term_16C <- glmer (data=large_crisis_smp,
  #                  b_Term ~ Crisis + 
  #                    NoComp + 
  #                    b_UCA + 
  #                    Reach + c_OffCri + 
  #                    cl_Ceil + 
  #                    capped_cl_Days + 
  #                    Veh +
  #                    PricingBasis +
  #                    Is.Defense + 
  #                    # Crisis:NoComp + 
  #                    # b_UCA:Crisis + 
  #                    # Reach:Crisis + 
  #                    # cl_Ceil:Crisis + 
  #                    # cl_Ceil:Reach + 
  #                    # capped_cl_Days:Crisis + 
  #                    # capped_cl_Days:NoComp+ +
  #                    # capped_cl_Days:Veh + 
  #                    # cl_Ceil:Veh +
  #                      (1 | Simple)+(1 |  PSA) + (1|ProdServ), 
  #                  family=binomial(link="logit"))
  # glmer_examine(Term_16C)
  stargazer::stargazer(CBre_11B,CBre_16A,CBre_16B,CBre_16C,Term_11B,Term_16A,Term_16B,type="text",
                        digits=2)

summary_residual_compare(CBre_16B,CBre_16C,Term_16A,Term_16B)
# save(CBre_16C, Term_16C, file="Model16C.RData")
```

CBre_16C Model failed to converge with max|grad| = 0.0103776 (tol = 0.001, component 1)

Term_16C 
Model failed to converge with max|grad| = 0.0338872 (tol = 0.001, component 1)




### 16D: Crisis + Product ServiceArea

```{r Model16D}
summary(large_crisis_smp$PSA)
large_crisis_smp$PSA<-factor(large_crisis_smp$PSA)
#Frequency Plot
freq_discrete_cbre_plot(large_crisis_smp,"PSR_What")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))

#Percent Terminated Plot 
discrete_percent_cbre_plot(large_crisis_smp,"PSR_What")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))

load("model16D.rdata")  

  CBre_16D <- glmer (data=large_crisis_smp,
                    b_CBre ~ NoComp +
                     b_UCA +
                     Reach + c_OffCri +
                     cl_Ceil +
                     capped_cl_Days +
                     Veh +
                     PricingBasis +
                     Is.Defense +
                      cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+
                      capped_cl_Days:NoComp+
                     capped_cl_Days:Veh+
                     cl_Ceil:Veh+
                   NoComp:Veh+

                     (1 + Reach + Is.Defense| Crisis) + (1 | PSA),
                   family=binomial(link="logit"))
glmer_examine(CBre_16D)

  Term_16D <- glmer(data=large_crisis_smp,
                   b_Term ~ Crisis +
                     NoComp +
                     b_UCA +
                     Reach + c_OffCri +
                     cl_Ceil +
                     capped_cl_Days +
                     Veh +
                     PricingBasis +
                     Is.Defense +
                    # capped_cl_Days:NoComp+
                     capped_cl_Days:Veh+
                     cl_Ceil:Veh+
                     
                  (1+ b_UCA + Reach + Is.Defense | Crisis) +  (1| PSA) ,
                   family=binomial(link="logit"))


glmer_examine(Term_16D)
# Plot the model and Vehicle 

stargazer::stargazer(CBre_15A,CBre_15D,Term_15A,Term_15D,type="text",
                        digits=2)
summary_residual_compare(CBre_15A,CBre_15D,Term_15A,Term_15D,50)

# save(CBre_16A,Term_16A, file="Model16A.RData")
```

CBre Model failed to converge with max|grad| = 0.00182267 (tol = 0.001, component 1)


Term Model failed to converge with max|grad| = 0.00151616 (tol = 0.001, component 1)
### 16E: Serv/Supply/Const + Area
Initial multi-level analysis used CSIS's traditional product or service areas. After additional analysis in  step 15, this approach was rerun using 
```{r Model16E}
summary(large_crisis_smp$ServCommCons)
summary(large_crisis_smp$CPSA)

load("model16E.rdata")  
  CBre_16E <- glmer (data=large_crisis_smp,
                   b_CBre ~ Crisis +NoComp +
                     b_UCA+
                     Reach+ 
                     cl_Ceil+
                     capped_cl_Days+
                     Veh+
                     PricingBasis +
                     Is.Defense +
                    cl_Ceil+Crisis:NoComp+b_UCA:Crisis+cl_Ceil:NoComp+capped_cl_Days:NoComp+
                     capped_cl_Days:Veh+ 
                     cl_Ceil:Veh+
                   NoComp:Veh+
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     (1 | ServCommCons) + (1| CPSA), 
                   family=binomial(link="logit"))
  glmer_examine(CBre_16E)
  
  Term_16E <- glmer (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     capped_cl_Days+
                     Veh+
                     PricingBasis +
                     Is.Defense +
                    # capped_cl_Days:NoComp+
                     b_UCA:Crisis+
                     capped_cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     
                     Reach:Crisis+
                     Crisis:Is.Defense+
                     (1 | ServCommCons) + (1| CPSA), 
                   family=binomial(link="logit"))
  glmer_examine(Term_16E)
# Plot the model and Vehicle 

stargazer::stargazer(CBre_15B,CBre_16A,CBre_16C,CBre_16E,Term_15B,Term_16A,Term_16C,Term_16E,type="text",
                        digits=2)
summary_residual_compare(CBre_15B,CBre_16E,Term_15B,Term_16E)
summary_residual_compare(CBre_16A,CBre_16E,Term_16A,Term_16E)
summary_residual_compare(CBre_16C,CBre_16E,Term_16C,Term_16E)

  Term_16E2 <- glmer (data=large_crisis_smp,
                   b_Term ~ Crisis +NoComp+
                     b_UCA+
                     c_OffCri+
                     Reach+ 
                    cl_Ceil+
                     capped_cl_Days+
                     Veh+
                     PricingBasis +
                     Is.Defense +
                    capped_cl_Days:NoComp+
                     b_UCA:Crisis+
                     capped_cl_Days:Veh+ 
                     cl_Ceil:Veh+
                     
                     Reach:Crisis+
                     Crisis:Is.Defense+
                    (1| CPSA), 
                   family=binomial(link="logit"))
  glmer_examine(Term_16E2)

  save(CBre_16E,Term_16E, file="Model16E.RData")
```
Term  failed to converge 0.004





### 16F: Revised Code-level detail no interactions
Some of the discussions of a failure to converge suggest that the model is too complex. In this step we remove all the interactions.
```{r Model16F}
load("Model16F.RData") #Only have CBre at the moment

    # CBre_16F <- glmer (data=large_crisis_smp,
    #                  b_CBre ~ Crisis + NoComp +
    #                    b_UCA +
    #                    Reach + 
    #                    # c_OffCri +
    #                    cl_Ceil +
    #                    capped_cl_Days +
    #                    Veh +
    #                    PricingBasis +
    #                    Is.Defense +
    #                    # NoComp:Crisis +
    #                    # b_UCA:Crisis +
    #                    # Reach:Crisis +
    #                    # Reach:NoComp +
    #                    # capped_cl_Days:Veh +
    #                    # cl_Ceil:Veh +
    #                    # NoComp:Veh +
    #                    (1 | ServCommCons)+(1 |  CPSA) + (1|ProdServ),
    #                  family=binomial(link="logit"))
    # glmer_examine(CBre_16F)
    # glmer_examine(CBre_16F)
#This one was lost, but did and had a low Max|Grad than CBre_16F but still well above 
    
    
    # CBre_16F2 <- glmer (data=large_crisis_smp,
    #                  b_CBre ~ Crisis + NoComp +
    #                    b_UCA +
    #                    Reach + 
    #                    # c_OffCri +
    #                    cl_Ceil +
    #                    # capped_cl_Days +
    #                    Veh +
    #                    PricingBasis +
    #                    Is.Defense +
    #                    # NoComp:Crisis +
    #                    # b_UCA:Crisis +
    #                    # Reach:Crisis +
    #                    # Reach:NoComp +
    #                    # capped_cl_Days:Veh +
    #                    # cl_Ceil:Veh +
    #                    # NoComp:Veh +
    #                    # (1 | ServCommCons)+(1 |  CPSA) +
    #                    (1|ProdServ),
    #                  family=binomial(link="logit"))
    glmer_examine(CBre_16F2)
    glmer_examine(CBre_16F2)
    save(CBre_16F2,file="Model16F.RData")
    rm(CBre_16F2)
```

Removing all the interactions and c_OfficeCri doesn't help the convergence, even when limiting only to prodserv as a multilevel variable. An additional step, 16F2, also removed l_days and the model had an even harder time converging (max|grad| = 0.201). The 16F results were accidentally lost but were far from convergence and not worth rerunning.

###16G: Revised Code level all interactions
```{r Model16G}
load("Model16G.RData") #Only have CBre at the moment
    CBre_16G <- glmer (data=large_crisis_smp,
                     b_CBre ~ Crisis + NoComp +
                       b_UCA +
                       Reach + 
                       c_OffCri +
                       cl_Ceil +
                       capped_cl_Days +
                       Veh +
                       PricingBasis +
                       Is.Defense +
                       NoComp:Crisis + 
                       b_UCA:Crisis +
                       Reach:Crisis +
                       Reach:NoComp +
                       capped_cl_Days:Veh +
                       cl_Ceil:Veh +
                       NoComp:Veh +
                       (1 | ServCommCons)+(1 |  CPSA) +
                       (1|ProdServ),
                     family=binomial(link="logit"))
glmer_examine(CBre_16F3)

CBre_16G<- glmer (data=large_crisis_smp,
                     b_CBre ~ Crisis + NoComp +
                       b_UCA +
                       Reach + 
                       c_OffCri +
                       cl_Ceil +
                       capped_cl_Days +
                       Veh +
                       PricingBasis +
                       Is.Defense +
                     capped_cl_Days:NoComp +
                     capped_cl_Days:Veh + 
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
                     NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
                     # Reach:Crisis This 
                   + Crisis:Is.Defense +
                       (1 | ServCommCons)+(1 |  CPSA) +
                       (1|ProdServ),
                     family=binomial(link="logit"))
glmer_examine(CBre_16G)
glmer_examine(CBre_16G)
    save(CBre_16F3,CBre_16G,file="Model16G.RData")
 
```

16G ran into multicollinearity problems, necessitating the removal of some of the interactions. New interactions were also added the analysis in step 15. Step 16 groups all of the multilevel models together, because of run-time related complications and advice regarding logit models. In some cases though, dealing with the multilevel models resulted in ideas that were then fleshed out in earlier steps.

Dropped interactions: NoComp:Crisis, b_UCA:Crisis, Reach:Crisis, Reach:NoComp,          cl_Ceil:Veh

Added interactions: capped_cl_Days:NoComp, Crisis:Is.Defense

Collectively these changes reduced the max|grad| from 0.017 to 0.004.

## 16H: 2-Digit Prodserv
Since the max|grad| isn't reaching 0.001, trying to experiment with 2-character product or service codes, rather than the fully detailed 4-character ones.

```{r Prodserv2}
  large_crisis_smp$ProdServ2<-factor(substr(large_crisis_smp$ProdServ,1,2))
     
  # CBre_16F4<-glmer(formula = b_CBre ~ Crisis + 
  #                    NoComp + 
  #                    b_UCA + 
  #                    Reach + 
  #                    cl_Ceil + 
  #                    capped_cl_Days + 
  #                    Veh + 
  #                    PricingBasis + 
  #                    Is.Defense + 
  #                    capped_cl_Days:NoComp + 
  #                    capped_cl_Days:Veh + 
  #                    cl_Ceil:Veh + 
  #                    NoComp:Veh +
  #                    Reach:Crisis +
  #                   Crisis:Is.Defense +
  #                    (1 | ProdServ2),
  #                  data = large_crisis_smp, family = binomial(link = "logit"))
  glmer_examine(CBre_16F4)
  glmer_examine(CBre_16F4)
  
  CBre_16F5<-glmer(formula = b_CBre ~ Crisis + 
                     NoComp + 
                     b_UCA + 
                     Reach + 
                     cl_Ceil + 
                     capped_cl_Days + 
                     Veh + 
                     PricingBasis + 
                     Is.Defense + 
                     capped_cl_Days:NoComp + 
                     capped_cl_Days:Veh + 
                     cl_Ceil:Veh + 
                     NoComp:Veh +
                     # Reach:Crisis 
                   + Crisis:Is.Defense +
                     (1 | ProdServ2),
                   data = large_crisis_smp, family = binomial(link = "logit"))
  glmer_examine(CBre_16F5)
  glmer_examine(CBre_16F5)
  
  CBre_16F6<-glmer(formula = b_CBre ~ Crisis + 
                     NoComp + 
                     b_UCA + 
                     Reach + 
                     cl_Ceil + 
                     capped_cl_Days + 
                     Veh + 
                     PricingBasis + 
                     Is.Defense + 
                     # capped_cl_Days:NoComp + We're not that close to the max|grad, this is significant but runs contrary 
                     #to expectation and is less interesting than the NoComp:Veh
                     capped_cl_Days:Veh + 
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
                     NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
                     # Reach:Crisis This 
                   + Crisis:Is.Defense +
                     (1 | ProdServ2),
                   data = large_crisis_smp, family = binomial(link = "logit"))
  glmer_examine(CBre_16F6)
  glmer_examine(CBre_16F6)
  

  stargazer::stargazer(CBre_16F4,CBre_16F5,CBre_16F6,type="text",
                        digits=2)
save(CBre_16F4,CBre_16F5,CBre_16F6,file="Model16H.RData")
```
The first model had multicollinearity problems, but unfortunately the VIF for reach exceeded 2.0 and the only reach related interaction was crisis:reach. Taking out the variable increased the max|grad| from 0.0038 to 0.0089. 
                    
Removing additional variables (capped_cl_Days:NoComp, cl_Ceil:Veh) for the third and final model further increased the max|grad, not helpful.




GOing more detailed proved useful for 16F7

Model failed to converge with max|grad| = 0.00400832 (tol = 0.001, component 1)


## 16I: CPSA+Prodserv
This step goes back to 4 character product or service codes. 16G included three levels in the hierarchy: ServCommCons (service/commodity/construction) and crisis product or service area, and the full product or service code. This approach drops out ServCommCons, as it had a slightly lower standard deviation.

```{r Model16I}

load(file="Model16I.RData")


# CBre_16F9<-glmer(formula = b_CBre ~ Crisis + NoComp + b_UCA + Reach + c_OffCri + 
#     cl_Ceil + capped_cl_Days + Veh + PricingBasis + Is.Defense + capped_cl_Days:NoComp + 
#     capped_cl_Days:Veh + NoComp:Veh + +Crisis:Is.Defense + (1 | ServCommCons) + 
#     (1 | ProdServ), data = large_crisis_smp, family = binomial(link = "logit"))

    glmer_examine(CBre_16F9)
    glmer_examine(CBre_16F9)
    
    
# CBre_16G2 <- glmer (data=large_crisis_smp,
#                      b_CBre ~ Crisis + NoComp +
#                        b_UCA +
#                        Reach + 
#                        c_OffCri +
#                        cl_Ceil +
#                        capped_cl_Days +
#                        Veh +
#                        PricingBasis +
#                        Is.Defense +
#                      capped_cl_Days:NoComp +
#                      capped_cl_Days:Veh + 
#                      # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
#                      NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
#                      # Reach:Crisis This 
#                    + Crisis:Is.Defense +
#                        # (1 | ServCommCons)+
#                      (1 |  CPSA) +
#                        (1|ProdServ),
#                      family=binomial(link="logit"))
  glmer_examine(CBre_16G2)
  
  # CBre_16G3<- glmer (data=extra_large_crisis_smp,
  #                    b_CBre ~ Crisis + NoComp +
  #                      b_UCA +
  #                      Reach + 
  #                      c_OffCri +
  #                      cl_Ceil +
  #                      capped_cl_Days +
  #                      Veh +
  #                      PricingBasis +
  #                      Is.Defense +
  #                    capped_cl_Days:NoComp +
  #                    capped_cl_Days:Veh + 
  #                    # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
  #                    NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
  #                    # Reach:Crisis This 
  #                  + Crisis:Is.Defense +
  #                      # (1 | ServCommCons)+
  #                    (1 |  CPSA) +
  #                      (1|ProdServ),
  #                    family=binomial(link="logit"))
    
glmer_examine(CBre_16G3)
glmer_examine(CBre_16G3)

   

  save(CBre_16F9,CBre_16G2,CBre_16G3,file="Model16I.RData")
  
  
```

The Max|Grad of this model is still too high, but is already lower than that for model CBre_16G2 (or what will be once I rename things.) Switching to an extra-large version of the sample, including all international contracts and task orders and a million domestic ones, reduced the |max|grad but only from 0.0036 to 0.0024. 

## 16J: Drop capped_cl_Days:Veh

```{r Model16J}

  
        glmer_examine(CBre_16G3)
    vif(CBre_16G3)
summary_residual_compare(CBre_16C,CBre_16F3,Term_16C,Term_16C)
summary_residual_compare(CBre_16C,CBre_16G,Term_16C,Term_16C)
summary_residual_compare(CBre_16C,CBre_16G,Term_16C,Term_16C)
summary_residual_compare(CBre_16C,CBre_16G3,Term_16C,Term_16C)
coef(CBre_16G)
save(CBre_16F2,CBre_16F3,CBre_16F4,CBre_16F5,CBre_16F6,CBre_16G,CBre_16G,CBre_16F9,CBre_16G3, file="Model16F.RData")

summary_discrete_plot(large_crisis_smp,"Veh","NoComp")
summary_continuous_plot(large_crisis_smp,"l_Days","Veh")
table(fed$Crisis,fed$NoComp,fed$Veh)
table(fed$Crisis,fed$NoComp,fed$Veh,fed$CBre)
table(fed$Crisis,fed$NoComp,fed$Veh,fed$CBre)


# CBre_16G4<-    glmer (data=large_crisis_smp,
#                      b_CBre ~ Crisis + NoComp +
#                        b_UCA +
#                        Reach + 
#                        c_OffCri +
#                        cl_Ceil +
#                        capped_cl_Days +
#                        Veh +
#                        PricingBasis +
#                        Is.Defense +
#                      capped_cl_Days:NoComp +
#                      # capped_cl_Days:Veh + 
#                      # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
#                      NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
#                      # Reach:Crisis This 
#                    + Crisis:Is.Defense +
#                        # (1 | ServCommCons)+
#                      (1 |  CPSA) +
#                        (1|ProdServ),
#                      family=binomial(link="logit"))
    
    glmer_examine(CBre_16G4)
glmer_examine(CBre_16G4)
save(CBre_16G4,file="Model16J.RData")
```
After consideration, capped_cl_Days:Veh seemed to add the least to the model. Comparing the large sample to large sample, taking out does lower the Max|Grid from 0.0036 to 0.0027 


### 16K: Drop NoComp:Veh

```{r Model16K}
CBre_16G5 <- glmer (data=large_crisis_smp,
                     b_CBre ~ Crisis + NoComp +
                       b_UCA +
                       Reach + 
                       c_OffCri +
                       cl_Ceil +
                       capped_cl_Days +
                       Veh +
                       PricingBasis +
                       Is.Defense +
                     capped_cl_Days:NoComp +
                     # capped_cl_Days:Veh + 
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
                     # NoComp:Veh + 
                     # Reach:Crisis This 
                   + Crisis:Is.Defense +
                       # (1 | ServCommCons)+
                     (1 |  CPSA) +
                       (1|ProdServ),
                     family=binomial(link="logit"))
    
    
   glmer_examine(CBre_16G5)
glmer_examine(CBre_16G5)
save(CBre_16G5,file="Model16K.RData")



```
The next to test removing is top drop NoComp:Veh which often did not have significant differences between the no comp other and urgency variants, although it did in some cases. That dramatically ups the max|grad| to 0.01, so NoComp:Veh will be staying in.

### 16L: Drop OffCri

```{r Model16L}
CBre_16G6 <- glmer (data=large_crisis_smp,
                      b_CBre ~ Crisis + NoComp +
                        b_UCA +
                       Reach + 
# +                        c_OffCri +
                        cl_Ceil +
                        capped_cl_Days +
                        Veh +
                        PricingBasis +
                       Is.Defense +
                     capped_cl_Days:NoComp +
                     # capped_cl_Days:Veh + 
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
                      NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
  # Reach:Crisis This 
                   + Crisis:Is.Defense +
                       # (1 | ServCommCons)+   
  (1 |  CPSA) +
                      (1|ProdServ),
                      family=binomial(link="logit"))
    
    
    summary_residual_compare(CBre_16C,CBre_16G6,Term_16C,Term_16C)
       glmer_examine(CBre_16G6)
glmer_examine(CBre_16G6)
save(CBre_16G6,file="Model16L.RData")
```
Removing c_Offcri increases the max|grad from 0.0027 to 0.0042. Leaving it in.

### 16M: Drop CPSA

```{r Model16M}

    # https://rstudio-pubs-static.s3.amazonaws.com/33653_57fc7b8e5d484c909b615d8633c01d51.html
    library(numDeriv )
    derivs1 <- CBre_16G6@optinfo$derivs
sc_grad1 <- with(derivs1,solve(Hessian,gradient))
max(abs(sc_grad1))

max(pmin(abs(sc_grad1),abs(derivs1$gradient)))

    derivs1 <- CBre_16E@optinfo$derivs
sc_grad1 <- with(derivs1,solve(Hessian,gradient))
max(abs(sc_grad1))

max(pmin(abs(sc_grad1),abs(derivs1$gradient)))

CBre_16G6a <- update(CBre_16G6,start=ss,control=glmerControl(optimizer="bobyqa",
                            optCtrl=list(maxfun=2e5)))

gr
pars <- unlist(getME(CBre_16G6,c("theta","fixef")))
grad2 <- grad(dd,pars)
hess2 <- hessian(dd,pars)
sc_grad2 <- solve(hess2,grad2)
max(pmin(abs(sc_grad2),abs(grad2)))

     
     
CBre_16G7 <- glmer (data=large_crisis_smp,
                      b_CBre ~ Crisis + NoComp +
                        b_UCA +
                       Reach + 
+                        c_OffCri +
                        cl_Ceil +
                        capped_cl_Days +
                        Veh +
                        PricingBasis +
                       Is.Defense +
                     capped_cl_Days:NoComp +
                     # capped_cl_Days:Veh + 
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
                      NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
  # Reach:Crisis This 
                   + Crisis:Is.Defense +
                       # (1 | ServCommCons)+   
  # (1 |  CPSA) +
                      (1|ProdServ),
                      family=binomial(link="logit"))
    
    
glmer_examine(CBre_16G7)
save(CBre_16G7, file="Model16M.RData")
    ```
    
Dropping CPSA raises the max|grad to 0.11. It appears the heirarchy does really help.

### 16N: Multilevel Crisis
```{r Model16N}
load("Model16N.RData")

# CBre_16G10<-     glmer (data=large_crisis_smp,
#                       b_CBre ~  NoComp +
#                         b_UCA +
#                        Reach +
#                         c_OffCri +
#                         cl_Ceil +
#                         capped_cl_Days +
#                         Veh +
#                         PricingBasis +
#                        Is.Defense +
#                      capped_cl_Days:NoComp +
#                      # capped_cl_Days:Veh +
#                      # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
#                       NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
#   # Reach:Crisis This
#                        # (1 | ServCommCons)+
#   (1 |  CPSA) +
#                       (1|ProdServ)+(1+Is.Defense |Crisis),
#                       family=binomial(link="logit"))

    glmer_examine(CBre_16G10)
    

    # ss<-getME(CBre_16G10,c("theta","fixef"))
    # CBre_16N2 <- update(CBre_16G10,start=ss,control=glmerControl(optimizer="bobyqa",
    #                         optCtrl=list(maxfun=2e5)))
    # 
    #     CBre_16N3 <- update(CBre_16G10,start=ss,control=glmerControl(optimizer="nloptwrap",
    #                         optCtrl=list(maxfun=2e5)))
        
        
CBre_16N4<-     glmer (data=extra_large_crisis_smp,
                      b_CBre ~  NoComp +
                        b_UCA +
                       Reach +
                        c_OffCri +
                        cl_Ceil +
                        capped_cl_Days +
                        Veh +
                        PricingBasis +
                       Is.Defense +
                     capped_cl_Days:NoComp +
                     # capped_cl_Days:Veh +
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
                      NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
  # Reach:Crisis This
                       # (1 | ServCommCons)+
  (1 |  CPSA) +
                      (1|ProdServ)+(1+Is.Defense |Crisis),
                      family=binomial(link="logit"))

save(CBre_16N4, file="Model16N.RData")#CBre_16G10,
```
Multi-level modeling of crisis, with seperate slopes based on the value for isdefense, lowers the max|grad to 0.0013, a new low. The alternate models were not saved due to user error but has max|grads of around 0.002 (bobyqa) and 0.004 (nloptwrap) respectively. Likewise switching to extra large resulted in a max|grid of 0.0057, all this suggests that adding crisis as a multilevel variable is not particularly robust.

### 16O: Crisis:Reach
```{r Model16O}           
CBre_16G9 <- glmer (data=large_crisis_smp,
                      b_CBre ~  NoComp +
                        b_UCA +
                       Reach + 
                        c_OffCri +
                        cl_Ceil +
                        capped_cl_Days +
                        Veh +
                        PricingBasis +
                       Is.Defense +
                     capped_cl_Days:NoComp +
                     # capped_cl_Days:Veh + 
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
                      NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
  # Reach:Crisis This 
                       # (1 | ServCommCons)+   
  (1 |  CPSA) +
                      (1|ProdServ)+(1+Is.Defense + Reach|Crisis),
                      family=binomial(link="logit"))

    glmer_examine(CBre_16G9)
    save(CBre_16G9, file="Model16O.RData")
```
Switching Crisis to a multilevel model unfortunately doesn't resolve the problems with included Crisis:Reach. Adding that interaction dramatically increases the Max|Grad to 0.017

### 16P: Dropping OffCri again
    ```{r Model16P}
    
load(file="Model16P.RData")
CBre_16G8 <- glmer (data=large_crisis_smp,
                      b_CBre ~  NoComp +
                        b_UCA +
                       Reach + 
#                         c_OffCri +
                        cl_Ceil +
                        capped_cl_Days +
                        Veh +
                        PricingBasis +
                       Is.Defense +
                     capped_cl_Days:NoComp +
                     # capped_cl_Days:Veh + 
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
                      NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
  # Reach:Crisis This 
                       # (1 | ServCommCons)+   
  (1 |  CPSA) +
                      (1|ProdServ)+(1+Is.Defense|Crisis),
                      family=binomial(link="logit"))
    
    glmer_examine(CBre_16G8)
    

CBre_16M<-     glmer (data=extra_large_crisis_smp,
                      b_CBre ~  NoComp +
                        b_UCA +
                       Reach + 
                        # c_OffCri +
                        cl_Ceil +
                        capped_cl_Days +
                        Veh +
                        PricingBasis +
                       Is.Defense +
                     capped_cl_Days:NoComp +
                     # capped_cl_Days:Veh + 
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
                      NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
  # Reach:Crisis This 
                       # (1 | ServCommCons)+   
  (1 |  CPSA) +
                      (1|ProdServ)+(1+Is.Defense |Crisis),
                      family=binomial(link="logit"),
verbose=1)
     
glmer_examine(CBre_16M) 
save(CBre_16G8,CBre_16M, file="Model16P.RData")
```
Removing c_OffCri does help reducing the max|Grad to 0.0012. Unfortunately, the extra_data version of this query actually increases the max|grad to 0.0033.


### 16Q: Dropping NoComp:Veh

    ```{r Model16P}
    
    
CBre_16G11 <- glmer (data=large_crisis_smp,
                      b_CBre ~  NoComp +
                        b_UCA +
                       Reach + 
                        # c_OffCri +
                        cl_Ceil +
                        capped_cl_Days +
                        Veh +
                        PricingBasis +
                       Is.Defense +
                     capped_cl_Days:NoComp +
                     # capped_cl_Days:Veh + 
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
#                       NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
  # Reach:Crisis This 
                       # (1 | ServCommCons)+   
  (1 |  CPSA) +
                      (1|ProdServ)+(1+Is.Defense |Crisis),
                      family=binomial(link="logit"))
    glmer_examine(CBre_16G11) 
      save(CBre_16G11, file="Model16Q.RData")
      
      
      stargazer::stargazer(CBre_16F8,CBre_16G,type="text",
                     digits=2)
      rm(CBre_16F8)

```
Removing NoComp:Veh still ups the max|grid, in this case to 0.005.
     
     
```{r Model16S}
    
CBre_16G12<-     glmer (data=large_crisis_smp,
                      b_CBre ~  NoComp +
                        b_UCA +
                       Reach + 
                        # c_OffCri +
                        cl_Ceil +
                        capped_cl_Days +
                        Veh +
                        PricingBasis +
                       Is.Defense +
                     capped_cl_Days:NoComp +
                     capped_cl_Days:Veh +
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
                      NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
  # Reach:Crisis This 
                       # (1 | ServCommCons)+   
  (1 |  CPSA) +
                      (1|ProdServ)+(1+Is.Defense|Crisis),
                      family=binomial(link="logit"))
    glmer_examine(CBre_16F19) 
    
    

     
glmer_examine(CBre_16G10)
glmer_examine(CBre_16G11)
glmer_examine(CBre_16G11)      
```  



16G5

Model failed to converge with max|grad| = 0.0108034 (tol = 0.001, component 1)
Not so close! Got worse,

16G6
Model failed to converge with max|grad| = 0.00428272 (tol = 0.001, component 1)

Interestingly, while Office Crisis adds fairly little to the model, it does notably help convergence, and removing it is a hinderance.
After closer examination, the interaction between Days and Vehicle is less interesting than Days and Competion. There's peaks and complicated patterns in the Days and Vehicle interaction. On the other hand for the non-IDC vehicles, the interaction with urgency is interesting. 

Stiooed here

Dropping capped_cl_Days:NoComp because of the comparatively small effect size.

Cbre16G8
Model failed to converge with max|grad| = 0.00120517 (tol = 0.001, component 1)

Cbre16G9
failure to converge in 10000 evaluationsModel failed to converge with max|grad| = 0.0175398 (tol = 0.001, component 1)

Clearly VIF problems don't go away just by switching to multilevel for the variable in question.

  CBre_16G10
  In this context OffCri doesn't add anything to the model
  
Model failed to converge with max|grad| = 0.00134054 (tol = 0.001, component 1)

Let's try dropping NoComp:Veh because it's only really interestingly significant for FSS/GWAC

16G11
It's still value added, so leaving it in,.
Model failed to converge with max|grad| = 0.00500009 (tol = 0.001, component 1)

16G12 Maybe 

```{r Test}
    CBre_16G12<- glmer (data=large_crisis_smp,
                     b_CBre ~ Crisis + NoComp +
                       b_UCA +
                       Reach + 
                       # c_OffCri +
                       cl_Ceil +
                       capped_cl_Days +
                       Veh +
                       PricingBasis +
                       Is.Defense +
                     capped_cl_Days:NoComp +
                     capped_cl_Days:Veh + 
                     # cl_Ceil:Veh + Only significant relevant for BPA/BOA, runs contrary to expectation.
                     NoComp:Veh + #This may be the  next to drop, though the urgency results are interested.
                     # Reach:Crisis This 
              
                       # (1 | ServCommCons)+
                     (1 |  CPSA) +
                       (1|ProdServ)+
                       (1+ Is.Defense|Crisis),
   family=binomial(link="logit"))
                  
```

